

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NPUå®‰è£…åŠé…ç½® &mdash; æ˜‡è…¾å¼€æº  æ–‡æ¡£</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../../../_static/custom.css?v=f2aa3e58" />
      <link rel="stylesheet" type="text/css" href="../../../../../../_static/sphinx-design.min.css?v=95c83b7e" />

  
      <script src="../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../_static/documentation_options.js?v=7d86a446"></script>
      <script src="../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../../../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../../../../../_static/package_info.js?v=2b3ed588"></script>
      <script src="../../../../../../_static/statistics.js?v=da671b53"></script>
      <script src="../../../../../../_static/translations.js?v=beaddf03"></script>
      <script src="../../../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="ç´¢å¼•" href="../../../../../../genindex.html" />
    <link rel="search" title="æœç´¢" href="../../../../../../search.html" />
    <link rel="next" title="NPUè®­ç»ƒ" href="npu_training.html" />
    <link rel="prev" title="LLaMA-Factory" href="../../../../../LLaMA-Factory/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../index.html" class="icon icon-home">
            æ˜‡è…¾å¼€æº
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="æœç´¢æ–‡æ¡£" aria-label="æœç´¢æ–‡æ¡£" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="å¯¼èˆªèœå•">
              <p class="caption" role="heading"><span class="caption-text">ğŸ å¼€å§‹ä½¿ç”¨</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ascend/quick_install.html">å¿«é€Ÿå®‰è£…æ˜‡è…¾ç¯å¢ƒ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸ—ï¸  åŸºç¡€è®¾æ–½ä¸æ¡†æ¶</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../accelerate/index.html">Accelerate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../deepspeed/index.html">DeepSpeed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../kernels/index.html">kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../pytorch/index.html">PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../transformers/index.html">Transformers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸ§  è®­ç»ƒä¸å¾®è°ƒæ¡†æ¶</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../../../LLaMA-Factory/index.html">LLaMA-Factory</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">NPUå®‰è£…åŠé…ç½®</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">æ ¸å¿ƒä¾èµ–è¯´æ˜</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-form-pip">æ–¹å¼ä¸€ï¼šæ‰‹åŠ¨å®‰è£…ç¯å¢ƒ</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">1. ç‰ˆæœ¬åŠä¸‹è½½é“¾æ¥</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">2. é©±åŠ¨åŠå›ºä»¶</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cann">3. CANN</a></li>
<li class="toctree-l4"><a class="reference internal" href="#torch-npu">4. torch-npu</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">5. éªŒè¯å®‰è£…</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#docker">æ–¹å¼äºŒï¼šDocker é¢„å®‰è£…é•œåƒ</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">1. æ‹‰å–é•œåƒ</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">2. å¯åŠ¨å®¹å™¨</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">3. è¿›å…¥å®¹å™¨</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#install-form-docker">æ–¹å¼ä¸‰ï¼šDocker æœ¬åœ°æ„å»º</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#docker-build">1. ä½¿ç”¨ Docker Build æ„å»º</a></li>
<li class="toctree-l4"><a class="reference internal" href="#docker-compose">2. ä½¿ç”¨ Docker Compose æ„å»º</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="npu_training.html">NPUè®­ç»ƒ</a></li>
<li class="toctree-l2"><a class="reference internal" href="distributed.html">åˆ†å¸ƒè®­ç»ƒ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ms-swift/index.html">ms-swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../roll/index.html">ROLL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../torchtitan/index.html">TorchTitan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../trl/index.html">Transformer Reinforcement Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../VeOmni/index.html">VeOmni</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../verl/index.html">verl</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸš€ æ¨ç†ä¸æœåŠ¡</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../llama_cpp/index.html">Llama.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../lm_deploy/index.html">LMDeploy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../onnxruntime/index.html">ONNX Runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../sentence_transformers/index.html">Sentence Transformers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../sglang/index.html">SGLang</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../torchchat/index.html">Torchchat</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸ¨ å¤šæ¨¡æ€ã€åº”ç”¨ä¸è¯„æµ‹</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../Diffusers/index.html">Diffusers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../lm_evaluation/index.html">LM-Evalution-Harness</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../open_clip/index.html">open_clip</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../opencompass/index.html">OpenCompass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../opencv/index.html">OpenCV</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../sd_webui/index.html">Stable-Diffusion-WebUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../timm/index.html">timm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../wenet/index.html">WeNet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../whisper_cpp/index.html">Whisper.cpp</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="ç§»åŠ¨ç‰ˆå¯¼èˆªèœå•" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">æ˜‡è…¾å¼€æº</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="é¡µé¢å¯¼èˆª">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../../LLaMA-Factory/index.html">LLaMA-Factory</a></li>
      <li class="breadcrumb-item active">NPUå®‰è£…åŠé…ç½®</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../_sources/sources/_generated/sources/LLaMA-Factory/source/advanced/npu_installation.rst.txt" rel="nofollow"> æŸ¥çœ‹é¡µé¢æºç </a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="npu">
<h1>NPUå®‰è£…åŠé…ç½®<a class="headerlink" href="#npu" title="Link to this heading">ïƒ</a></h1>
<p>LLaMA-Factory æ”¯æŒåä¸ºæ˜‡è…¾ NPU (A2/A3) è®¾å¤‡ã€‚æ‚¨å¯ä»¥é€‰æ‹©ä»¥ä¸‹ä¸‰ç§æ–¹å¼ä¹‹ä¸€è¿›è¡Œç¯å¢ƒé…ç½®åŠä½¿ç”¨ï¼š</p>
<ul class="simple">
<li><p><a class="reference internal" href="#install-form-pip"><span class="std std-ref">æ–¹å¼ä¸€ï¼šæ‰‹åŠ¨å®‰è£…ç¯å¢ƒ</span></a></p></li>
<li><p><a class="reference internal" href="#use-form-docker"><span class="std std-ref">æ–¹å¼äºŒï¼šDocker é¢„å®‰è£…é•œåƒ</span></a></p></li>
<li><p><a class="reference internal" href="#install-form-docker"><span class="std std-ref">æ–¹å¼ä¸‰ï¼šDocker æœ¬åœ°æ„å»º</span></a></p></li>
</ul>
<section id="id1">
<h2>æ ¸å¿ƒä¾èµ–è¯´æ˜<a class="headerlink" href="#id1" title="Link to this heading">ïƒ</a></h2>
<p>æ‰€æœ‰å®‰è£…æ–¹å¼å‡ä¾èµ–ä»¥ä¸‹ç»„ä»¶ï¼š</p>
<ul class="simple">
<li><p><strong>HDK</strong>ï¼šå›ºä»¶åŠé©±åŠ¨</p></li>
<li><p><strong>CANN</strong>ï¼šå¼‚æ„è®¡ç®—æ¶æ„</p></li>
<li><p><strong>torch_npu</strong>ï¼šPyTorch çš„æ˜‡è…¾é€‚é…æ’ä»¶</p></li>
</ul>
<p>æ ¹æ®å®‰è£…æ–¹å¼ä¸åŒï¼Œæ‰€éœ€æ“ä½œæœ‰æ‰€åŒºåˆ«ï¼š</p>
<ul class="simple">
<li><p><strong>æ‰‹åŠ¨å®‰è£…</strong>ï¼šéœ€æ‰‹åŠ¨å®‰è£… HDKã€CANN å’Œ torch_npuã€‚</p></li>
<li><p><strong>Docker é•œåƒ/æ„å»º</strong>ï¼šå®¿ä¸»æœºä»…éœ€å®‰è£… HDK (é©±åŠ¨/å›ºä»¶)ï¼ŒCANN å’Œ torch_npu å·²é›†æˆåœ¨é•œåƒä¸­ã€‚</p></li>
</ul>
</section>
<section id="install-form-pip">
<span id="id2"></span><h2>æ–¹å¼ä¸€ï¼šæ‰‹åŠ¨å®‰è£…ç¯å¢ƒ<a class="headerlink" href="#install-form-pip" title="Link to this heading">ïƒ</a></h2>
<p>æœ¬æ–¹å¼éœ€è¦æ‚¨æ‰‹åŠ¨å®‰è£… HDKã€CANN å’Œ torch_npuã€‚</p>
<section id="id3">
<h3>1. ç‰ˆæœ¬åŠä¸‹è½½é“¾æ¥<a class="headerlink" href="#id3" title="Link to this heading">ïƒ</a></h3>
<p>æœ¬æ–‡æ¡£åˆ—ä¸¾äº†æœ€æ–°çš„ä¾èµ–ç‰ˆæœ¬åŠä¸‹è½½é“¾æ¥ï¼Œè¯·æ ¹æ®è®¾å¤‡å‹å·é€‰æ‹©ï¼š</p>
<table class="docutils align-left">
<colgroup>
<col style="width: 7.7%" />
<col style="width: 15.4%" />
<col style="width: 76.9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>è®¾å¤‡</p></th>
<th class="head"><p>ä¾èµ–</p></th>
<th class="head"><p>é“¾æ¥</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>A3</p></td>
<td><p>HDK</p></td>
<td><p><a class="reference external" href="https://www.hiascend.com/hardware/firmware-drivers/community?product=7&amp;model=34&amp;cann=8.3.RC1&amp;driver=Ascend+HDK+25.0.RC1.3">https://www.hiascend.com/hardware/firmware-drivers/community?product=7&amp;model=34&amp;cann=8.3.RC1&amp;driver=Ascend+HDK+25.0.RC1.3</a></p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>CANN</p></td>
<td><p><a class="reference external" href="https://www.hiascend.com/developer/download/community/result?module=pt+cann&amp;product=7&amp;model=34">https://www.hiascend.com/developer/download/community/result?module=pt+cann&amp;product=7&amp;model=34</a></p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>torch_npu</p></td>
<td><p><a class="reference external" href="https://www.hiascend.com/developer/download/community/result?module=pt+cann&amp;product=7&amp;model=34">https://www.hiascend.com/developer/download/community/result?module=pt+cann&amp;product=7&amp;model=34</a></p></td>
</tr>
<tr class="row-odd"><td><p>A2</p></td>
<td><p>HDK</p></td>
<td><p><a class="reference external" href="https://www.hiascend.com/hardware/firmware-drivers/community?product=4&amp;model=26&amp;cann=8.3.RC1&amp;driver=Ascend+HDK+25.3.RC1">https://www.hiascend.com/hardware/firmware-drivers/community?product=4&amp;model=26&amp;cann=8.3.RC1&amp;driver=Ascend+HDK+25.3.RC1</a></p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>CANN</p></td>
<td><p><a class="reference external" href="https://www.hiascend.com/developer/download/community/result?module=pt+cann&amp;pt=7.2.0&amp;cann=8.3.RC1">https://www.hiascend.com/developer/download/community/result?module=pt+cann&amp;pt=7.2.0&amp;cann=8.3.RC1</a></p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>torch_npu</p></td>
<td><p><a class="reference external" href="https://www.hiascend.com/developer/download/community/result?module=pt+cann&amp;pt=7.2.0&amp;cann=8.3.RC1">https://www.hiascend.com/developer/download/community/result?module=pt+cann&amp;pt=7.2.0&amp;cann=8.3.RC1</a></p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">å¤‡æ³¨</p>
<ul class="simple">
<li><p>å…·ä½“éœ€è¦å®‰è£…çš„åŒ…å¯æŸ¥çœ‹ä¸‹æ–‡å®é™…å®‰è£…æŒ‡å—ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">torch_npu</span></code> ä¸‹è½½é“¾æ¥è·³è½¬é¡µé¢ï¼Œè¯·ç‚¹å‡»æ‰€éœ€çš„ PyTorch ç‰ˆæœ¬çš„â€œè·å–æºç â€ï¼Œé“¾æ¥å°†è‡ªåŠ¨è·³è½¬è‡³ <a class="reference external" href="https://gitcode.com/Ascend/pytorch/releases">torch_npu å‘è¡Œç‰ˆæœ¬</a> æŒ‡å®šç•Œé¢ã€‚</p></li>
<li><p>æ¨èä½¿ç”¨ <code class="docutils literal notranslate"><span class="pre">torch</span> <span class="pre">2.7.1</span></code> + <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">3.11</span></code>ï¼Œè¯¥ç»„åˆä½œä¸º <code class="docutils literal notranslate"><span class="pre">torch_npu</span></code> çš„ç¨³å®šç‰ˆæœ¬é•¿æœŸæ¼”è¿›</p></li>
</ul>
</div>
</section>
<section id="id4">
<h3>2. é©±åŠ¨åŠå›ºä»¶<a class="headerlink" href="#id4" title="Link to this heading">ïƒ</a></h3>
<p>è¯·æ ¹æ®å®é™…æƒ…å†µé€‰æ‹© <code class="docutils literal notranslate"><span class="pre">.run</span></code> æˆ– <code class="docutils literal notranslate"><span class="pre">.deb</span></code> çš„ HDK å®‰è£…åŒ…ï¼Œå¹¶è¯·æ³¨æ„å®‰è£…åŒ…å¯¹ <code class="docutils literal notranslate"><span class="pre">aarch64</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">x86</span></code> åšäº†åŒºåˆ†ã€‚</p>
<p>ä»¥ä¸‹ä»¥ A2 ç³»åˆ—ä¸ºä¾‹ã€‚A3 ç³»åˆ—åŒ… <code class="docutils literal notranslate"><span class="pre">firmware</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">driver</span></code> åŒ…åæœ‰æ‰€å˜åŒ–ï¼Œå¯ä»¥æ ¹æ®é“¾æ¥å†…å®é™…æƒ…å†µé€‰æ‹©ã€‚</p>
<p>A3 å†…éƒ¨åŒ…åç±»ä¼¼äº <code class="docutils literal notranslate"><span class="pre">Atlas-A3-hdk-npu-driver_25.0.rc1.3_linux-aarch64.run</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">Atlas-A3-hdk-npu-firmware_7.7.0.3.228.run</span></code>ï¼Œå®é™…å®‰è£…æ–¹å¼æ²¡æœ‰å˜åŒ–ã€‚</p>
<ol class="arabic">
<li><p>ä¸Šä¼ å®‰è£…åŒ…ï¼Œä»¥ root ç”¨æˆ·ç™»å½•ï¼Œå°†é©±åŠ¨å’Œå›ºä»¶åŒ…ä¸Šä¼ è‡³æœåŠ¡å™¨ï¼ˆå¦‚ <code class="docutils literal notranslate"><span class="pre">/home</span></code>ï¼‰ã€‚</p></li>
<li><p>å¢åŠ æ‰§è¡Œæƒé™ï¼Œè¿›å…¥å®‰è£…åŒ…ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ã€‚</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>chmod<span class="w"> </span>+x<span class="w"> </span>Ascend-hdk-&lt;chip_type&gt;-npu-driver_&lt;version&gt;_linux-&lt;arch&gt;.run
chmod<span class="w"> </span>+x<span class="w"> </span>Ascend-hdk-&lt;chip_type&gt;-npu-firmware_&lt;version&gt;.run
</pre></div>
</div>
</li>
<li><p>å®‰è£…é©±åŠ¨ä¸å›ºä»¶ï¼Œé»˜è®¤å®‰è£…è·¯å¾„ä¸º <code class="docutils literal notranslate"><span class="pre">/usr/local/Ascend</span></code>ã€‚</p>
<p><strong>å®‰è£…é©±åŠ¨</strong>ï¼š</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./Ascend-hdk-&lt;chip_type&gt;-npu-driver_&lt;version&gt;_linux-&lt;arch&gt;.run<span class="w"> </span>--full<span class="w"> </span>--install-for-all
</pre></div>
</div>
<p>å‡ºç° <code class="docutils literal notranslate"><span class="pre">Driver</span> <span class="pre">package</span> <span class="pre">installed</span> <span class="pre">successfully!</span></code> è¡¨ç¤ºæˆåŠŸã€‚</p>
<p><strong>å®‰è£…å›ºä»¶</strong>ï¼š</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./Ascend-hdk-&lt;chip_type&gt;-npu-firmware_&lt;version&gt;.run<span class="w"> </span>--full
</pre></div>
</div>
<p>å‡ºç° <code class="docutils literal notranslate"><span class="pre">Firmware</span> <span class="pre">package</span> <span class="pre">installed</span> <span class="pre">successfully!</span></code> è¡¨ç¤ºæˆåŠŸã€‚</p>
<div class="admonition note">
<p class="admonition-title">å¤‡æ³¨</p>
<p>è‹¥æœªåˆ›å»ºé»˜è®¤ç”¨æˆ· <code class="docutils literal notranslate"><span class="pre">HwHiAiUser</span></code>ï¼Œéœ€åœ¨å®‰è£…å‘½ä»¤ä¸­æŒ‡å®šç”¨æˆ·å’Œç»„ï¼š <code class="docutils literal notranslate"><span class="pre">./Ascend-hdk-*.run</span> <span class="pre">--full</span> <span class="pre">--install-username=&lt;username&gt;</span> <span class="pre">--install-usergroup=&lt;usergroup&gt;</span></code></p>
</div>
</li>
<li><p>é‡å¯ç³»ç»Ÿï¼Œæ ¹æ®æç¤ºå†³å®šæ˜¯å¦é‡å¯ã€‚å¦‚éœ€é‡å¯ï¼š</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>reboot
</pre></div>
</div>
</li>
<li><p>éªŒè¯å®‰è£…ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹é©±åŠ¨åŠ è½½çŠ¶æ€ï¼š</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>npu-smi<span class="w"> </span>info
</pre></div>
</div>
<img alt="../../../../../../_images/npu-smi.png" src="../../../../../../_images/npu-smi.png" />
</li>
</ol>
</section>
<section id="cann">
<h3>3. CANN<a class="headerlink" href="#cann" title="Link to this heading">ïƒ</a></h3>
<p>è¯·æ ¹æ®å®é™…æƒ…å†µé€‰æ‹© <code class="docutils literal notranslate"><span class="pre">.run</span></code> æˆ– <code class="docutils literal notranslate"><span class="pre">.deb</span></code> çš„ CANN å®‰è£…åŒ…ï¼Œå¹¶è¯·æ³¨æ„å®‰è£…åŒ…å¯¹ <code class="docutils literal notranslate"><span class="pre">aarch64</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">x86</span></code> åšäº†åŒºåˆ†ã€‚</p>
<p>ä»¥ä¸‹ä»¥ A2 ç³»åˆ—ä¸ºä¾‹ã€‚A3 ç³»åˆ—å”¯ä¸€åŒºåˆ«æ˜¯ <code class="docutils literal notranslate"><span class="pre">kernels</span></code> åŒ…åå­—æœ‰æ‰€å˜åŒ–ï¼Œå¯ä»¥æ ¹æ®é“¾æ¥å†…å®é™…æƒ…å†µé€‰æ‹©ã€‚A3 å†…éƒ¨åŒ…åç±»ä¼¼äº <code class="docutils literal notranslate"><span class="pre">Atlas-A3-cann-kernels_8.3.RC1_linux-aarch64.run</span></code>ï¼Œå®é™…å®‰è£…æ–¹å¼æ²¡æœ‰å˜åŒ–ã€‚</p>
<section id="toolkit">
<h4>(1) å®‰è£… Toolkit å¼€å‘å¥—ä»¶<a class="headerlink" href="#toolkit" title="Link to this heading">ïƒ</a></h4>
<p>Toolkit ç”¨äºè®­ç»ƒã€æ¨ç†åŠå¼€å‘ã€‚</p>
<div class="admonition note">
<p class="admonition-title">å¤‡æ³¨</p>
<p>è¯·ç¡®ä¿å®‰è£…ç›®å½•å¯ç”¨ç©ºé—´å¤§äº 10Gã€‚</p>
</div>
<ol class="arabic">
<li><p><strong>æˆæƒä¸å®‰è£…</strong>ï¼šä»¥ root ç”¨æˆ·å®‰è£…ï¼Œé»˜è®¤å®‰è£…è·¯å¾„ä¸º <code class="docutils literal notranslate"><span class="pre">/usr/local/Ascend</span></code>ï¼›ä»¥æ™®é€šç”¨æˆ·å®‰è£…ï¼Œé»˜è®¤å®‰è£…è·¯å¾„ä¸º <code class="docutils literal notranslate"><span class="pre">${HOME}/Ascend</span></code>ã€‚</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>chmod<span class="w"> </span>+x<span class="w"> </span>Ascend-cann-toolkit_&lt;version&gt;_linux-aarch64.run
./Ascend-cann-toolkit_&lt;version&gt;_linux-aarch64.run<span class="w"> </span>--install
</pre></div>
</div>
</li>
<li><p><strong>é…ç½®ç¯å¢ƒå˜é‡</strong>ï¼šä»¥ root ç”¨æˆ·ä¸ºä¾‹ï¼Œå»ºè®®å†™å…¥ <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code>ã€‚</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>/usr/local/Ascend/ascend-toolkit/set_env.sh
</pre></div>
</div>
</li>
</ol>
</section>
<section id="kernels">
<h4>(2) å®‰è£… Kernels ç®—å­åŒ…<a class="headerlink" href="#kernels" title="Link to this heading">ïƒ</a></h4>
<p>éœ€åœ¨å®‰è£… Toolkit åæ‰§è¡Œã€‚å¦‚éœ€å®‰è£…é™æ€åº“ï¼Œè¯·å°† <code class="docutils literal notranslate"><span class="pre">--install</span></code> æ”¹ä¸º <code class="docutils literal notranslate"><span class="pre">--devel</span></code>ã€‚</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>chmod<span class="w"> </span>+x<span class="w"> </span>Ascend-cann-kernels-&lt;chip_type&gt;_&lt;version&gt;_linux-aarch64.run
./Ascend-cann-kernels-&lt;chip_type&gt;_&lt;version&gt;_linux-aarch64.run<span class="w"> </span>--install
</pre></div>
</div>
</section>
<section id="nnal">
<h4>(3) å®‰è£… NNAL ç¥ç»ç½‘ç»œåŠ é€Ÿåº“ï¼ˆå¯é€‰ï¼‰<a class="headerlink" href="#nnal" title="Link to this heading">ïƒ</a></h4>
<p>åŒ…å« ATB å’Œ SiP åŠ é€Ÿåº“ã€‚éœ€åœ¨å®‰è£… Toolkit åæ‰§è¡Œã€‚</p>
<ol class="arabic">
<li><p><strong>æˆæƒä¸å®‰è£…</strong>ï¼š</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>chmod<span class="w"> </span>+x<span class="w"> </span>Ascend-cann-nnal_8.3.RC1_linux-aarch64.run
./Ascend-cann-nnal_8.3.RC1_linux-aarch64.run<span class="w"> </span>--install
</pre></div>
</div>
</li>
<li><p><strong>é…ç½®ç¯å¢ƒå˜é‡</strong>ï¼š</p>
<p>ï¼ˆäºŒé€‰ä¸€ï¼Œä¸å¯åŒæ—¶é…ç½®ï¼‰</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># ATB</span>
<span class="nb">source</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/Ascend/nnal/atb/set_env.sh

<span class="c1"># SiP</span>
<span class="nb">source</span><span class="w"> </span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/Ascend/nnal/asdsip/set_env.sh
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="torch-npu">
<h3>4. torch-npu<a class="headerlink" href="#torch-npu" title="Link to this heading">ïƒ</a></h3>
<p>å»ºè®®åœ¨å®‰è£… LLaMA-Factory æ—¶ä¸€å¹¶å®‰è£… <code class="docutils literal notranslate"><span class="pre">torch-npu</span></code> æ’ä»¶ï¼ŒLLaMA-Factory ä¾èµ–å†…ä¼šæŒç»­æ›´æ–°ç¨³å®šç‰ˆæœ¬çš„ <code class="docutils literal notranslate"><span class="pre">torch-npu</span></code> æ’ä»¶ã€‚</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements/npu.txt
</pre></div>
</div>
<p>å½“ç„¶æ‚¨ä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¸‹è½½åå®‰è£… <code class="docutils literal notranslate"><span class="pre">torch-npu</span></code> æ’ä»¶ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>torch_npu-2.7.1-cp311-cp311-manylinux_2_17_aarch64.whl
</pre></div>
</div>
<p>å®‰è£… <code class="docutils literal notranslate"><span class="pre">torch-npu</span></code> æ’ä»¶éœ€è¦æ³¨æ„ï¼š</p>
<ul class="simple">
<li><p>ä¸‹è½½çš„ <code class="docutils literal notranslate"><span class="pre">torch_npu</span></code> ä¼šå¯¹æ”¯æŒçš„ Python ç‰ˆæœ¬åšåŒºåˆ†ï¼Œè¯·æ ¹æ®å®é™…ç¯å¢ƒæƒ…å†µé€‰æ‹©å¯¹åº”å®‰è£…åŒ…ï¼Œ<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">torch_npu</span></code> æ—¶ï¼Œä¹Ÿä¼šä¸€å¹¶å®‰è£…å¯¹åº”ç‰ˆæœ¬çš„ <code class="docutils literal notranslate"><span class="pre">torch</span></code>ã€‚</p></li>
<li><p>ç¯å¢ƒé‡Œå®‰è£…çš„ <code class="docutils literal notranslate"><span class="pre">torch-npu</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">torch</span></code> ç‰ˆæœ¬éœ€è¦å¯¹é½ã€‚ä¾‹å¦‚ <code class="docutils literal notranslate"><span class="pre">torch-npu</span></code> ç‰ˆæœ¬ä¸º <code class="docutils literal notranslate"><span class="pre">2.7.1</span></code> æ—¶ï¼Œ<code class="docutils literal notranslate"><span class="pre">torch</span></code> çš„ç‰ˆæœ¬ä¹Ÿéœ€è¦ä¸º <code class="docutils literal notranslate"><span class="pre">2.7.1</span></code>ã€‚æœ‰æ—¶ä¾èµ–äº’æ–¥ï¼Œå®‰è£…ä¸ç”¨ä¾èµ–çš„è¿‡ç¨‹ä¼šå¯¼è‡´ <code class="docutils literal notranslate"><span class="pre">torch</span></code> ç‰ˆæœ¬è¢«æ›´æ–°ï¼Œä»è€Œå¯¼è‡´æŠ¥é”™ã€‚</p></li>
</ul>
</section>
<section id="id5">
<h3>5. éªŒè¯å®‰è£…<a class="headerlink" href="#id5" title="Link to this heading">ïƒ</a></h3>
<p>æ‰§è¡Œä»¥ä¸‹ Python è„šæœ¬ï¼š</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch_npu</span>
<span class="nb">print</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">npu</span><span class="o">.</span><span class="n">is_available</span><span class="p">())</span>
</pre></div>
</div>
<p>é¢„æœŸè¾“å‡ºï¼š<code class="docutils literal notranslate"><span class="pre">True</span></code></p>
<img alt="../../../../../../_images/npu-torch.png" src="../../../../../../_images/npu-torch.png" />
<p>è¯¥æƒ…å†µè¯´æ˜ <code class="docutils literal notranslate"><span class="pre">HDK</span></code>ã€<code class="docutils literal notranslate"><span class="pre">CANN</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">torch_npu</span></code> éƒ½æ­£å¸¸å®‰è£…ä¸”ç”Ÿæ•ˆã€‚</p>
</section>
</section>
<section id="docker">
<span id="use-form-docker"></span><h2>æ–¹å¼äºŒï¼šDocker é¢„å®‰è£…é•œåƒ<a class="headerlink" href="#docker" title="Link to this heading">ïƒ</a></h2>
<div class="admonition note">
<p class="admonition-title">å¤‡æ³¨</p>
<p>è¯·ç¡®ä¿å®¿ä¸»æœºå·²å®‰è£…å›ºä»¶å’Œé©±åŠ¨ï¼Œå¯å‚è€ƒå‰æ–‡è¿›è¡Œå®‰è£…ã€‚</p>
</div>
<p>LLaMA-Factory çš„å®˜æ–¹é•œåƒæ‰˜ç®¡äº <a class="reference external" href="https://hub.docker.com/r/hiyouga/llamafactory/tags">Docker Hub</a> å’Œ <a class="reference external" href="https://quay.io/repository/ascend/llamafactory?tab=tags">quay.io</a>ï¼ŒäºŒè€…é•œåƒæ— åŒºåˆ«ã€‚</p>
<section id="id6">
<h3>1. æ‹‰å–é•œåƒ<a class="headerlink" href="#id6" title="Link to this heading">ïƒ</a></h3>
<p>ä¸‹è½½ main åˆ†æ”¯æœ€æ–°é•œåƒï¼ˆè¯·æ ¹æ®è®¾å¤‡é€‰æ‹© A2 æˆ– A3ï¼‰ã€‚å¦‚éœ€ç‰¹å®šç‰ˆæœ¬é•œåƒï¼Œè¯·è®¿é—®é•œåƒä»“åº“æŸ¥çœ‹ Tagã€‚</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Docker Hub</span>
docker<span class="w"> </span>pull<span class="w"> </span>hiyouga/llamafactory:latest-npu-a2
docker<span class="w"> </span>pull<span class="w"> </span>hiyouga/llamafactory:latest-npu-a3

<span class="c1"># quay.io</span>
docker<span class="w"> </span>pull<span class="w"> </span>quay.io/ascend/llamafactory:latest-npu-a2
docker<span class="w"> </span>pull<span class="w"> </span>quay.io/ascend/llamafactory:latest-npu-a3
</pre></div>
</div>
</section>
<section id="id7">
<h3>2. å¯åŠ¨å®¹å™¨<a class="headerlink" href="#id7" title="Link to this heading">ïƒ</a></h3>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨å®¹å™¨ï¼ˆè¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ <code class="docutils literal notranslate"><span class="pre">DOCKER_IMAGE</span></code> å’Œ <code class="docutils literal notranslate"><span class="pre">device</span></code>ï¼‰ï¼š</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CONTAINER_NAME</span><span class="o">=</span>llama_factory_npu
<span class="nv">DOCKER_IMAGE</span><span class="o">=</span>hiyouga/llamafactory:latest-npu-a2

docker<span class="w"> </span>run<span class="w"> </span>-itd<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cap-add<span class="o">=</span>SYS_PTRACE<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--net<span class="o">=</span>host<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/davinci0<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/davinci1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/davinci2<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/davinci3<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/davinci4<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/davinci5<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/davinci6<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/davinci7<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/davinci_manager<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/devmm_svm<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/hisi_hdc<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--shm-size<span class="o">=</span>1200g<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/usr/local/sbin/npu-smi:/usr/local/sbin/npu-smi<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/usr/local/dcmi:/usr/local/dcmi<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/etc/ascend_install.info:/etc/ascend_install.info<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/sys/fs/cgroup:/sys/fs/cgroup:ro<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/usr/local/Ascend/driver:/usr/local/Ascend/driver<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/data:/data<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CONTAINER_NAME</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="s2">&quot;</span><span class="nv">$DOCKER_IMAGE</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>/bin/bash
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">å¤‡æ³¨</p>
<p>é…ç½® <code class="docutils literal notranslate"><span class="pre">--privileged=true</span></code> å¯å¼€å¯ç‰¹æƒæ¨¡å¼ï¼Œèµ‹äºˆå®¹å™¨å¯¹åº•å±‚ç¡¬ä»¶ç®¡ç†è®¾å¤‡ï¼ˆå¦‚ <code class="docutils literal notranslate"><span class="pre">/dev/davinci_manager</span></code>ï¼‰çš„å®Œæ•´è®¿é—®æƒé™ã€‚è¿™èƒ½è§£å†³å¤šå®¹å™¨å¹¶è¡Œåœºæ™¯ä¸‹ï¼Œå› æƒé™é™åˆ¶å¯¼è‡´çš„é©±åŠ¨åˆå§‹åŒ–å¤±è´¥é—®é¢˜ï¼Œç¡®ä¿ NPU èµ„æºèƒ½è¢«å¤šä¸ªå®¹å™¨æ­£å¸¸å¤ç”¨ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šè‹¥æœªé…ç½®è¯¥å‚æ•°ï¼Œå¯èƒ½ä¼šå‡ºç°é¦–ä¸ªå®¹å™¨å ç”¨åï¼Œåç»­å®¹å™¨å› æ— æƒé™è€Œæ— æ³•è¯»å–è®¾å¤‡çš„æƒ…å†µã€‚é‰´äºç‰¹æƒæ¨¡å¼çš„æƒé™è¿‡å¤§ï¼Œç”Ÿäº§ç¯å¢ƒä¸­è¯·åŠ¡å¿…è¯„ä¼°å®‰å…¨é£é™©åæ…é‡ä½¿ç”¨ã€‚</p>
</div>
</section>
<section id="id8">
<h3>3. è¿›å…¥å®¹å™¨<a class="headerlink" href="#id8" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>llama_factory_npu<span class="w"> </span>bash
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">å¤‡æ³¨</p>
<p>é€šè¿‡ <code class="docutils literal notranslate"><span class="pre">--device</span> <span class="pre">/dev/davinci&lt;N&gt;</span></code> æŒ‚è½½æŒ‡å®š NPU å¡ï¼ˆæ”¯æŒ 0-7ï¼‰ã€‚å®¹å™¨å†…è®¾å¤‡ç¼–å·ä¼šè‡ªåŠ¨é‡æ–°æ˜ å°„ï¼ˆä¾‹å¦‚ç‰©ç†æœº davinci6 ä»£è¡¨å®¹å™¨å†…è®¾å¤‡ 0ï¼‰ã€‚</p>
</div>
<p>è¿›å…¥å®¹å™¨åï¼Œå¯ç›´æ¥ä½¿ç”¨ <code class="docutils literal notranslate"><span class="pre">llamafactory-cli</span> <span class="pre">train</span></code> å¯åŠ¨è®­ç»ƒï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚</p>
</section>
</section>
<section id="install-form-docker">
<span id="id9"></span><h2>æ–¹å¼ä¸‰ï¼šDocker æœ¬åœ°æ„å»º<a class="headerlink" href="#install-form-docker" title="Link to this heading">ïƒ</a></h2>
<div class="admonition note">
<p class="admonition-title">å¤‡æ³¨</p>
<p>è¯·ç¡®ä¿å®¿ä¸»æœºå·²å®‰è£…å›ºä»¶å’Œé©±åŠ¨ã€‚</p>
</div>
<p>LLaMA-Factory æä¾› <a class="reference internal" href="#docker-build"><span class="std std-ref">1. ä½¿ç”¨ Docker Build æ„å»º</span></a> å’Œ <a class="reference internal" href="#docker-compose"><span class="std std-ref">2. ä½¿ç”¨ Docker Compose æ„å»º</span></a> ä¸¤ç§æ„å»ºæ–¹å¼ã€‚</p>
<section id="docker-build">
<span id="id10"></span><h3>1. ä½¿ç”¨ Docker Build æ„å»º<a class="headerlink" href="#docker-build" title="Link to this heading">ïƒ</a></h3>
<ol class="arabic">
<li><p>æ„å»ºé•œåƒï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼š</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ascend-A2</span>
docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>./docker/docker-npu/Dockerfile<span class="w"> </span>--build-arg<span class="w"> </span><span class="nv">INSTALL_DEEPSPEED</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span>--build-arg<span class="w"> </span><span class="nv">PIP_INDEX</span><span class="o">=</span>https://pypi.org/simple<span class="w"> </span>-t<span class="w"> </span>llamafactory:latest<span class="w"> </span>.

<span class="c1"># Ascend-A3</span>
docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>./docker/docker-npu/Dockerfile<span class="w"> </span>--build-arg<span class="w"> </span><span class="nv">BASE_IMAGE</span><span class="o">=</span>quay.io/ascend/cann:8.3.rc2-a3-ubuntu22.04-py3.11<span class="w"> </span>--build-arg<span class="w"> </span><span class="nv">INSTALL_DEEPSPEED</span><span class="o">=</span><span class="nb">false</span><span class="w"> </span>--build-arg<span class="w"> </span><span class="nv">PIP_INDEX</span><span class="o">=</span>https://pypi.org/simple<span class="w"> </span>-t<span class="w"> </span>llamafactory:latest<span class="w"> </span>.
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">å¤‡æ³¨</p>
<p>å¯ä¿®æ”¹ <code class="docutils literal notranslate"><span class="pre">BASE_IMAGE</span></code> å‚æ•°æŒ‡å®šå…¶ä»– CANN ç‰ˆæœ¬ï¼ˆå‚è€ƒ <a class="reference external" href="https://quay.io/repository/ascend/cann?tab=tags&amp;tag=latest">ascend/cann</a> ï¼‰ã€‚</p>
</div>
<ol class="arabic" start="2">
<li><p>å¯åŠ¨å®¹å™¨</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">CONTAINER_NAME</span><span class="o">=</span>llama_factory_npu
<span class="nv">DOCKER_IMAGE</span><span class="o">=</span>llamafactory:latest
docker<span class="w"> </span>run<span class="w"> </span>-itd<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cap-add<span class="o">=</span>SYS_PTRACE<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--net<span class="o">=</span>host<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/davinci0<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/davinci1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/davinci2<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/davinci3<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/davinci4<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/davinci5<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/davinci6<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/davinci7<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/davinci_manager<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/devmm_svm<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--device<span class="o">=</span>/dev/hisi_hdc<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--shm-size<span class="o">=</span>1200g<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/usr/local/sbin/npu-smi:/usr/local/sbin/npu-smi<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/usr/local/dcmi:/usr/local/dcmi<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/etc/ascend_install.info:/etc/ascend_install.info<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/sys/fs/cgroup:/sys/fs/cgroup:ro<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/usr/local/Ascend/driver:/usr/local/Ascend/driver<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>-v<span class="w"> </span>/data:/data<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CONTAINER_NAME</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="s2">&quot;</span><span class="nv">$DOCKER_IMAGE</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>/bin/bash
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">å¤‡æ³¨</p>
<p>é…ç½® <code class="docutils literal notranslate"><span class="pre">--privileged=true</span></code> å¯å¼€å¯ç‰¹æƒæ¨¡å¼ï¼Œèµ‹äºˆå®¹å™¨å¯¹åº•å±‚ç¡¬ä»¶ç®¡ç†è®¾å¤‡ï¼ˆå¦‚ <code class="docutils literal notranslate"><span class="pre">/dev/davinci_manager</span></code>ï¼‰çš„å®Œæ•´è®¿é—®æƒé™ã€‚è¿™èƒ½è§£å†³å¤šå®¹å™¨å¹¶è¡Œåœºæ™¯ä¸‹ï¼Œå› æƒé™é™åˆ¶å¯¼è‡´çš„é©±åŠ¨åˆå§‹åŒ–å¤±è´¥é—®é¢˜ï¼Œç¡®ä¿ NPU èµ„æºèƒ½è¢«å¤šä¸ªå®¹å™¨æ­£å¸¸å¤ç”¨ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šè‹¥æœªé…ç½®è¯¥å‚æ•°ï¼Œå¯èƒ½ä¼šå‡ºç°é¦–ä¸ªå®¹å™¨å ç”¨åï¼Œåç»­å®¹å™¨å› æ— æƒé™è€Œæ— æ³•è¯»å–è®¾å¤‡çš„æƒ…å†µã€‚é‰´äºç‰¹æƒæ¨¡å¼çš„æƒé™è¿‡å¤§ï¼Œç”Ÿäº§ç¯å¢ƒä¸­è¯·åŠ¡å¿…è¯„ä¼°å®‰å…¨é£é™©åæ…é‡ä½¿ç”¨ã€‚</p>
</div>
<ol class="arabic" start="3">
<li><p>è¿›å…¥å®¹å™¨</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>llama_factory_npu<span class="w"> </span>bash
</pre></div>
</div>
</li>
</ol>
</section>
<section id="docker-compose">
<span id="id11"></span><h3>2. ä½¿ç”¨ Docker Compose æ„å»º<a class="headerlink" href="#docker-compose" title="Link to this heading">ïƒ</a></h3>
<ol class="arabic simple">
<li><p>è¿›å…¥ç›®å½•</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>docker/docker-npu
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>æ„å»ºé•œåƒå¹¶ç›´æ¥å¯åŠ¨å®¹å™¨ï¼Œè¯·æ ¹æ®è®¾å¤‡å‹å·é€‰æ‹©å‘½ä»¤ï¼š</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ascend-A2</span>
docker-compose<span class="w"> </span>up<span class="w"> </span>-d

<span class="c1"># Ascend-A3</span>
docker-compose<span class="w"> </span>--profile<span class="w"> </span>a3<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>llamafactory-a3
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>è¿›å…¥å®¹å™¨</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>llamafactory-a2<span class="w"> </span>bash
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">å¤‡æ³¨</p>
<p>æ„å»ºå‰ï¼Œè¯·æ£€æŸ¥ <cite>docker-compose.yml</cite> ä¸­çš„ <cite>devices</cite> åˆ—è¡¨ï¼Œå½“å‰æ„å»ºæ—¶åªä¼šæŒ‚å¡ 0ï¼Œè¯·æ ¹æ®éœ€è¦åšä¿®æ”¹ã€‚</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="é¡µè„š">
        <a href="../../../../../LLaMA-Factory/index.html" class="btn btn-neutral float-left" title="LLaMA-Factory" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> ä¸Šä¸€é¡µ</a>
        <a href="npu_training.html" class="btn btn-neutral float-right" title="NPUè®­ç»ƒ" accesskey="n" rel="next">ä¸‹ä¸€é¡µ <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; ç‰ˆæƒæ‰€æœ‰ 2024, Ascendã€‚</p>
  </div>

  åˆ©ç”¨ <a href="https://www.sphinx-doc.org/">Sphinx</a> æ„å»ºï¼Œä½¿ç”¨çš„ 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">ä¸»é¢˜</a>
    ç”± <a href="https://readthedocs.org">Read the Docs</a> å¼€å‘.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>