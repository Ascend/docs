

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Custom Preprocessor Registry &mdash; æ˜‡è…¾å¼€æº  æ–‡æ¡£</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/custom.css?v=f2aa3e58" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/sphinx-design.min.css?v=95c83b7e" />

  
      <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../_static/documentation_options.js?v=7d86a446"></script>
      <script src="../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../../../../_static/package_info.js?v=2b3ed588"></script>
      <script src="../../../../../_static/statistics.js?v=da671b53"></script>
      <script src="../../../../../_static/translations.js?v=beaddf03"></script>
      <script src="../../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="ç´¢å¼•" href="../../../../../genindex.html" />
    <link rel="search" title="æœç´¢" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            æ˜‡è…¾å¼€æº
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="æœç´¢æ–‡æ¡£" aria-label="æœç´¢æ–‡æ¡£" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="å¯¼èˆªèœå•">
              <p class="caption" role="heading"><span class="caption-text">ğŸ å¼€å§‹ä½¿ç”¨</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../ascend/quick_install.html">å¿«é€Ÿå®‰è£…æ˜‡è…¾ç¯å¢ƒ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸ—ï¸  åŸºç¡€è®¾æ–½ä¸æ¡†æ¶</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../accelerate/index.html">Accelerate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../deepspeed/index.html">DeepSpeed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../kernels/index.html">kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pytorch/index.html">PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../transformers/index.html">Transformers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸ§  è®­ç»ƒä¸å¾®è°ƒæ¡†æ¶</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../LLaMA-Factory/index.html">LLaMA-Factory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ms-swift/index.html">ms-swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../roll/index.html">ROLL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../torchtitan/index.html">TorchTitan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../trl/index.html">Transformer Reinforcement Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../VeOmni/index.html">VeOmni</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../verl/index.html">verl</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸš€ æ¨ç†ä¸æœåŠ¡</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../llama_cpp/index.html">Llama.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../lm_deploy/index.html">LMDeploy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../onnxruntime/index.html">ONNX Runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sentence_transformers/index.html">Sentence Transformers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sglang/index.html">SGLang</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../torchchat/index.html">Torchchat</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸ¨ å¤šæ¨¡æ€ã€åº”ç”¨ä¸è¯„æµ‹</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Diffusers/index.html">Diffusers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../lm_evaluation/index.html">LM-Evalution-Harness</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../open_clip/index.html">open_clip</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../opencompass/index.html">OpenCompass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../opencv/index.html">OpenCV</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sd_webui/index.html">Stable-Diffusion-WebUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../timm/index.html">timm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../wenet/index.html">WeNet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../whisper_cpp/index.html">Whisper.cpp</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="ç§»åŠ¨ç‰ˆå¯¼èˆªèœå•" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">æ˜‡è…¾å¼€æº</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="é¡µé¢å¯¼èˆª">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Custom Preprocessor Registry</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/sources/_generated/sources/VeOmni/key_features/preprocessor_registry.md.txt" rel="nofollow"> æŸ¥çœ‹é¡µé¢æºç </a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="custom-preprocessor-registry">
<h1>Custom Preprocessor Registry<a class="headerlink" href="#custom-preprocessor-registry" title="Link to this heading">ïƒ</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">ïƒ</a></h2>
<p>The Custom Preprocessor Registry provides a simple and extensible system for registering data source-specific preprocessor functions in VeOmni. All preprocessors (built-in and custom) are registered using the <code class="docutils literal notranslate"><span class="pre">&#64;register_preprocessor</span></code> decorator and automatically available throughout the framework.</p>
<p><strong>Terminology Clarification:</strong></p>
<ul class="simple">
<li><p><strong>Dataset</strong>: Classes that handle data loading (e.g., <code class="docutils literal notranslate"><span class="pre">MultiSourceDataset</span></code>, <code class="docutils literal notranslate"><span class="pre">MappingDataset</span></code>, <code class="docutils literal notranslate"><span class="pre">IterableDataset</span></code>)</p></li>
<li><p><strong>Preprocessor</strong>: Functions that convert raw data samples from a specific source into model-ready format</p></li>
</ul>
<p>This registry manages preprocessor functions, not dataset classes.</p>
</section>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Link to this heading">ïƒ</a></h2>
<ul class="simple">
<li><p><strong>Decorator-based API</strong>: Simple <code class="docutils literal notranslate"><span class="pre">&#64;register_preprocessor</span></code> decorator for registration</p></li>
<li><p><strong>Auto-registration</strong>: Preprocessors are automatically registered when the module is imported</p></li>
<li><p><strong>Multiple Names</strong>: Register the same preprocessor under multiple data source names</p></li>
<li><p><strong>Clear Terminology</strong>: Distinguishes between dataset classes (data loading) and preprocessor functions (format conversion)</p></li>
</ul>
</section>
<section id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Link to this heading">ïƒ</a></h2>
<section id="define-your-custom-preprocessor">
<h3>1. Define Your Custom Preprocessor<a class="headerlink" href="#define-your-custom-preprocessor" title="Link to this heading">ïƒ</a></h3>
<p>Add your preprocessor to <a class="reference external" href="../../veomni/data/multimodal/preprocess.py"><code class="docutils literal notranslate"><span class="pre">veomni/data/multimodal/preprocess.py</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="nd">@PREPROCESSOR_REGISTRY</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;my_custom_source&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_custom_source_preprocessor</span><span class="p">(</span><span class="n">conversations</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Preprocessor for a custom data source.</span>

<span class="sd">    Args:</span>
<span class="sd">        conversations: Raw conversation data from your source</span>
<span class="sd">        **kwargs: Additional arguments (e.g., generation_ratio, max_image_nums)</span>

<span class="sd">    Returns:</span>
<span class="sd">        constructed_conversation: List of [role, (modality, content), ...]</span>

<span class="sd">    Expected format:</span>
<span class="sd">        [</span>
<span class="sd">            [&quot;user&quot;, (&quot;image&quot;, None), (&quot;text&quot;, &quot;What is this?&quot;)],</span>
<span class="sd">            [&quot;assistant&quot;, (&quot;text&quot;, &quot;This is a cat.&quot;)]</span>
<span class="sd">        ]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">constructed_conversation</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Your preprocessing logic here</span>
    <span class="c1"># Convert your data source format to VeOmni&#39;s format</span>

    <span class="k">return</span> <span class="n">constructed_conversation</span>
</pre></div>
</div>
</section>
<section id="use-your-preprocessor">
<h3>2. Use Your Preprocessor<a class="headerlink" href="#use-your-preprocessor" title="Link to this heading">ïƒ</a></h3>
<p>Once registered, your preprocessor is immediately available:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use the convenience function from preprocess.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">veomni.data.multimodal</span><span class="w"> </span><span class="kn">import</span> <span class="n">conv_preprocess</span>

<span class="c1"># Using conv_preprocess (convenience function)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">conv_preprocess</span><span class="p">(</span><span class="s2">&quot;my_custom_source&quot;</span><span class="p">,</span> <span class="n">conversations</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="use-in-your-config">
<h3>3. Use in Your Config<a class="headerlink" href="#use-in-your-config" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">datasets</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_data</span>
<span class="w">      </span><span class="nt">source_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_custom_source</span><span class="w">  </span><span class="c1"># Matches @PREPROCESSOR_REGISTRY name</span>
<span class="w">      </span><span class="nt">data_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/my/dataset</span>
<span class="w">      </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0</span>
</pre></div>
</div>
</section>
</section>
<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Link to this heading">ïƒ</a></h2>
<section id="registration-flow">
<h3>Registration Flow<a class="headerlink" href="#registration-flow" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Define preprocessor with @PREPROCESSOR_REGISTRY decoratorâ”‚
â”‚    â””â”€&gt; Immediately adds to _PREPROCESSOR_REGISTRY          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Import veomni.data.multimodal module                     â”‚
â”‚    â””â”€&gt; Automatically triggers all @PREPROCESSOR_REGISTRY    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Preprocessor is now available via conv_preprocess()      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre></div>
</div>
</section>
<section id="file-structure">
<h3>File Structure<a class="headerlink" href="#file-structure" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>veomni/data/multimodal/
â”œâ”€â”€ __init__.py                 # Exports registry functions
â””â”€â”€ preprocess.py               # Registry and all preprocessors (built-in + custom)
</pre></div>
</div>
</section>
</section>
<section id="preprocessor-format">
<h2>Preprocessor Format<a class="headerlink" href="#preprocessor-format" title="Link to this heading">ïƒ</a></h2>
<p>Your preprocessor must follow VeOmni's interleaved conversation format:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Input: Your data source&#39;s raw format (flexible)</span>
<span class="n">conversations</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="s2">&quot;human&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;image&gt; What is this?&quot;</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="s2">&quot;gpt&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;A cat.&quot;</span><span class="p">}</span>
<span class="p">]</span>

<span class="c1"># Output: VeOmni&#39;s standardized format (strict)</span>
<span class="n">constructed_conversation</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;What is this?&quot;</span><span class="p">)],</span>
    <span class="p">[</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;A cat.&quot;</span><span class="p">)]</span>
<span class="p">]</span>
</pre></div>
</div>
<section id="supported-modalities">
<h3>Supported Modalities<a class="headerlink" href="#supported-modalities" title="Link to this heading">ïƒ</a></h3>
<table border="1" class="docutils">
<thead>
<tr>
<th>Modality</th>
<th>Format</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Text</td>
<td><code>("text", str)</code></td>
<td><code>("text", "Hello world")</code></td>
</tr>
<tr>
<td>Image</td>
<td><code>("image", None)</code></td>
<td><code>("image", None)</code></td>
</tr>
<tr>
<td>Video</td>
<td><code>("video", None)</code></td>
<td><code>("video", None)</code></td>
</tr>
<tr>
<td>Audio</td>
<td><code>("audio", None)</code></td>
<td><code>("audio", None)</code></td>
</tr>
</tbody>
</table></section>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Link to this heading">ïƒ</a></h2>
<section id="example-1-multi-turn-vqa-conversation-preprocessor">
<h3>Example 1: Multi-turn VQA Conversation Preprocessor<a class="headerlink" href="#example-1-multi-turn-vqa-conversation-preprocessor" title="Link to this heading">ïƒ</a></h3>
<p>For an example of a multi-turn conversation preprocessor, see <a class="reference external" href="../../veomni/data/multimodal/preprocess.py#L66"><code class="docutils literal notranslate"><span class="pre">sharegpt4v_pretrain</span></code> in <code class="docutils literal notranslate"><span class="pre">preprocess.py</span></code></a>.</p>
</section>
<section id="example-2-image-generation-preprocessor">
<h3>Example 2: Image generation Preprocessor<a class="headerlink" href="#example-2-image-generation-preprocessor" title="Link to this heading">ïƒ</a></h3>
<p>For an example of a preprocessor that handles image generation, see <a class="reference external" href="../../veomni/data/multimodal/preprocess.py#L152"><code class="docutils literal notranslate"><span class="pre">imagenet1k</span></code> in <code class="docutils literal notranslate"><span class="pre">preprocess.py</span></code></a>.</p>
</section>
<section id="example-3-registering-multiple-names">
<h3>Example 3: Registering Multiple Names<a class="headerlink" href="#example-3-registering-multiple-names" title="Link to this heading">ïƒ</a></h3>
<p>For an example of a preprocessor registered under multiple names, see <a class="reference external" href="../../veomni/data/multimodal/preprocess.py#L43"><code class="docutils literal notranslate"><span class="pre">sharegpt4v_pretrain_preprocess</span></code> in <code class="docutils literal notranslate"><span class="pre">preprocess.py</span></code></a>.</p>
</section>
</section>
<section id="advanced-usage">
<h2>Advanced Usage<a class="headerlink" href="#advanced-usage" title="Link to this heading">ïƒ</a></h2>
<section id="conditional-preprocessing">
<h3>Conditional Preprocessing<a class="headerlink" href="#conditional-preprocessing" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@PREPROCESSOR_REGISTRY</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;adaptive_source&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">adaptive_preprocessor</span><span class="p">(</span><span class="n">conversations</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;caption&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocessor with different modes&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;caption&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;Describe this image.&quot;</span><span class="p">)],</span>
            <span class="p">[</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">conversations</span><span class="p">)]</span>
        <span class="p">]</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;generation&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">conversations</span><span class="p">)],</span>
            <span class="p">[</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
        <span class="p">]</span>
</pre></div>
</div>
<p>Use in config:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">datasets</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">adaptive_caption</span>
<span class="w">      </span><span class="nt">source_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">adaptive_source</span>
<span class="w">      </span><span class="nt">data_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/data</span>
<span class="w">      </span><span class="nt">source_config</span><span class="p">:</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">caption</span>
</pre></div>
</div>
</section>
<section id="random-sampling">
<h3>Random Sampling<a class="headerlink" href="#random-sampling" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="nd">@PREPROCESSOR_REGISTRY</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;random_prompt_source&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">random_prompt_preprocessor</span><span class="p">(</span><span class="n">conversations</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocessor with randomized prompts&quot;&quot;&quot;</span>
    <span class="n">prompts</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;Describe this image in detail.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;What do you see in this image?&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Please analyze this image.&quot;</span>
    <span class="p">]</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">prompts</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span>
        <span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">prompt</span><span class="p">)],</span>
        <span class="p">[</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">conversations</span><span class="p">)]</span>
    <span class="p">]</span>
</pre></div>
</div>
</section>
<section id="handling-multiple-formats">
<h3>Handling Multiple Formats<a class="headerlink" href="#handling-multiple-formats" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@PREPROCESSOR_REGISTRY</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;flexible_source&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">flexible_format_preprocessor</span><span class="p">(</span><span class="n">conversations</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle different input formats&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conversations</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># Simple caption format</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)],</span>
            <span class="p">[</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">conversations</span><span class="p">)]</span>
        <span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conversations</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="c1"># Structured format</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">conversations</span><span class="p">[</span><span class="s2">&quot;question&quot;</span><span class="p">])],</span>
            <span class="p">[</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">conversations</span><span class="p">[</span><span class="s2">&quot;answer&quot;</span><span class="p">])]</span>
        <span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">conversations</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="c1"># Standard ShareGPT format</span>
        <span class="n">role_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;human&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;gpt&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">}</span>
        <span class="n">constructed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">conversations</span><span class="p">:</span>
            <span class="n">role</span> <span class="o">=</span> <span class="n">role_mapping</span><span class="p">[</span><span class="n">msg</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;&lt;image&gt;&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;image&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">constructed</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">role</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">constructed</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">role</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)])</span>
        <span class="k">return</span> <span class="n">constructed</span>
</pre></div>
</div>
</section>
</section>
<section id="api-reference">
<h2>API Reference<a class="headerlink" href="#api-reference" title="Link to this heading">ïƒ</a></h2>
<section id="registry-functions">
<h3>Registry Functions<a class="headerlink" href="#registry-functions" title="Link to this heading">ïƒ</a></h3>
<p>The following functions are available directly from the <code class="docutils literal notranslate"><span class="pre">veomni.data.multimodal</span></code> package.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">veomni.data.multimodal</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">PREPROCESSOR_REGISTRY</span><span class="p">,</span>          <span class="c1"># Preprocessor registry</span>
    <span class="n">conv_preprocess</span><span class="p">,</span>                <span class="c1"># Preprocess function</span>
<span class="p">)</span>
</pre></div>
</div>
<section id="preprocessor-registry-register-name-str">
<h4><code class="docutils literal notranslate"><span class="pre">PREPROCESSOR_REGISTRY.register(name:</span> <span class="pre">str)</span></code><a class="headerlink" href="#preprocessor-registry-register-name-str" title="Link to this heading">ïƒ</a></h4>
<p>Decorator to register a preprocessor for a specific data source.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@PREPROCESSOR_REGISTRY</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;my_source&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">my_preprocessor</span><span class="p">(</span><span class="n">conversations</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[[</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;hello&quot;</span><span class="p">)]]</span>
</pre></div>
</div>
</section>
</section>
<section id="convenience-functions">
<h3>Convenience Functions<a class="headerlink" href="#convenience-functions" title="Link to this heading">ïƒ</a></h3>
<section id="conv-preprocess-source-str-conversations-kwargs">
<h4><code class="docutils literal notranslate"><span class="pre">conv_preprocess(source:</span> <span class="pre">str,</span> <span class="pre">conversations,</span> <span class="pre">**kwargs)</span></code><a class="headerlink" href="#conv-preprocess-source-str-conversations-kwargs" title="Link to this heading">ïƒ</a></h4>
<p>This convenience function, located in <code class="docutils literal notranslate"><span class="pre">veomni.data.multimodal</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">veomni.data.multimodal</span><span class="w"> </span><span class="kn">import</span> <span class="n">conv_preprocess</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">conv_preprocess</span><span class="p">(</span><span class="s2">&quot;sharegpt4v_pretrain&quot;</span><span class="p">,</span> <span class="n">conversations</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Link to this heading">ïƒ</a></h2>
<p>Example test for your custom preprocessor:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_custom_source_preprocessor</span><span class="p">():</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">veomni.data.multimodal</span><span class="w"> </span><span class="kn">import</span> <span class="n">conv_preprocess</span>

    <span class="c1"># Test your preprocessor</span>
    <span class="n">test_conversations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="s2">&quot;human&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;image&gt; What is this?&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="s2">&quot;gpt&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;A cat.&quot;</span><span class="p">}</span>
    <span class="p">]</span>
    <span class="c1"># Assuming my_custom_source_preprocessor is defined as in the Quick Start</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">conv_preprocess</span><span class="p">(</span><span class="s2">&quot;my_custom_source&quot;</span><span class="p">,</span> <span class="n">test_conversations</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span> <span class="o">==</span> <span class="p">[</span>
        <span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;What is this?&quot;</span><span class="p">)],</span>
        <span class="p">[</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;A cat.&quot;</span><span class="p">)]</span>
    <span class="p">]</span>
</pre></div>
</div>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading">ïƒ</a></h2>
<section id="preprocessor-not-found-error">
<h3>Preprocessor Not Found Error<a class="headerlink" href="#preprocessor-not-found-error" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">ValueError</span><span class="p">:</span> <span class="n">Unknown</span> <span class="n">dataset</span> <span class="n">name</span><span class="p">:</span> <span class="n">my_source</span><span class="o">.</span> <span class="n">No</span> <span class="n">preprocessor</span> <span class="n">registered</span> <span class="k">for</span> <span class="n">this</span> <span class="n">source</span><span class="o">.</span>
</pre></div>
</div>
<p><strong>Solution</strong>:</p>
<ol class="simple">
<li><p>Ensure your preprocessor is decorated with <code class="docutils literal notranslate"><span class="pre">&#64;PREPROCESSOR_REGISTRY.register(&quot;my_source&quot;)</span></code>.</p></li>
<li><p>Check that the <code class="docutils literal notranslate"><span class="pre">source_name</span></code> in your config matches the registered name exactly.</p></li>
<li><p>Verify the module containing your preprocessor is imported. If you add it to <code class="docutils literal notranslate"><span class="pre">veomni/data/multimodal/preprocess.py</span></code>, this is handled automatically.</p></li>
</ol>
</section>
<section id="duplicate-registration-warning">
<h3>Duplicate Registration Warning<a class="headerlink" href="#duplicate-registration-warning" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">UserWarning</span><span class="p">:</span> <span class="n">Preprocessor</span> <span class="k">for</span> <span class="s1">&#39;my_source&#39;</span> <span class="ow">is</span> <span class="n">already</span> <span class="n">registered</span><span class="o">.</span> <span class="n">Overwriting</span> <span class="k">with</span> <span class="n">new</span> <span class="n">preprocessor</span><span class="o">.</span>
</pre></div>
</div>
<p><strong>Solution</strong>: This warning means you have registered the same name more than once. Make sure each preprocessor name is unique, or confirm that you intend to overwrite the existing function.</p>
</section>
<section id="wrong-output-format">
<h3>Wrong Output Format<a class="headerlink" href="#wrong-output-format" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">TypeError</span><span class="p">:</span> <span class="s1">&#39;NoneType&#39;</span> <span class="nb">object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">iterable</span>
</pre></div>
</div>
<p><strong>Solution</strong>: Ensure your preprocessor always returns a list of lists, even if it's empty.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># âŒ Wrong</span>
<span class="k">return</span> <span class="kc">None</span>

<span class="c1"># âœ… Correct</span>
<span class="k">return</span> <span class="p">[[</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;hello&quot;</span><span class="p">)],</span> <span class="p">[</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;hi&quot;</span><span class="p">)]]</span>
</pre></div>
</div>
</section>
</section>
<section id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading">ïƒ</a></h2>
<ol class="simple">
<li><p><strong>Naming Convention</strong>: Use descriptive, lowercase names for preprocessors (e.g., <code class="docutils literal notranslate"><span class="pre">internal_vqa</span></code>, <code class="docutils literal notranslate"><span class="pre">custom_ocr</span></code>).</p></li>
<li><p><strong>Documentation</strong>: Add docstrings to your preprocessor explaining its expected input format and what it does.</p></li>
<li><p><strong>Error Handling</strong>: Add validation for the input format if it's complex, and provide clear error messages.</p></li>
<li><p><strong>Testing</strong>: Write unit tests for your preprocessors.</p></li>
<li><p><strong>Reusability</strong>: Extract common logic into helper functions that are not decorated.</p></li>
<li><p><strong>Multiple Aliases</strong>: Use multiple <code class="docutils literal notranslate"><span class="pre">&#64;PREPROCESSOR_REGISTRY</span></code> decorators if a preprocessor can be used for different but compatible data sources.</p></li>
</ol>
</section>
<section id="usage-in-training-scripts">
<h2>Usage in Training Scripts<a class="headerlink" href="#usage-in-training-scripts" title="Link to this heading">ïƒ</a></h2>
<p>Once you've defined your preprocessor (e.g., in <code class="docutils literal notranslate"><span class="pre">preprocess.py</span></code>), it's automatically available throughout the framework just by importing <code class="docutils literal notranslate"><span class="pre">veomni.data.multimodal</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># In your training script</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">veomni.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">build_multisource_dataset</span>

<span class="c1"># The preprocessor is automatically registered and available</span>
<span class="c1"># as long as the config specifies the correct `source_name`.</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">build_multisource_dataset</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</pre></div>
</div>
<p>The preprocessor becomes available as soon as <code class="docutils literal notranslate"><span class="pre">veomni.data.multimodal</span></code> is imported anywhere in your projectâ€”no manual registration calls are needed!</p>
<section id="end-to-end-example-qwen2-vl-training-pipeline">
<h3>End-to-End Example: Qwen2-VL Training Pipeline<a class="headerlink" href="#end-to-end-example-qwen2-vl-training-pipeline" title="Link to this heading">ïƒ</a></h3>
<p>For a complete working example of how preprocessors integrate into the training pipeline, see the Qwen2-VL training setup:</p>
<p><strong>1. Training Entry Point</strong>: <a class="reference external" href="../../train.sh">train.sh</a></p>
<ul class="simple">
<li><p>Launches distributed training with torchrun</p></li>
</ul>
<p><strong>2. Training Script</strong>: <a class="reference external" href="../../tasks/omni/train_qwen2_vl.py">tasks/omni/train_qwen2_vl.py</a></p>
<ul class="simple">
<li><p><strong>Line 27</strong>: Imports <code class="docutils literal notranslate"><span class="pre">conv_preprocess</span></code> from the preprocessor registry</p></li>
<li><p><strong>Lines 60-103</strong>: Defines <code class="docutils literal notranslate"><span class="pre">process_sample()</span></code> function that:</p>
<ul>
<li><p>Calls <code class="docutils literal notranslate"><span class="pre">conv_preprocess()</span></code> at line 72 to apply the registered preprocessor</p></li>
<li><p>Handles image processing and tokenization</p></li>
<li><p>Returns the processed example ready for training</p></li>
</ul>
</li>
</ul>
<p><strong>3. Configuration</strong>: <a class="reference external" href="../../configs/multimodal/qwen2_vl/qwen2_vl.yaml">configs/multimodal/qwen2_vl/qwen2_vl.yaml</a></p>
<ul class="simple">
<li><p><strong>Line 11</strong>: Specifies <code class="docutils literal notranslate"><span class="pre">source_name:</span> <span class="pre">sharegpt4v_pretrain</span></code> which matches the preprocessor name</p></li>
</ul>
<p><strong>4. Preprocessor Definition</strong>: <a class="reference external" href="../../veomni/data/multimodal/preprocess.py">veomni/data/multimodal/preprocess.py</a></p>
<ul class="simple">
<li><p><strong>Lines 41-61</strong>: Defines <code class="docutils literal notranslate"><span class="pre">sharegpt4v_pretrain_preprocess()</span></code> decorated with <code class="docutils literal notranslate"><span class="pre">&#64;register_preprocessor(&quot;sharegpt4v_pretrain&quot;)</span></code></p></li>
<li><p>This preprocessor converts ShareGPT4V data format into VeOmni's standardized conversation format</p></li>
</ul>
<p><strong>5. Registry System</strong>: <a class="reference external" href="../../veomni/utils/registry.py">veomni/utils/registry.py</a></p>
<ul class="simple">
<li><p>Provides the registration decorator and lookup functions</p></li>
</ul>
<p><strong>Flow Summary</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Config (qwen2_vl.yaml)
  â””â”€&gt; source_name: sharegpt4v_pretrain
       â””â”€&gt; Training Script (train_qwen2_vl.py)
            â””â”€&gt; process_sample() calls conv_preprocess(&quot;sharegpt4v_pretrain&quot;, ...)
                 â””â”€&gt; Registry looks up sharegpt4v_pretrain_preprocess()
                      â””â”€&gt; Preprocessor (preprocess.py) transforms raw data
                           â””â”€&gt; Returns standardized conversation format
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; ç‰ˆæƒæ‰€æœ‰ 2024, Ascendã€‚</p>
  </div>

  åˆ©ç”¨ <a href="https://www.sphinx-doc.org/">Sphinx</a> æ„å»ºï¼Œä½¿ç”¨çš„ 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">ä¸»é¢˜</a>
    ç”± <a href="https://readthedocs.org">Read the Docs</a> å¼€å‘.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>