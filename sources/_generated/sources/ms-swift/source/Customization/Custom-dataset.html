

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è‡ªå®šä¹‰æ•°æ®é›† &mdash; æ˜‡è…¾å¼€æº  æ–‡æ¡£</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../../../_static/custom.css?v=f2aa3e58" />
      <link rel="stylesheet" type="text/css" href="../../../../../../_static/sphinx-design.min.css?v=95c83b7e" />

  
      <script src="../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../_static/documentation_options.js?v=7d86a446"></script>
      <script src="../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../../../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../../../../../_static/package_info.js?v=2b3ed588"></script>
      <script src="../../../../../../_static/statistics.js?v=da671b53"></script>
      <script src="../../../../../../_static/translations.js?v=beaddf03"></script>
      <script src="../../../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="ç´¢å¼•" href="../../../../../../genindex.html" />
    <link rel="search" title="æœç´¢" href="../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../index.html" class="icon icon-home">
            æ˜‡è…¾å¼€æº
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="æœç´¢æ–‡æ¡£" aria-label="æœç´¢æ–‡æ¡£" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="å¯¼èˆªèœå•">
              <p class="caption" role="heading"><span class="caption-text">ğŸ å¼€å§‹ä½¿ç”¨</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ascend/quick_install.html">å¿«é€Ÿå®‰è£…æ˜‡è…¾ç¯å¢ƒ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸ—ï¸  åŸºç¡€è®¾æ–½ä¸æ¡†æ¶</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../accelerate/index.html">Accelerate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../deepspeed/index.html">DeepSpeed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../kernels/index.html">kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../pytorch/index.html">PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../transformers/index.html">Transformers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸ§  è®­ç»ƒä¸å¾®è°ƒæ¡†æ¶</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../LLaMA-Factory/index.html">LLaMA-Factory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ms-swift/index.html">ms-swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../roll/index.html">ROLL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../torchtitan/index.html">TorchTitan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../trl/index.html">Transformer Reinforcement Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../VeOmni/index.html">VeOmni</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../verl/index.html">verl</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸš€ æ¨ç†ä¸æœåŠ¡</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../llama_cpp/index.html">Llama.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../lm_deploy/index.html">LMDeploy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../onnxruntime/index.html">ONNX Runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../sentence_transformers/index.html">Sentence Transformers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../sglang/index.html">SGLang</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../torchchat/index.html">Torchchat</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸ¨ å¤šæ¨¡æ€ã€åº”ç”¨ä¸è¯„æµ‹</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../Diffusers/index.html">Diffusers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../lm_evaluation/index.html">LM-Evalution-Harness</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../open_clip/index.html">open_clip</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../opencompass/index.html">OpenCompass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../opencv/index.html">OpenCV</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../sd_webui/index.html">Stable-Diffusion-WebUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../timm/index.html">timm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../wenet/index.html">WeNet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../whisper_cpp/index.html">Whisper.cpp</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="ç§»åŠ¨ç‰ˆå¯¼èˆªèœå•" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../index.html">æ˜‡è…¾å¼€æº</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="é¡µé¢å¯¼èˆª">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">è‡ªå®šä¹‰æ•°æ®é›†</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../_sources/sources/_generated/sources/ms-swift/source/Customization/Custom-dataset.md.txt" rel="nofollow"> æŸ¥çœ‹é¡µé¢æºç </a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1>è‡ªå®šä¹‰æ•°æ®é›†<a class="headerlink" href="#id1" title="Link to this heading">ïƒ</a></h1>
<p>è‡ªå®šä¹‰æ•°æ®é›†çš„æ¥å…¥æ–¹æ³•æœ‰ä¸‰ç§ï¼Œå¯¹é¢„å¤„ç†å‡½æ•°çš„æ§åˆ¶èƒ½åŠ›é€æ¸åŠ å¼ºï¼Œä½†æ¥å…¥éš¾åº¦é€æ­¥å¢åŠ ã€‚ä¾‹å¦‚ï¼Œæ–¹æ¡ˆä¸€æœ€ä¸ºæ–¹ä¾¿ï¼Œä½†å¯¹é¢„å¤„ç†å‡½æ•°çš„æ§åˆ¶èƒ½åŠ›æœ€å¼±ï¼Œéœ€è¦é¢„å…ˆå¯¹æ•°æ®é›†è¿›è¡Œè½¬æ¢ï¼Œä¼ å…¥ç‰¹å®šæ ¼å¼çš„æ•°æ®é›†ï¼š</p>
<ol class="simple">
<li><p>ã€æ¨èã€‘ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œä¼ å‚çš„æ–¹å¼æ¥å…¥ï¼Œå³<code class="docutils literal notranslate"><span class="pre">--dataset</span> <span class="pre">&lt;dataset_path1&gt;</span> <span class="pre">&lt;dataset_path2&gt;</span></code>ã€‚è¿™å°†ä½¿ç”¨AutoPreprocessorå°†æ•°æ®é›†è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼ï¼ˆæ”¯æŒ4ç§æ•°æ®é›†æ ¼å¼ï¼Œå…·ä½“æŸ¥çœ‹ä¸‹é¢å¯¹AutoPreprocessorçš„ä»‹ç»ï¼‰ã€‚ä½ å¯ä»¥ä½¿ç”¨<code class="docutils literal notranslate"><span class="pre">--columns</span></code>è¿›è¡Œåˆ—åè½¬æ¢ã€‚æ”¯æŒä¼ å…¥csvã€jsonã€jsonlã€txtã€æ–‡ä»¶å¤¹ï¼ˆä¾‹å¦‚git cloneå¼€æºæ•°æ®é›†ï¼‰ã€‚è¯¥æ–¹æ¡ˆä¸éœ€è¦ä¿®æ”¹dataset_info.jsonï¼Œé€‚åˆåˆšæ¥è§¦ms-swiftçš„ç”¨æˆ·ï¼Œä¸‹é¢ä¸¤ç§æ–¹æ¡ˆé€‚åˆå¯¹ms-swiftè¿›è¡Œæ‹“å±•çš„å¼€å‘è€…ã€‚</p></li>
<li><p>æ·»åŠ æ•°æ®é›†åˆ°<code class="docutils literal notranslate"><span class="pre">dataset_info.json</span></code>ä¸­ï¼Œå¯ä»¥å‚è€ƒms-swiftå†…ç½®çš„<a class="reference external" href="https://github.com/modelscope/ms-swift/blob/main/swift/dataset/data/dataset_info.json">dataset_info.json</a>ã€‚è¯¥æ–¹æ¡ˆä¹Ÿå°†ä½¿ç”¨AutoPreprocessorå°†æ•°æ®é›†è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼ã€‚dataset_info.jsonä¸ºæ•°æ®é›†å…ƒä¿¡æ¯çš„listï¼Œæ¯ä¸€é¡¹å…ƒä¿¡æ¯å¿…å¡«ms_dataset_id/hf_dataset_id/dataset_pathä¸­çš„ä¸€é¡¹ï¼Œé€šè¿‡<code class="docutils literal notranslate"><span class="pre">columns</span></code>å­—æ®µè¿›è¡Œåˆ—åè½¬æ¢ã€‚æ·»åŠ åˆ°<code class="docutils literal notranslate"><span class="pre">dataset_info.json</span></code>æˆ–è€…æ³¨å†Œçš„æ•°æ®é›†åœ¨è¿è¡Œ<a class="reference external" href="https://github.com/modelscope/ms-swift/blob/main/scripts/utils/run_dataset_info.py">run_dataset_info.py</a>æ—¶å°†è‡ªåŠ¨äº§ç”Ÿ<a class="reference external" href="https://swift.readthedocs.io/zh-cn/latest/Instruction/Supported-models-and-datasets.html">æ”¯æŒçš„æ•°æ®é›†æ–‡æ¡£</a>ã€‚æ­¤å¤–ï¼Œä½ å¯ä»¥é‡‡ç”¨å¤–æ¥<code class="docutils literal notranslate"><span class="pre">dataset_info.json</span></code>çš„æ–¹å¼ï¼Œä½¿ç”¨<code class="docutils literal notranslate"><span class="pre">--custom_dataset_info</span> <span class="pre">xxx.json</span></code>è§£æjsonæ–‡ä»¶ï¼ˆæ–¹ä¾¿pip installè€Œégit cloneçš„ç”¨æˆ·ï¼‰ï¼Œç„¶åæŒ‡å®š<code class="docutils literal notranslate"><span class="pre">--dataset</span> <span class="pre">&lt;dataset_id/dataset_dir/dataset_path&gt;</span></code>ã€‚</p></li>
<li><p>æ‰‹åŠ¨æ³¨å†Œæ•°æ®é›†ï¼Œå…·æœ‰æœ€çµæ´»çš„é¢„å¤„ç†å‡½æ•°å®šåˆ¶èƒ½åŠ›ï¼Œæ”¯æŒä½¿ç”¨å‡½æ•°å¯¹æ•°æ®é›†è¿›è¡Œé¢„å¤„ç†ï¼Œä½†éš¾åº¦è¾ƒé«˜ã€‚å¯ä»¥å‚è€ƒ<a class="reference external" href="https://github.com/modelscope/ms-swift/blob/main/swift/dataset/dataset/llm.py">å†…ç½®æ•°æ®é›†</a>æˆ–è€…<a class="reference external" href="https://github.com/modelscope/ms-swift/blob/main/examples/custom">examples</a>ä¸­çš„æ ·ä¾‹ã€‚ä½ å¯ä»¥é€šè¿‡æŒ‡å®š<code class="docutils literal notranslate"><span class="pre">--external_plugins</span> <span class="pre">xxx.py</span></code>è§£æå¤–ç½®æ³¨å†Œå†…å®¹ï¼ˆæ–¹ä¾¿pip installè€Œégit cloneçš„ç”¨æˆ·ï¼‰ã€‚</p>
<ul class="simple">
<li><p>æ–¹æ¡ˆä¸€å’ŒäºŒåœ¨å®ç°ä¸­å€ŸåŠ©äº†æ–¹æ¡ˆä¸‰ï¼Œåªæ˜¯æ³¨å†Œçš„è¿‡ç¨‹ä¸ºè‡ªåŠ¨å‘ç”Ÿã€‚</p></li>
</ul>
</li>
</ol>
<p>ä»¥ä¸‹å°†å¯¹<code class="docutils literal notranslate"><span class="pre">AutoPreprocessor</span></code>å¯ä»¥å¤„ç†çš„æ•°æ®é›†æ ¼å¼è¿›è¡Œä»‹ç»ï¼š</p>
<p>ms-swiftçš„æ ‡å‡†æ•°æ®é›†æ ¼å¼å¯æ¥å—çš„keysåŒ…æ‹¬: 'messages'ã€'rejected_response'ã€'label'ã€'images'ã€'videos'ã€'audios'ã€'tools'å’Œ'objects'ã€‚å…¶ä¸­'messages'æ˜¯å¿…éœ€çš„keyï¼Œ'rejected_response'ç”¨äºDPOç­‰RLHFè®­ç»ƒï¼Œ'label'ç”¨äºKTOè®­ç»ƒå’Œåˆ†ç±»æ¨¡å‹è®­ç»ƒï¼Œ'images'ã€'videos'ã€'audios'ç”¨äºå­˜å‚¨å¤šæ¨¡æ€æ•°æ®çš„è·¯å¾„æˆ–è€…urlï¼Œ'tools'ç”¨äºAgentä»»åŠ¡ï¼Œ'objects'ç”¨äºgroundingä»»åŠ¡ã€‚</p>
<p>ms-swiftä¸­å­˜åœ¨ä¸‰ç§æ ¸å¿ƒé¢„å¤„ç†å™¨ï¼š<code class="docutils literal notranslate"><span class="pre">MessagesPreprocessor</span></code>ã€<code class="docutils literal notranslate"><span class="pre">AlpacaPreprocessor</span></code>ã€<code class="docutils literal notranslate"><span class="pre">ResponsePreprocessor</span></code>ã€‚MessagesPreprocessorç”¨äºå°†ç±»messageså’Œsharegptæ ¼å¼çš„æ•°æ®é›†è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼ï¼ŒAlpacaPreprocessoråˆ™è½¬æ¢alpacaæ ¼å¼çš„æ•°æ®é›†ï¼ŒResponsePreprocessoråˆ™è½¬æ¢ç±»query/responseæ ¼å¼çš„æ•°æ®é›†ã€‚<code class="docutils literal notranslate"><span class="pre">AutoPreprocessor</span></code>åˆ™è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„é¢„å¤„ç†è¿›è¡Œå¤„ç†ã€‚</p>
<p>ä»¥ä¸‹å››ç§æ ¼å¼åœ¨<code class="docutils literal notranslate"><span class="pre">AutoPreprocessor</span></code>å¤„ç†ä¸‹éƒ½ä¼šè½¬æ¢æˆms-swiftæ ‡å‡†æ ¼å¼ä¸­çš„messageså­—æ®µï¼Œå³éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨<code class="docutils literal notranslate"><span class="pre">--dataset</span> <span class="pre">&lt;dataset-path&gt;</span></code>æ¥å…¥ï¼š</p>
<p>messagesæ ¼å¼ï¼ˆæ ‡å‡†æ ¼å¼ï¼‰:</p>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;&lt;system&gt;&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;query1&gt;&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;&lt;response1&gt;&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;query2&gt;&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;&lt;response2&gt;&quot;}]}
</pre></div>
</div>
<ul class="simple">
<li><p>æ³¨æ„ï¼šsysteméƒ¨åˆ†æ˜¯å¯é€‰çš„ã€‚æ•°æ®é›†ä¸­çš„systemä¼˜å…ˆçº§é«˜äºå‘½ä»¤è¡Œä¼ å…¥çš„<code class="docutils literal notranslate"><span class="pre">--system</span></code>ï¼Œæœ€åæ˜¯å®šä¹‰åœ¨templateä¸­çš„<code class="docutils literal notranslate"><span class="pre">default_system</span></code>ã€‚</p></li>
</ul>
<p>sharegptæ ¼å¼:</p>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;system&quot;: &quot;&lt;system&gt;&quot;, &quot;conversation&quot;: [{&quot;human&quot;: &quot;&lt;query1&gt;&quot;, &quot;assistant&quot;: &quot;&lt;response1&gt;&quot;}, {&quot;human&quot;: &quot;&lt;query2&gt;&quot;, &quot;assistant&quot;: &quot;&lt;response2&gt;&quot;}]}
</pre></div>
</div>
<p>query-responseæ ¼å¼:</p>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;system&quot;: &quot;&lt;system&gt;&quot;, &quot;query&quot;: &quot;&lt;query2&gt;&quot;, &quot;response&quot;: &quot;&lt;response2&gt;&quot;, &quot;history&quot;: [[&quot;&lt;query1&gt;&quot;, &quot;&lt;response1&gt;&quot;]]}
</pre></div>
</div>
<p>æ³¨æ„ï¼šä»¥ä¸‹å­—æ®µä¼šè‡ªåŠ¨è½¬æˆå¯¹åº”çš„systemã€queryã€responseå­—æ®µã€‚ï¼ˆsolutionå­—æ®µä¼šä¿ç•™ï¼‰</p>
<ul class="simple">
<li><p>system: 'system', 'system_prompt'.</p></li>
<li><p>query: 'query', 'prompt', 'input', 'instruction', 'question', 'problem'.</p></li>
<li><p>response: 'response', 'answer', 'output', 'targets', 'target', 'answer_key', 'answers', 'solution', 'text', 'completion', 'content'.</p></li>
</ul>
<p>alpacaæ ¼å¼:</p>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;system&quot;: &quot;&lt;system&gt;&quot;, &quot;instruction&quot;: &quot;&lt;query-inst&gt;&quot;, &quot;input&quot;: &quot;&lt;query-input&gt;&quot;, &quot;output&quot;: &quot;&lt;response&gt;&quot;}
</pre></div>
</div>
<ul class="simple">
<li><p>æ³¨æ„ï¼šinstructionå’Œinputå­—æ®µå°†ç»„åˆæˆqueryå­—æ®µã€‚è‹¥instructionå’Œinputä¸ç­‰äºç©ºå­—ç¬¦ä¸²ï¼Œ<code class="docutils literal notranslate"><span class="pre">query</span> <span class="pre">=</span> <span class="pre">f'{instruction}\n{input}'</span></code></p></li>
</ul>
<section id="id2">
<h2>æ ‡å‡†æ•°æ®é›†æ ¼å¼<a class="headerlink" href="#id2" title="Link to this heading">ïƒ</a></h2>
<p>ä»¥ä¸‹ç»™å‡ºms-swiftçš„æ ‡å‡†æ•°æ®é›†æ ¼å¼ï¼Œå…¶ä¸­systemå­—æ®µæ˜¯å¯é€‰çš„ï¼Œé»˜è®¤ä½¿ç”¨templateä¸­å®šä¹‰çš„<code class="docutils literal notranslate"><span class="pre">default_system</span></code>ã€‚ä¹‹å‰ä»‹ç»çš„4ç§æ•°æ®é›†æ ¼å¼ä¹Ÿå¯ä»¥è¢«AutoPreprocessorå¤„ç†æˆæ ‡å‡†æ•°æ®é›†æ ¼å¼ã€‚</p>
<section id="id3">
<h3>é¢„è®­ç»ƒ<a class="headerlink" href="#id3" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;I love music&quot;}]}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;æ•™ç»ƒæˆ‘è¦æ‰“ç¯®çƒ&quot;}]}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;è¥¿çº¢æŸ¿é¸¡è›‹ç›–é¥­å’Œåœ°ä¸‰é²œç›–é¥­å“ªä¸ªæ›´æƒå¨&quot;}]}
</pre></div>
</div>
</section>
<section id="id4">
<h3>ç›‘ç£å¾®è°ƒ<a class="headerlink" href="#id4" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;ä½ æ˜¯ä¸ªæœ‰ç”¨æ— å®³çš„åŠ©æ‰‹&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;å‘Šè¯‰æˆ‘æ˜å¤©çš„å¤©æ°”&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;æ˜å¤©å¤©æ°”æ™´æœ—&quot;}]}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;ä½ æ˜¯ä¸ªæœ‰ç”¨æ— å®³çš„æ•°å­¦è®¡ç®—å™¨&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;1+1ç­‰äºå‡ &quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;ç­‰äº2&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;å†åŠ 1å‘¢&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;ç­‰äº3&quot;}]}
</pre></div>
</div>
<ul class="simple">
<li><p>å¯ä»¥é€šè¿‡å¢åŠ &quot;loss&quot;å­—æ®µï¼Œæ§åˆ¶å¯¹åº”çš„æ¨¡å‹å›å¤éƒ¨åˆ†æ˜¯å¦è®¡ç®—æŸå¤±ã€‚é»˜è®¤è¯¥å­—æ®µä¸ºNoneã€‚è‹¥&quot;loss&quot;è®¾ç½®ä¸ºtrueï¼Œåˆ™å¯¹åº”contentè¿›è¡ŒæŸå¤±è®¡ç®—ï¼ˆå¯¹åº”loss_scaleä¸º1ï¼‰ï¼›è‹¥&quot;loss&quot;è®¾ç½®ä¸ºfalseï¼Œåˆ™å¯¹åº”contentä¸è¿›è¡ŒæŸå¤±è®¡ç®—ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥åŠŸèƒ½åªå¯¹&quot;role&quot;ä¸º&quot;assistant&quot;çš„éƒ¨åˆ†ç”Ÿæ•ˆï¼›è¯¥åŠŸèƒ½ä¼˜å…ˆçº§é«˜äºå‘½ä»¤è¡Œå‚æ•° <code class="docutils literal notranslate"><span class="pre">--loss_scale</span></code>ã€‚ç¤ºä¾‹æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š</p></li>
</ul>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;ä½ å¥½&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;ä½ å¥½ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ&quot;, &quot;loss&quot;: false}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;1+1ç­‰äºå‡ ï¼Ÿ&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;ç­‰äº2&quot;, &quot;loss&quot;: true}]}
</pre></div>
</div>
<section id="channel-loss">
<h4>channel loss<a class="headerlink" href="#channel-loss" title="Link to this heading">ïƒ</a></h4>
<p>å¦‚æœä½ è¦ä½¿ç”¨channel lossï¼Œä½ éœ€è¦è®¾ç½®<code class="docutils literal notranslate"><span class="pre">--enable_channel_loss</span> <span class="pre">true</span></code>ï¼Œå¹¶åœ¨æ•°æ®é›†ä¸­å¢åŠ &quot;channel&quot;å­—æ®µã€‚channel losså…¼å®¹packing/padding_free/loss_scaleç­‰æŠ€æœ¯ã€‚</p>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;ä½ æ˜¯ä¸ªæœ‰ç”¨æ— å®³çš„åŠ©æ‰‹&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;å‘Šè¯‰æˆ‘æ˜å¤©çš„å¤©æ°”&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;æ˜å¤©å¤©æ°”æ™´æœ—&quot;}], &quot;channel&quot;: &quot;general&quot;}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;ä½ æ˜¯ä¸ªæœ‰ç”¨æ— å®³çš„æ•°å­¦è®¡ç®—å™¨&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;1+1ç­‰äºå‡ &quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;ç­‰äº2&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;å†åŠ 1å‘¢&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;ç­‰äº3&quot;}], &quot;channel&quot;: &quot;math&quot;}
</pre></div>
</div>
</section>
</section>
<section id="rlhf">
<h3>RLHF<a class="headerlink" href="#rlhf" title="Link to this heading">ïƒ</a></h3>
<section id="dpo-orpo-cpo-simpo-rm">
<h4>DPO/ORPO/CPO/SimPO/RM<a class="headerlink" href="#dpo-orpo-cpo-simpo-rm" title="Link to this heading">ïƒ</a></h4>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;ä½ æ˜¯ä¸ªæœ‰ç”¨æ— å®³çš„åŠ©æ‰‹&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;å‘Šè¯‰æˆ‘æ˜å¤©çš„å¤©æ°”&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;æ˜å¤©å¤©æ°”æ™´æœ—&quot;}], &quot;rejected_response&quot;: &quot;æˆ‘ä¸çŸ¥é“&quot;}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;ä½ æ˜¯ä¸ªæœ‰ç”¨æ— å®³çš„æ•°å­¦è®¡ç®—å™¨&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;1+1ç­‰äºå‡ &quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;ç­‰äº2&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;å†åŠ 1å‘¢&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;ç­‰äº3&quot;}], &quot;rejected_response&quot;: &quot;æˆ‘ä¸çŸ¥é“&quot;}
</pre></div>
</div>
<p>å¤šæ¨¡æ€æ•°æ®çš„æ ¼å¼å‚è€ƒ<a class="reference external" href="#%E5%A4%9A%E6%A8%A1%E6%80%81">å¤šæ¨¡æ€æ•°æ®é›†</a>, é¢å¤–åŠ å…¥å¦‚<code class="docutils literal notranslate"><span class="pre">images</span></code>çš„åˆ—è¡¨ç¤ºå…¶ä»–æ¨¡æ€è¾“å…¥ã€‚å½“éœ€è¦ä¸ºåå¥½å¯¹æ•°æ®å…³è”ä¸åŒçš„å›¾ç‰‡ä¿¡æ¯æ—¶ï¼Œå¯é€šè¿‡<code class="docutils literal notranslate"><span class="pre">rejected_images</span></code>å­—æ®µæ ‡æ³¨æ‹’ç»å›ç­”å¯¹åº”çš„å›¾ç‰‡ä¿¡æ¯ã€‚
å¯¹é½æ•°æ®é›†ä¸­è¦æ±‚<code class="docutils literal notranslate"><span class="pre">rejected_images</span></code>å’Œ<code class="docutils literal notranslate"><span class="pre">rejected_response</span></code>è‡³å°‘æä¾›ä¸€ä¸ªã€‚</p>
<blockquote>
<div><p>æ³¨: RM é¢å¤–æ”¯æŒ margin åˆ—ï¼Œå‚è€ƒ<a class="reference external" href="../Instruction/RLHF.md#rm">RMæ–‡æ¡£</a></p>
</div></blockquote>
<p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨<code class="docutils literal notranslate"><span class="pre">rejected_messages</span></code>ï¼Œè€Œä¸æ˜¯åªæä¾›<code class="docutils literal notranslate"><span class="pre">rejected_response</span></code>/<code class="docutils literal notranslate"><span class="pre">rejected_images</span></code>ï¼Œè¿™å°†æä¾›æ›´å¤§çš„çµæ´»åº¦ï¼ˆä¾‹å¦‚å¤šæ¨¡æ€/agentåœºæ™¯ï¼‰ã€‚è‹¥ä½¿ç”¨rejected_messagesï¼Œåœ¨å¤šæ¨¡æ€åœºæ™¯ä¸‹ï¼Œä½ éœ€è¦é¢å¤–ä¼ å…¥&quot;rejected_images&quot;ï¼Œ&quot;rejected_audios&quot;ï¼Œ&quot;rejected_videos&quot;ç­‰å†…å®¹ï¼›åœ¨Agentåœºæ™¯ä¸‹ï¼Œä½ éœ€è¦é¢å¤–ä¼ å…¥&quot;rejected_tools&quot;ç­‰å†…å®¹ã€‚å¤šæ¨¡æ€æ•°æ®æ ¼å¼ä¾‹å­å¦‚ä¸‹ï¼š</p>
<ul class="simple">
<li><p>è‹¥ä½¿ç”¨<code class="docutils literal notranslate"><span class="pre">rejected_response</span></code>ï¼Œ'rejected_images/rejected_audios/rejected_videos/rejected_tools'çš„é»˜è®¤å€¼ä¸º'images/audios/videos/tools'ï¼›è‹¥ä½¿ç”¨<code class="docutils literal notranslate"><span class="pre">rejected_messages</span></code>ï¼Œåˆ™éœ€è¦é¢å¤–ä¼ å…¥ã€‚</p></li>
</ul>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;image&gt;è¿™æ˜¯ä»€ä¹ˆ&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;è¿™æ˜¯ä¸€åªå°çŒ«å’ªã€‚&quot;}], &quot;images&quot;: [&quot;cat.png&quot;], &quot;rejected_messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;image&gt;è¿™æ˜¯ä»€ä¹ˆ&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;è¿™æ˜¯ä¸€åªå°ç‹—ã€‚&quot;}], &quot;rejected_images&quot;: [&quot;cat.png&quot;]}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;image&gt;è¿™æ˜¯ä»€ä¹ˆ&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;è¿™æ˜¯ä¸€åªå°çŒ«å’ªã€‚&quot;}], &quot;images&quot;: [&quot;cat.png&quot;], &quot;rejected_messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;image&gt;è¿™æ˜¯ä»€ä¹ˆ&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;è¿™æ˜¯ä¸€åªå°çŒ«å’ªã€‚&quot;}], &quot;rejected_images&quot;: [&quot;dog.png&quot;]}
</pre></div>
</div>
<p>ä»¥ä¸Šæ ¼å¼ç­‰ä»·äºï¼š</p>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;image&gt;è¿™æ˜¯ä»€ä¹ˆ&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;è¿™æ˜¯ä¸€åªå°çŒ«å’ªã€‚&quot;}], &quot;images&quot;: [&quot;cat.png&quot;], &quot;rejected_response&quot;: &quot;è¿™æ˜¯ä¸€åªå°ç‹—ã€‚&quot;}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;image&gt;è¿™æ˜¯ä»€ä¹ˆ&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;è¿™æ˜¯ä¸€åªå°çŒ«å’ªã€‚&quot;}], &quot;images&quot;: [&quot;cat.png&quot;], &quot;rejected_images&quot;: [&quot;dog.png&quot;]}
# ä¾‹å­ä¸€ä¹Ÿå¯å†™æˆï¼š
{&quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;image&gt;è¿™æ˜¯ä»€ä¹ˆ&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;è¿™æ˜¯ä¸€åªå°çŒ«å’ªã€‚&quot;}], &quot;images&quot;: [&quot;cat.png&quot;], &quot;rejected_response&quot;: [{&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;è¿™æ˜¯ä¸€åªå°ç‹—ã€‚&quot;}]}
</pre></div>
</div>
<p>ä½ ä¹Ÿå¯ä»¥å°†Agentæ•°æ®é›†ç»„ç»‡æˆä»¥ä¸‹å½¢å¼ï¼š</p>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span># ä¼šå¯»æ‰¾`messages`æœ€åä¸€ä¸ªuserçš„ä½ç½®ï¼Œå¹¶æ›¿æ¢ä¹‹åçš„å†…å®¹ä¸º`rejected_response`ç»„æˆ`rejected_messages`
{&quot;tools&quot;: &quot;[{\&quot;type\&quot;: \&quot;function\&quot;, \&quot;function\&quot;: {\&quot;name\&quot;: \&quot;realtime_aqi\&quot;, \&quot;description\&quot;: \&quot;å¤©æ°”é¢„æŠ¥ã€‚è·å–å®æ—¶ç©ºæ°”è´¨é‡ã€‚å½“å‰ç©ºæ°”è´¨é‡ï¼ŒPM2.5ï¼ŒPM10ä¿¡æ¯\&quot;, \&quot;parameters\&quot;: {\&quot;type\&quot;: \&quot;object\&quot;, \&quot;properties\&quot;: {\&quot;city\&quot;: {\&quot;type\&quot;: \&quot;string\&quot;, \&quot;description\&quot;: \&quot;åŸå¸‚åï¼Œä¾‹å¦‚ï¼šä¸Šæµ·\&quot;}}, \&quot;required\&quot;: [\&quot;city\&quot;]}}}]&quot;, &quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;åŒ—äº¬å’Œä¸Šæµ·ä»Šå¤©çš„å¤©æ°”æƒ…å†µ&quot;}, {&quot;role&quot;: &quot;tool_call&quot;, &quot;content&quot;: &quot;{\&quot;name\&quot;: \&quot;realtime_aqi\&quot;, \&quot;arguments\&quot;: {\&quot;city\&quot;: \&quot;åŒ—äº¬\&quot;}}&quot;}, {&quot;role&quot;: &quot;tool_call&quot;, &quot;content&quot;: &quot;{\&quot;name\&quot;: \&quot;realtime_aqi\&quot;, \&quot;arguments\&quot;: {\&quot;city\&quot;: \&quot;ä¸Šæµ·\&quot;}}&quot;}, {&quot;role&quot;: &quot;tool_response&quot;, &quot;content&quot;: &quot;{\&quot;city\&quot;: \&quot;åŒ—äº¬\&quot;, \&quot;aqi\&quot;: \&quot;10\&quot;, \&quot;unit\&quot;: \&quot;celsius\&quot;}&quot;}, {&quot;role&quot;: &quot;tool_response&quot;, &quot;content&quot;: &quot;{\&quot;city\&quot;: \&quot;ä¸Šæµ·\&quot;, \&quot;aqi\&quot;: \&quot;72\&quot;, \&quot;unit\&quot;: \&quot;fahrenheit\&quot;}&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;æ ¹æ®å¤©æ°”é¢„æŠ¥å·¥å…·ï¼ŒåŒ—äº¬ä»Šå¤©çš„ç©ºæ°”è´¨é‡æŒ‡æ•°ä¸º10ï¼Œå±äºè‰¯å¥½æ°´å¹³ï¼›ä¸Šæµ·ä»Šå¤©çš„ç©ºæ°”è´¨é‡æŒ‡æ•°ä¸º72ï¼Œå±äºè½»åº¦æ±¡æŸ“æ°´å¹³ã€‚&quot;}], &quot;rejected_response&quot;: [{&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;æˆ‘ä¸çŸ¥é“ã€‚&quot;}]}
</pre></div>
</div>
</section>
<section id="kto">
<h4>KTO<a class="headerlink" href="#kto" title="Link to this heading">ïƒ</a></h4>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;ä½ æ˜¯ä¸ªæœ‰ç”¨æ— å®³çš„åŠ©æ‰‹&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;å‘Šè¯‰æˆ‘æ˜å¤©çš„å¤©æ°”&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;æˆ‘ä¸çŸ¥é“&quot;}], &quot;label&quot;: false}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;ä½ æ˜¯ä¸ªæœ‰ç”¨æ— å®³çš„æ•°å­¦è®¡ç®—å™¨&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;1+1ç­‰äºå‡ &quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;ç­‰äº2&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;å†åŠ 1å‘¢&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;ç­‰äº3&quot;}], &quot;label&quot;: true}
</pre></div>
</div>
</section>
<section id="ppo-grpo">
<h4>PPO/GRPO<a class="headerlink" href="#ppo-grpo" title="Link to this heading">ïƒ</a></h4>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;ä½ æ˜¯ä¸ªæœ‰ç”¨æ— å®³çš„åŠ©æ‰‹&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;å‘Šè¯‰æˆ‘æ˜å¤©çš„å¤©æ°”&quot;}]}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;ä½ æ˜¯ä¸ªæœ‰ç”¨æ— å®³çš„æ•°å­¦è®¡ç®—å™¨&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;1+1ç­‰äºå‡ &quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;ç­‰äº2&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;å†åŠ 1å‘¢&quot;}]}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;ä½ çš„åå­—æ˜¯ä»€ä¹ˆ&quot;}]}
</pre></div>
</div>
<ul class="simple">
<li><p>æ³¨æ„ï¼šGRPOä¼šé€ä¼ æ‰€æœ‰é¢å¤–çš„å­—æ®µå†…å®¹ç»™ORMï¼Œè€Œä¸åƒå…¶ä»–è®­ç»ƒæ–¹æ³•ï¼Œé»˜è®¤å°†é¢å¤–çš„å­—æ®µåˆ é™¤ã€‚ä¾‹å¦‚: ä½ å¯ä»¥é¢å¤–ä¼ å…¥'solution'ã€‚è‡ªå®šä¹‰çš„ORMéœ€è¦åŒ…å«ä¸€ä¸ªä½ç½®å‚æ•°completionsï¼Œå…¶ä»–ä¸ºå…³é”®è¯å‚æ•°ï¼Œç”±æ•°æ®é›†é¢å¤–å­—æ®µé€ä¼ ã€‚</p></li>
</ul>
</section>
<section id="gkd">
<h4>GKD<a class="headerlink" href="#gkd" title="Link to this heading">ïƒ</a></h4>
<p>è‹¥æœªå¼€å¯<code class="docutils literal notranslate"><span class="pre">seq_kd</span></code>ï¼Œå³è¯¥å‚æ•°ä¸ºFalseã€‚æ•°æ®é›†æ ¼å¼å¦‚ä¸‹ï¼ˆä½ å¯ä½¿ç”¨teacheræ¨¡å‹æå‰è’¸é¦ï¼‰ï¼š</p>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;ä½ æ˜¯ä¸ªæœ‰ç”¨æ— å®³çš„åŠ©æ‰‹&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;å‘Šè¯‰æˆ‘æ˜å¤©çš„å¤©æ°”&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;æ˜å¤©å¤©æ°”æ™´æœ—&quot;}]}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;ä½ æ˜¯ä¸ªæœ‰ç”¨æ— å®³çš„æ•°å­¦è®¡ç®—å™¨&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;1+1ç­‰äºå‡ &quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;ç­‰äº2&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;å†åŠ 1å‘¢&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;ç­‰äº3&quot;}]}
</pre></div>
</div>
<p>è‹¥å¼€å¯<code class="docutils literal notranslate"><span class="pre">seq_kd</span></code>ï¼Œåˆ™ä¸éœ€è¦æœ€åä¸€è½®çš„'assistant'éƒ¨åˆ†ï¼ˆteacheræ¨¡å‹åœ¨è®­ç»ƒæ—¶ç”Ÿæˆæ•°æ®ï¼‰ï¼š</p>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;ä½ æ˜¯ä¸ªæœ‰ç”¨æ— å®³çš„åŠ©æ‰‹&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;å‘Šè¯‰æˆ‘æ˜å¤©çš„å¤©æ°”&quot;}]}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;ä½ æ˜¯ä¸ªæœ‰ç”¨æ— å®³çš„æ•°å­¦è®¡ç®—å™¨&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;1+1ç­‰äºå‡ &quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;ç­‰äº2&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;å†åŠ 1å‘¢&quot;}]}
</pre></div>
</div>
</section>
</section>
<section id="id5">
<h3>åºåˆ—åˆ†ç±»<a class="headerlink" href="#id5" title="Link to this heading">ïƒ</a></h3>
<p><strong>å•æ ‡ç­¾ä»»åŠ¡</strong>ï¼š</p>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;ä»Šå¤©å¤©æ°”çœŸå¥½å‘€&quot;}], &quot;label&quot;: 1}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;ä»Šå¤©çœŸå€’éœ‰&quot;}], &quot;label&quot;: 0}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;å¥½å¼€å¿ƒ&quot;}], &quot;label&quot;: 1}
</pre></div>
</div>
<p><strong>å¤šæ ‡ç­¾ä»»åŠ¡</strong>ï¼š</p>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;sentence&gt;&quot;}], &quot;label&quot;: []}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;sentence&gt;&quot;}], &quot;label&quot;: [0, 2]}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;sentence&gt;&quot;}], &quot;label&quot;: [1, 3, 5]}
</pre></div>
</div>
<p><strong>å•å›å½’ä»»åŠ¡</strong>ï¼š</p>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;æ±‚ä¸¤å¥è¯çš„ç›¸ä¼¼åº¦ï¼ŒèŒƒå›´ä¸º0-1ã€‚\nsentence1: &lt;sentence1&gt;\nsentence2: &lt;sentence2&gt;&quot;}], &quot;label&quot;: 0.8}
</pre></div>
</div>
<p><strong>å¤šå›å½’ä»»åŠ¡</strong>ï¼š</p>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;sentence&gt;&quot;}], &quot;label&quot;: [1.2, -0.6, 0.8]}
</pre></div>
</div>
</section>
<section id="embedding">
<h3>Embedding<a class="headerlink" href="#embedding" title="Link to this heading">ïƒ</a></h3>
<p>è¯·å‚è€ƒ<a class="reference external" href="../BestPractices/Embedding.md#%E6%95%B0%E6%8D%AE%E9%9B%86%E6%A0%BC%E5%BC%8F">embeddingè®­ç»ƒæ–‡æ¡£</a></p>
</section>
<section id="reranker">
<h3>Reranker<a class="headerlink" href="#reranker" title="Link to this heading">ïƒ</a></h3>
<p>è¯·å‚è€ƒ<a class="reference external" href="../BestPractices/Reranker.md#%E6%95%B0%E6%8D%AE%E9%9B%86%E6%A0%BC%E5%BC%8F">Rerankerè®­ç»ƒæ–‡æ¡£</a></p>
</section>
<section id="id6">
<h3>å¤šæ¨¡æ€<a class="headerlink" href="#id6" title="Link to this heading">ïƒ</a></h3>
<p>å¯¹äºå¤šæ¨¡æ€æ•°æ®é›†ï¼Œå’Œä¸Šè¿°ä»»åŠ¡çš„æ ¼å¼ç›¸åŒã€‚åŒºåˆ«åœ¨äºå¢åŠ äº†<code class="docutils literal notranslate"><span class="pre">images</span></code>, <code class="docutils literal notranslate"><span class="pre">videos</span></code>, <code class="docutils literal notranslate"><span class="pre">audios</span></code>å‡ ä¸ªkeyï¼Œåˆ†åˆ«ä»£è¡¨å¤šæ¨¡æ€èµ„æºçš„urlæˆ–è€…pathï¼ˆæ¨èä½¿ç”¨ç»å¯¹è·¯å¾„ï¼‰ï¼Œ<code class="docutils literal notranslate"><span class="pre">&lt;image&gt;</span></code> <code class="docutils literal notranslate"><span class="pre">&lt;video&gt;</span></code> <code class="docutils literal notranslate"><span class="pre">&lt;audio&gt;</span></code>æ ‡ç­¾ä»£è¡¨äº†æ’å…¥å›¾ç‰‡/è§†é¢‘/éŸ³é¢‘çš„ä½ç½®ï¼Œms-swiftæ”¯æŒå¤šå›¾ç‰‡/è§†é¢‘/éŸ³é¢‘çš„æƒ…å†µã€‚è¿™äº›ç‰¹æ®Štokenså°†åœ¨é¢„å¤„ç†çš„æ—¶å€™è¿›è¡Œæ›¿æ¢ï¼Œå‚è€ƒ<a class="reference external" href="https://github.com/modelscope/ms-swift/blob/main/swift/template/templates/qwen.py#L198">è¿™é‡Œ</a>ã€‚ä¸‹é¢ç»™å‡ºçš„å››æ¡ç¤ºä¾‹åˆ†åˆ«å±•ç¤ºäº†çº¯æ–‡æœ¬ï¼Œä»¥åŠåŒ…å«å›¾åƒã€è§†é¢‘å’ŒéŸ³é¢‘æ•°æ®çš„æ•°æ®æ ¼å¼ã€‚</p>
<p>é¢„è®­ç»ƒï¼š</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;é¢„è®­ç»ƒçš„æ–‡æœ¬åœ¨è¿™é‡Œ&quot;</span><span class="p">}]}</span>
<span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;image&gt;æ˜¯ä¸€åªå°ç‹—ï¼Œ&lt;image&gt;æ˜¯ä¸€åªå°çŒ«&quot;</span><span class="p">}],</span> <span class="s2">&quot;images&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/xxx/x.jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;/xxx/x.png&quot;</span><span class="p">]}</span>
<span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;audio&gt;æè¿°äº†ä»Šå¤©å¤©æ°”çœŸä¸é”™&quot;</span><span class="p">}],</span> <span class="s2">&quot;audios&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/xxx/x.wav&quot;</span><span class="p">]}</span>
<span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;image&gt;æ˜¯ä¸€ä¸ªå¤§è±¡ï¼Œ&lt;video&gt;æ˜¯ä¸€åªç‹®å­åœ¨è·‘æ­¥&quot;</span><span class="p">}],</span> <span class="s2">&quot;images&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/xxx/x.jpg&quot;</span><span class="p">],</span> <span class="s2">&quot;videos&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/xxx/x.mp4&quot;</span><span class="p">]}</span>
</pre></div>
</div>
<p>å¾®è°ƒï¼š</p>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;æµ™æ±Ÿçš„çœä¼šåœ¨å“ªï¼Ÿ&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;æµ™æ±Ÿçš„çœä¼šåœ¨æ­å·ã€‚&quot;}]}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;image&gt;&lt;image&gt;ä¸¤å¼ å›¾ç‰‡æœ‰ä»€ä¹ˆåŒºåˆ«&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;å‰ä¸€å¼ æ˜¯å°çŒ«ï¼Œåä¸€å¼ æ˜¯å°ç‹—&quot;}], &quot;images&quot;: [&quot;/xxx/x.jpg&quot;, &quot;/xxx/x.png&quot;]}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;audio&gt;è¯­éŸ³è¯´äº†ä»€ä¹ˆ&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;ä»Šå¤©å¤©æ°”çœŸå¥½å‘€&quot;}], &quot;audios&quot;: [&quot;/xxx/x.mp3&quot;]}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;ä½ æ˜¯ä¸ªæœ‰ç”¨æ— å®³çš„åŠ©æ‰‹&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;image&gt;å›¾ç‰‡ä¸­æ˜¯ä»€ä¹ˆï¼Œ&lt;video&gt;è§†é¢‘ä¸­æ˜¯ä»€ä¹ˆ&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;å›¾ç‰‡ä¸­æ˜¯ä¸€ä¸ªå¤§è±¡ï¼Œè§†é¢‘ä¸­æ˜¯ä¸€åªå°ç‹—åœ¨è‰åœ°ä¸Šå¥”è·‘&quot;}], &quot;images&quot;: [&quot;/xxx/x.jpg&quot;], &quot;videos&quot;: [&quot;/xxx/x.mp4&quot;]}
</pre></div>
</div>
<ul class="simple">
<li><p>æ³¨æ„ï¼šä»¥ä¸‹å­—æ®µä¼šè‡ªåŠ¨è½¬æˆå¯¹åº”çš„images, videos, audioså­—æ®µã€‚</p>
<ul>
<li><p>images: image, images.</p></li>
<li><p>videos: video, videos.</p></li>
<li><p>audios: audio, audios.</p></li>
</ul>
</li>
<li><p>å¦‚æœéœ€è¦ä¼ å…¥base64æ ¼å¼è€Œä¸æ˜¯æ–‡ä»¶è·¯å¾„ï¼Œä»¥ä¸‹ä¸ºæ ·æœ¬ä¾‹å­ï¼š<code class="docutils literal notranslate"><span class="pre">&quot;videos&quot;:</span> <span class="pre">['data:video/mp4;base64,{base64_encoded}']</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;images&quot;:</span> <span class="pre">['data:image/jpg;base64,{base64_encoded}']</span></code>ã€‚</p></li>
<li><p>è‹¥ä½ å¸Œæœ›ç›´æ¥ä¼ å…¥è§†é¢‘å¸§ï¼Œè€Œä¸æ˜¯è§†é¢‘ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š<code class="docutils literal notranslate"><span class="pre">&quot;videos&quot;:</span> <span class="pre">[[&quot;/xxx/x.png&quot;,</span> <span class="pre">&quot;/xxx/y.png&quot;],</span> <span class="pre">[&quot;/xxx/a.png&quot;,</span> <span class="pre">&quot;/xxx/b.png&quot;,</span> <span class="pre">&quot;/xxx/c.png&quot;]]</span></code>ã€‚è¯¥æ ¼å¼åªæœ‰éƒ¨åˆ†æ¨¡å‹æ”¯æŒï¼ŒåŒ…æ‹¬Qwen2/2.5/3-VLã€Qwen2.5/3-Omniä»¥åŠå…¶è¡ç”Ÿæ¨¡å‹ã€‚</p></li>
</ul>
<p>å¤šæ¨¡æ€æ¨¡å‹çš„RLHFå’Œåºåˆ—åˆ†ç±»çš„æ•°æ®æ ¼å¼å¯ä»¥å‚è€ƒçº¯æ–‡æœ¬å¤§æ¨¡å‹çš„æ ¼å¼ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šå¢åŠ <code class="docutils literal notranslate"><span class="pre">images</span></code>ç­‰å­—æ®µã€‚</p>
<section id="grounding">
<h4>grounding<a class="headerlink" href="#grounding" title="Link to this heading">ïƒ</a></h4>
<p>å¦‚æœæ˜¯groundingï¼ˆç‰©ä½“æ£€æµ‹ï¼‰ä»»åŠ¡ï¼Œms-swiftæ”¯æŒä¸¤ç§æ–¹å¼ï¼š</p>
<ol class="simple">
<li><p>ç›´æ¥ä½¿ç”¨å¯¹åº”æ¨¡å‹groundingä»»åŠ¡çš„æ•°æ®é›†æ ¼å¼ï¼Œä¾‹å¦‚qwen2-vlçš„æ ¼å¼å¦‚ä¸‹ï¼š</p></li>
</ol>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are a helpful assistant.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;image&gt;æè¿°å›¾åƒ&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;&lt;|object_ref_start|&gt;ä¸€åªç‹—&lt;|object_ref_end|&gt;&lt;|box_start|&gt;(221,423),(569,886)&lt;|box_end|&gt;å’Œ&lt;|object_ref_start|&gt;ä¸€ä¸ªå¥³äºº&lt;|object_ref_end|&gt;&lt;|box_start|&gt;(451,381),(733,793)&lt;|box_end|&gt;æ­£åœ¨æ²™æ»©ä¸Šç©è€&quot;}], &quot;images&quot;: [&quot;/xxx/x.jpg&quot;]}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are a helpful assistant.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;image&gt;æ‰¾åˆ°å›¾åƒä¸­çš„&lt;|object_ref_start|&gt;ç¾Š&lt;|object_ref_end|&gt;&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;&lt;|box_start|&gt;(101,201),(150,266)&lt;|box_end|&gt;&lt;|box_start|&gt;(401,601),(550,666)&lt;|box_end|&gt;&quot;}], &quot;images&quot;: [&quot;/xxx/x.jpg&quot;]}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are a helpful assistant.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;image&gt;å¸®æˆ‘æ‰“å¼€è°·æ­Œæµè§ˆå™¨&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;Action: click(start_box=&#39;&lt;|box_start|&gt;(246,113)&lt;|box_end|&gt;&#39;)&quot;}], &quot;images&quot;: [&quot;/xxx/x.jpg&quot;]}
</pre></div>
</div>
<p>ä½¿ç”¨è¿™ç§ç±»å‹çš„æ•°æ®éœ€è¦æ³¨æ„ï¼š</p>
<ul class="simple">
<li><p>ä¸åŒæ¨¡å‹groundingä»»åŠ¡çš„ç‰¹æ®Šå­—ç¬¦å’Œæ•°æ®é›†æ ¼å¼ä¸åŒã€‚</p></li>
<li><p>ä¸åŒæ¨¡å‹å¯¹bboxæ˜¯å¦å½’ä¸€åŒ–çš„å¤„ç†ä¸åŒã€‚ä¾‹å¦‚ï¼šqwen2.5-vlä½¿ç”¨ç»å¯¹åæ ‡ï¼Œè€Œqwen2/3-vlã€internvl2.5éœ€è¦å¯¹bboxçš„åæ ‡è¿›è¡Œåƒåˆ†ä½åæ ‡å½’ä¸€åŒ–ã€‚</p>
<ul>
<li><p>æ³¨æ„ï¼šQwen2.5-VLé‡‡ç”¨ç»å¯¹åæ ‡ï¼Œå› æ­¤è¦å°å¿ƒæ¯æ¬¡çš„å›¾åƒç¼©æ”¾ï¼Œå¦‚æœä½¿ç”¨æ–¹æ¡ˆä¸€çš„æ•°æ®é›†æ ¼å¼ï¼Œä½ éœ€è¦é¢„å…ˆå¯¹å›¾åƒè¿›è¡Œresizeï¼ˆHå’ŒWéœ€è¦æ˜¯28çš„ç³»æ•°ï¼‰ï¼Œå¹¶æ ¹æ®è¯¥å°ºå¯¸ç¼©æ”¾åæ ‡ç‚¹ã€‚å¦‚æœä½¿ç”¨æ–¹æ¡ˆäºŒçš„æ•°æ®é›†æ ¼å¼ï¼Œms-swiftä¼šå¸®åŠ©ä½ å¤„ç†å›¾åƒçš„ç¼©æ”¾é—®é¢˜ï¼Œä½ ä¾æ—§å¯ä»¥ä½¿ç”¨<code class="docutils literal notranslate"><span class="pre">MAX_PIXELS</span></code>æˆ–è€…<code class="docutils literal notranslate"><span class="pre">--max_pixels</span></code>ç­‰è¿›è¡Œå›¾åƒç¼©æ”¾ï¼ˆä»…è®­ç»ƒï¼Œæ¨ç†åœºæ™¯ï¼Œä½ ä¾æ—§éœ€è¦è‡ªå·±å¤„ç†å›¾åƒçš„ç¼©æ”¾é—®é¢˜ï¼‰ã€‚</p></li>
</ul>
</li>
</ul>
<ol class="simple">
<li><p>ä½¿ç”¨ms-swiftçš„groundingæ•°æ®æ ¼å¼ï¼š</p></li>
</ol>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are a helpful assistant.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;image&gt;æè¿°å›¾åƒ&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;&lt;ref-object&gt;&lt;bbox&gt;å’Œ&lt;ref-object&gt;&lt;bbox&gt;æ­£åœ¨æ²™æ»©ä¸Šç©è€&quot;}], &quot;images&quot;: [&quot;/xxx/x.jpg&quot;], &quot;objects&quot;: {&quot;ref&quot;: [&quot;ä¸€åªç‹—&quot;, &quot;ä¸€ä¸ªå¥³äºº&quot;], &quot;bbox&quot;: [[331.5, 761.4, 853.5, 1594.8], [676.5, 685.8, 1099.5, 1427.4]]}}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are a helpful assistant.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;image&gt;æ‰¾åˆ°å›¾åƒä¸­çš„&lt;ref-object&gt;&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;&lt;bbox&gt;&lt;bbox&gt;&quot;}], &quot;images&quot;: [&quot;/xxx/x.jpg&quot;], &quot;objects&quot;: {&quot;ref&quot;: [&quot;ç¾Š&quot;], &quot;bbox&quot;: [[90.9, 160.8, 135, 212.8], [360.9, 480.8, 495, 532.8]]}}
{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are a helpful assistant.&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;image&gt;å¸®æˆ‘æ‰“å¼€è°·æ­Œæµè§ˆå™¨&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;Action: click(start_box=&#39;&lt;bbox&gt;&#39;)&quot;}], &quot;images&quot;: [&quot;/xxx/x.jpg&quot;], &quot;objects&quot;: {&quot;ref&quot;: [], &quot;bbox&quot;: [[615, 226]]}}
</pre></div>
</div>
<p>è¯¥æ ¼å¼å°†è‡ªåŠ¨è½¬æ¢æ•°æ®é›†æ ¼å¼ä¸ºå¯¹åº”æ¨¡å‹çš„groundingä»»åŠ¡æ ¼å¼ï¼Œä¸”é€‰æ‹©å¯¹åº”æ¨¡å‹çš„bboxå½’ä¸€åŒ–æ–¹å¼ã€‚è¯¥æ ¼å¼æ¯”é€šç”¨æ ¼å¼å¤šäº†objectså­—æ®µï¼Œè¯¥å­—æ®µåŒ…å«çš„å­—æ®µæœ‰ï¼š</p>
<ul class="simple">
<li><p>ref: ç”¨äºæ›¿æ¢messagesä¸­çš„<code class="docutils literal notranslate"><span class="pre">&lt;ref-object&gt;</span></code>ã€‚refçš„é•¿åº¦éœ€è¦ä¸<code class="docutils literal notranslate"><span class="pre">&lt;ref-object&gt;</span></code>çš„æ•°é‡ä¸€è‡´ã€‚</p></li>
<li><p>bbox: ç”¨äºæ›¿æ¢messagesä¸­çš„<code class="docutils literal notranslate"><span class="pre">&lt;bbox&gt;</span></code>ã€‚è‹¥bboxä¸­æ¯ä¸ªboxé•¿åº¦ä¸º2ï¼Œåˆ™ä»£è¡¨xå’Œyåæ ‡ï¼Œè‹¥boxé•¿åº¦ä¸º4ï¼Œåˆ™ä»£è¡¨2ä¸ªç‚¹çš„xå’Œyåæ ‡ã€‚bboxçš„é•¿åº¦éœ€è¦ä¸<code class="docutils literal notranslate"><span class="pre">&lt;bbox&gt;</span></code>çš„æ•°é‡ä¸€è‡´ã€‚</p>
<ul>
<li><p>æ³¨æ„ï¼š<code class="docutils literal notranslate"><span class="pre">&lt;ref-object&gt;</span></code>å’Œ<code class="docutils literal notranslate"><span class="pre">&lt;bbox&gt;</span></code>å¹¶æ²¡æœ‰å¯¹åº”å…³ç³»ï¼Œrefå’Œbboxå„è‡ªæ›¿æ¢å„è‡ªçš„å ä½ç¬¦ã€‚</p></li>
</ul>
</li>
<li><p>bbox_type: å¯é€‰é¡¹ä¸º'real'ï¼Œ'norm1'ã€‚é»˜è®¤ä¸º'real'ï¼Œå³bboxä¸ºçœŸå®bboxå€¼ã€‚è‹¥æ˜¯'norm1'ï¼Œåˆ™bboxå·²ç»å½’ä¸€åŒ–ä¸º0~1ã€‚</p></li>
<li><p>image_id: é€šå¸¸ç”¨äºå¤šå›¾groundingä»»åŠ¡ã€‚è¯¥å‚æ•°åªæœ‰å½“bbox_typeä¸º'real'æ—¶ç”Ÿæ•ˆï¼Œä»£è¡¨bboxå¯¹åº”çš„å›¾ç‰‡æ˜¯ç¬¬å‡ å¼ ï¼Œç”¨äºç¼©æ”¾bboxã€‚ç´¢å¼•ä»0å¼€å§‹ï¼Œé»˜è®¤å…¨ä¸ºç¬¬0å¼ ã€‚image_idçš„æ•°é‡éœ€è¦å’Œbboxçš„æ•°é‡ä¸€è‡´ã€‚ä¾‹å¦‚ï¼šè‹¥bboxçš„é•¿åº¦ä¸º10ï¼Œimagesçš„é•¿åº¦ä¸º2ï¼Œé‚£ä¹ˆimage_idçš„é•¿åº¦éœ€è¦æ˜¯10ï¼Œå…¶å€¼éœ€è¦åœ¨<code class="docutils literal notranslate"><span class="pre">{0,</span> <span class="pre">1}</span></code>é›†åˆå†…ã€‚</p></li>
</ul>
<p>å¯¹äºQwen2.5-VL/Qwen3-VLï¼Œä½ å¯ä»¥ä½¿ç”¨ç¯å¢ƒ<code class="docutils literal notranslate"><span class="pre">QWENVL_BBOX_FORMAT='new'</span></code>ï¼ˆé»˜è®¤ä¸º'legacy'ï¼‰ï¼Œä»¥å…¼å®¹<a class="reference external" href="https://github.com/QwenLM/Qwen3-VL/blob/main/cookbooks/2d_grounding.ipynb">å®˜æ–¹cookbook</a>æ ¼å¼ã€‚å¹¶å°†æ•°æ®é›†å®šä¹‰æˆä»¥ä¸‹æ ¼å¼ï¼š</p>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;image&gt;æ‰¾åˆ°å›¾åƒä¸­çš„&lt;ref-object&gt;&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;[\n\t{\&quot;bbox_2d\&quot;: &lt;bbox&gt;, \&quot;label\&quot;: \&quot;&lt;ref-object&gt;\&quot;},\n\t{\&quot;bbox_2d\&quot;: &lt;bbox&gt;, \&quot;label\&quot;: \&quot;&lt;ref-object&gt;\&quot;}\n]&quot;}], &quot;images&quot;: [&quot;cat.png&quot;], &quot;objects&quot;: {&quot;ref&quot;: [&quot;ç¾Š&quot;, &quot;ç¾Š&quot;, &quot;ç¾Š&quot;], &quot;bbox&quot;: [[90.9, 160.8, 135, 212.8], [360.9, 480.8, 495, 532.8]]}}
</pre></div>
</div>
<p>æµ‹è¯•ms-swiftæ ¼å¼çš„groundingæ•°æ®æ ¼å¼çš„æœ€ç»ˆæ ¼å¼ï¼š</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MAX_PIXELS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1003520&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">swift</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_processor</span><span class="p">,</span> <span class="n">get_template</span>

<span class="n">processor</span> <span class="o">=</span> <span class="n">get_processor</span><span class="p">(</span><span class="s1">&#39;Qwen/Qwen2.5-VL-7B-Instruct&#39;</span><span class="p">)</span>
<span class="n">template</span> <span class="o">=</span> <span class="n">get_template</span><span class="p">(</span><span class="n">processor</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="n">template</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span><span class="s1">&#39;train&#39;</span><span class="p">)</span>
<span class="n">encoded</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">return_template_inputs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[INPUT_IDS] </span><span class="si">{</span><span class="n">template</span><span class="o">.</span><span class="n">safe_decode</span><span class="p">(</span><span class="n">encoded</span><span class="p">[</span><span class="s2">&quot;input_ids&quot;</span><span class="p">])</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[LABELS] </span><span class="si">{</span><span class="n">template</span><span class="o">.</span><span class="n">safe_decode</span><span class="p">(</span><span class="n">encoded</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">])</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;images: </span><span class="si">{</span><span class="n">encoded</span><span class="p">[</span><span class="s2">&quot;template_inputs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">images</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="agent">
<h3>Agentæ ¼å¼<a class="headerlink" href="#agent" title="Link to this heading">ïƒ</a></h3>
<p>è¿™é‡Œåˆ†åˆ«æä¾›äº†çº¯æ–‡æœ¬Agentå’Œå¤šæ¨¡æ€Agentçš„ç¤ºä¾‹æ•°æ®æ ·æœ¬ï¼š</p>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;tools&quot;: &quot;[{\&quot;type\&quot;: \&quot;function\&quot;, \&quot;function\&quot;: {\&quot;name\&quot;: \&quot;realtime_aqi\&quot;, \&quot;description\&quot;: \&quot;å¤©æ°”é¢„æŠ¥ã€‚è·å–å®æ—¶ç©ºæ°”è´¨é‡ã€‚å½“å‰ç©ºæ°”è´¨é‡ï¼ŒPM2.5ï¼ŒPM10ä¿¡æ¯\&quot;, \&quot;parameters\&quot;: {\&quot;type\&quot;: \&quot;object\&quot;, \&quot;properties\&quot;: {\&quot;city\&quot;: {\&quot;type\&quot;: \&quot;string\&quot;, \&quot;description\&quot;: \&quot;åŸå¸‚åï¼Œä¾‹å¦‚ï¼šä¸Šæµ·\&quot;}}, \&quot;required\&quot;: [\&quot;city\&quot;]}}}]&quot;, &quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;åŒ—äº¬å’Œä¸Šæµ·ä»Šå¤©çš„å¤©æ°”æƒ…å†µ&quot;}, {&quot;role&quot;: &quot;tool_call&quot;, &quot;content&quot;: &quot;{\&quot;name\&quot;: \&quot;realtime_aqi\&quot;, \&quot;arguments\&quot;: {\&quot;city\&quot;: \&quot;åŒ—äº¬\&quot;}}&quot;}, {&quot;role&quot;: &quot;tool_call&quot;, &quot;content&quot;: &quot;{\&quot;name\&quot;: \&quot;realtime_aqi\&quot;, \&quot;arguments\&quot;: {\&quot;city\&quot;: \&quot;ä¸Šæµ·\&quot;}}&quot;}, {&quot;role&quot;: &quot;tool_response&quot;, &quot;content&quot;: &quot;{\&quot;city\&quot;: \&quot;åŒ—äº¬\&quot;, \&quot;aqi\&quot;: \&quot;10\&quot;, \&quot;unit\&quot;: \&quot;celsius\&quot;}&quot;}, {&quot;role&quot;: &quot;tool_response&quot;, &quot;content&quot;: &quot;{\&quot;city\&quot;: \&quot;ä¸Šæµ·\&quot;, \&quot;aqi\&quot;: \&quot;72\&quot;, \&quot;unit\&quot;: \&quot;fahrenheit\&quot;}&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;æ ¹æ®å¤©æ°”é¢„æŠ¥å·¥å…·ï¼ŒåŒ—äº¬ä»Šå¤©çš„ç©ºæ°”è´¨é‡æŒ‡æ•°ä¸º10ï¼Œå±äºè‰¯å¥½æ°´å¹³ï¼›ä¸Šæµ·ä»Šå¤©çš„ç©ºæ°”è´¨é‡æŒ‡æ•°ä¸º72ï¼Œå±äºè½»åº¦æ±¡æŸ“æ°´å¹³ã€‚&quot;}]}
{&quot;tools&quot;: &quot;[{\&quot;type\&quot;: \&quot;function\&quot;, \&quot;function\&quot;: {\&quot;name\&quot;: \&quot;click\&quot;, \&quot;description\&quot;: \&quot;ç‚¹å‡»å±å¹•ä¸­çš„æŸä¸ªä½ç½®\&quot;, \&quot;parameters\&quot;: {\&quot;type\&quot;: \&quot;object\&quot;, \&quot;properties\&quot;: {\&quot;x\&quot;: {\&quot;type\&quot;: \&quot;integer\&quot;, \&quot;description\&quot;: \&quot;æ¨ªåæ ‡ï¼Œè¡¨ç¤ºå±å¹•ä¸Šçš„æ°´å¹³ä½ç½®\&quot;}, \&quot;y\&quot;: {\&quot;type\&quot;: \&quot;integer\&quot;, \&quot;description\&quot;: \&quot;çºµåæ ‡ï¼Œè¡¨ç¤ºå±å¹•ä¸Šçš„å‚ç›´ä½ç½®\&quot;}}, \&quot;required\&quot;: [\&quot;x\&quot;, \&quot;y\&quot;]}}}]&quot;, &quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;&lt;image&gt;ç°åœ¨å‡ ç‚¹äº†ï¼Ÿ&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;&lt;think&gt;\næˆ‘å¯ä»¥é€šè¿‡æ‰“å¼€æ—¥å†Appæ¥è·å–å½“å‰æ—¶é—´ã€‚\n&lt;/think&gt;\n&quot;}, {&quot;role&quot;: &quot;tool_call&quot;, &quot;content&quot;: &quot;{\&quot;name\&quot;: \&quot;click\&quot;, \&quot;arguments\&quot;: {\&quot;x\&quot;: 105, \&quot;y\&quot;: 132}}&quot;}, {&quot;role&quot;: &quot;tool_response&quot;, &quot;content&quot;: &quot;{\&quot;images\&quot;: \&quot;&lt;image&gt;\&quot;, \&quot;status\&quot;: \&quot;success\&quot;}&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;æˆåŠŸæ‰“å¼€æ—¥å†Appï¼Œç°åœ¨çš„æ—¶é—´ä¸ºä¸­åˆ11ç‚¹&quot;}], &quot;images&quot;: [&quot;desktop.png&quot;, &quot;calendar.png&quot;]}
</pre></div>
</div>
<ul class="simple">
<li><p>agent_templateä¸º&quot;react_en&quot;, &quot;hermes&quot;ç­‰æƒ…å†µä¸‹ï¼Œè¯¥æ ¼å¼é€‚é…æ‰€æœ‰æ¨¡å‹Agentè®­ç»ƒï¼Œå¯ä»¥è½»æ¾åœ¨ä¸åŒæ¨¡å‹é—´åˆ‡æ¢ã€‚</p></li>
<li><p>å…¶ä¸­toolsæ˜¯ä¸€ä¸ªåŒ…å«toolåˆ—è¡¨çš„jsonå­—ç¬¦ä¸²ï¼Œmessagesä¸­roleä¸º'tool_call'å’Œ'tool_response/tool'çš„contentéƒ¨åˆ†éƒ½éœ€è¦æ˜¯jsonå­—ç¬¦ä¸²ã€‚</p></li>
<li><p>toolså­—æ®µå°†åœ¨è®­ç»ƒ/æ¨ç†æ—¶å’Œ<code class="docutils literal notranslate"><span class="pre">{&quot;role&quot;:</span> <span class="pre">&quot;system&quot;,</span> <span class="pre">...}&quot;</span></code>éƒ¨åˆ†ç»„åˆï¼Œæ ¹æ®agent_templateç»„æˆå®Œæ•´çš„systeméƒ¨åˆ†ã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{&quot;role&quot;:</span> <span class="pre">&quot;tool_call&quot;,</span> <span class="pre">...}</span></code>éƒ¨åˆ†å°†æ ¹æ®agent_templateè‡ªåŠ¨è½¬æˆå¯¹åº”æ ¼å¼çš„<code class="docutils literal notranslate"><span class="pre">{&quot;role&quot;:</span> <span class="pre">&quot;assistant&quot;,</span> <span class="pre">...}</span></code>ï¼Œå¤šæ¡è¿ç»­çš„<code class="docutils literal notranslate"><span class="pre">{&quot;role&quot;:</span> <span class="pre">&quot;assistant&quot;,</span> <span class="pre">...}</span></code>å°†æ‹¼æ¥åœ¨ä¸€èµ·ç»„æˆå®Œæ•´çš„assistant_contentã€‚</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{&quot;role&quot;:</span> <span class="pre">&quot;tool_response&quot;,</span> <span class="pre">...}</span></code>ä¹Ÿå¯ä»¥å†™æˆ<code class="docutils literal notranslate"><span class="pre">{&quot;role&quot;:</span> <span class="pre">&quot;tool&quot;,</span> <span class="pre">...}</span></code>ï¼Œè¿™ä¸¤ç§å†™æ³•æ˜¯ç­‰ä»·çš„ã€‚è¯¥éƒ¨åˆ†ä¹Ÿå°†æ ¹æ®<code class="docutils literal notranslate"><span class="pre">agent_template</span></code>è‡ªåŠ¨è½¬æ¢æ ¼å¼ã€‚è¯¥éƒ¨åˆ†åœ¨è®­ç»ƒæ—¶å°†ä¸è¿›è¡ŒæŸå¤±çš„è®¡ç®—ï¼Œè§’è‰²ç±»ä¼¼äº<code class="docutils literal notranslate"><span class="pre">{&quot;role&quot;:</span> <span class="pre">&quot;user&quot;,</span> <span class="pre">...}</span></code>ã€‚</p></li>
<li><p>è¯¥æ ¼å¼æ”¯æŒå¹¶è¡Œè°ƒç”¨å·¥å…·ï¼Œä¾‹å­å‚è€ƒç¬¬ä¸€æ¡æ•°æ®æ ·æœ¬ã€‚å¤šæ¨¡æ€Agentæ•°æ®æ ·æœ¬ä¸­<code class="docutils literal notranslate"><span class="pre">&lt;image&gt;</span></code>æ ‡ç­¾æ•°é‡åº”ä¸&quot;images&quot;é•¿åº¦ç›¸åŒï¼Œå…¶æ ‡ç­¾ä½ç½®ä»£è¡¨å›¾åƒç‰¹å¾çš„æ’å…¥ä½ç½®ã€‚å½“ç„¶ä¹Ÿæ”¯æŒå…¶ä»–æ¨¡æ€ï¼Œä¾‹å¦‚audios, videosã€‚</p></li>
<li><p>æ³¨æ„ï¼šæ‚¨ä¹Ÿå¯ä»¥æ‰‹åŠ¨å°†æ•°æ®å¤„ç†ä¸ºroleä¸ºsystem/user/assistantçš„messagesæ ¼å¼ã€‚agent_templateçš„ä½œç”¨æ˜¯å°†å…¶ä¸­çš„toolså­—æ®µä»¥åŠroleä¸ºtool_callå’Œtool_responseçš„messageséƒ¨åˆ†ï¼Œè‡ªåŠ¨æ˜ å°„ä¸ºæ ‡å‡†çš„roleä¸ºsystem/user/assistantçš„messagesæ ¼å¼ã€‚</p></li>
<li><p>æ›´å¤šè¯·å‚è€ƒ<a class="reference internal" href="../Instruction/Agent-support.html"><span class="doc">Agentæ–‡æ¡£</span></a>ã€‚</p></li>
</ul>
</section>
<section id="id7">
<h3>æ–‡ç”Ÿå›¾æ ¼å¼<a class="headerlink" href="#id7" title="Link to this heading">ïƒ</a></h3>
<div class="highlight-jsonl notranslate"><div class="highlight"><pre><span></span>{&quot;messages&quot;: [{&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;ä½ æ˜¯ä¸ªæœ‰ç”¨æ— å®³çš„åŠ©æ‰‹&quot;}, {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;ç»™æˆ‘ç”»å‡ºä¸€ä¸ªè‹¹æœ&quot;}, {&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;&lt;image&gt;&quot;}], &quot;images&quot;: [&quot;/xxx/x.jpg&quot;]}
</pre></div>
</div>
</section>
</section>
<section id="dataset-info-json">
<h2>dataset_info.json<a class="headerlink" href="#dataset-info-json" title="Link to this heading">ïƒ</a></h2>
<p>å¯ä»¥å‚è€ƒms-swiftå†…ç½®çš„<a class="reference external" href="https://github.com/modelscope/ms-swift/blob/main/swift/dataset/data/dataset_info.json">dataset_info.json</a>ã€‚è¯¥æ–¹æ¡ˆä½¿ç”¨AutoPreprocessoré¢„å¤„ç†å‡½æ•°å°†æ•°æ®é›†è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼ã€‚dataset_info.jsonæ–‡ä»¶ä¸­åŒ…å«äº†æ•°æ®é›†å…ƒä¿¡æ¯çš„listï¼Œä»¥ä¸‹ä¸ºä¸€äº›ä¾‹å­ï¼š</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;ms_dataset_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;xxx/xxx&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;dataset_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;dataset_dir/dataset_path&gt;&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;ms_dataset_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;dataset_id&gt;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;subsets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;v1&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;split&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;validation&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;input&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;query&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;output&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;response&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;ms_dataset_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;dataset_id&gt;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;hf_dataset_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;hf_dataset_id&gt;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;subsets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">      </span><span class="nt">&quot;subset&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;subset1&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;problem&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;query&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;response&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;subset&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;subset2&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;messages&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;new_messages&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;messages&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>æ”¯æŒä»¥ä¸‹å‚æ•°ï¼š</p>
<ul class="simple">
<li><p>ms_dataset_id: å‚è€ƒDatasetMetaå‚æ•°ã€‚</p></li>
<li><p>hf_dataset_id: å‚è€ƒDatasetMetaå‚æ•°ã€‚</p></li>
<li><p>dataset_path: å‚è€ƒDatasetMetaå‚æ•°ã€‚</p></li>
<li><p>dataset_name: å‚è€ƒDatasetMetaå‚æ•°ã€‚</p></li>
<li><p>subsets: å‚è€ƒDatasetMetaå‚æ•°ã€‚</p></li>
<li><p>split: å‚è€ƒDatasetMetaå‚æ•°ã€‚</p></li>
<li><p>columns: åœ¨æ•°æ®é›†è¿›è¡Œé¢„å¤„ç†å‰ï¼Œå¯¹æ•°æ®é›†è¿›è¡Œåˆ—åè½¬æ¢ã€‚</p></li>
</ul>
</section>
<section id="id8">
<h2>æ•°æ®é›†æ³¨å†Œ<a class="headerlink" href="#id8" title="Link to this heading">ïƒ</a></h2>
<p>register_datasetä¼šåœ¨<code class="docutils literal notranslate"><span class="pre">DATASET_MAPPING</span></code>ä¸­æ³¨å†Œæ•°æ®é›†ï¼Œè°ƒç”¨å‡½æ•°<code class="docutils literal notranslate"><span class="pre">register_dataset(dataset_meta)</span></code>å³å¯å®Œæˆæ•°æ®é›†æ³¨å†Œï¼Œå…¶ä¸­dataset_metaå°†å­˜å‚¨æ¨¡å‹çš„å…ƒä¿¡æ¯ã€‚DatasetMetaçš„å‚æ•°åˆ—è¡¨å¦‚ä¸‹ï¼š</p>
<ul class="simple">
<li><p>ms_dataset_id: ModelScopeçš„dataset_idï¼Œé»˜è®¤ä¸ºNoneã€‚</p></li>
<li><p>hf_dataset_id: HuggingFaceçš„dataset_idï¼Œé»˜è®¤ä¸ºNoneã€‚</p></li>
<li><p>dataset_path: æ•°æ®é›†<strong>æ–‡ä»¶/æ–‡ä»¶å¤¹</strong>çš„æœ¬åœ°è·¯å¾„ï¼ˆæ¨èä½¿ç”¨ç»å¯¹è·¯å¾„ï¼‰ã€‚é»˜è®¤ä¸ºNoneã€‚</p></li>
<li><p>dataset_name: æ•°æ®é›†åˆ«åï¼Œå¯ä»¥é€šè¿‡<code class="docutils literal notranslate"><span class="pre">--dataset</span> <span class="pre">&lt;dataset_name&gt;</span></code>æŒ‡å®šæ•°æ®é›†ï¼Œè¿™åœ¨dataset_pathå¾ˆé•¿æ—¶å¾ˆæ–¹ä¾¿ã€‚é»˜è®¤ä¸ºNoneã€‚</p></li>
<li><p>subsets: å­æ•°æ®é›†çš„åå­—åˆ—è¡¨æˆ–è€…<code class="docutils literal notranslate"><span class="pre">SubsetDataset</span></code>å¯¹è±¡çš„åˆ—è¡¨ï¼Œé»˜è®¤ä¸º<code class="docutils literal notranslate"><span class="pre">['default']</span></code>ã€‚ï¼ˆåªæœ‰dataset_idæˆ–è€…dataset_dirï¼ˆgit cloneå¼€æºæ•°æ®é›†ï¼‰æœ‰å­æ•°æ®é›†å’Œsplitçš„æ¦‚å¿µï¼‰ã€‚</p></li>
<li><p>split: é»˜è®¤ä¸º<code class="docutils literal notranslate"><span class="pre">['train']</span></code>ã€‚</p></li>
<li><p>preprocess_func: é¢„å¤„ç†å‡½æ•°æˆ–å¯è°ƒç”¨å¯¹è±¡ï¼Œé»˜è®¤ä¸º<code class="docutils literal notranslate"><span class="pre">AutoPreprocessor()</span></code>ã€‚è¯¥é¢„å¤„ç†å‡½æ•°æ¥å£ä¸ºä¼ å…¥<code class="docutils literal notranslate"><span class="pre">HfDataset</span></code>ï¼Œå¹¶è¿”å›æ»¡è¶³æ ‡å‡†æ ¼å¼çš„<code class="docutils literal notranslate"><span class="pre">HfDataset</span></code>ã€‚</p></li>
<li><p>load_function: é»˜è®¤ä¸º<code class="docutils literal notranslate"><span class="pre">DatasetLoader.load</span></code>ã€‚è‹¥éœ€è¦è‡ªå®šä¹‰è½½å…¥å‡½æ•°ï¼Œåˆ™è¯¥è½½å…¥å‡½æ•°éœ€è¿”å›æ»¡è¶³æ ‡å‡†æ ¼å¼çš„<code class="docutils literal notranslate"><span class="pre">HfDataset</span></code>ï¼Œè¿™å°†æŠ›å¼ƒms-swiftçš„æ•°æ®é›†è½½å…¥æœºåˆ¶ï¼Œæä¾›ç»™ç”¨æˆ·æœ€å¤§çš„è‡ªç”±åº¦ã€‚é€šå¸¸è¯¥å‚æ•°ä¸éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚</p></li>
</ul>
<p>ä»¥ä¸‹ä»‹ç»æ³¨å†Œæ•°æ®é›†çš„ä¾‹å­ï¼š</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">swift.dataset</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ResponsePreprocessor</span><span class="p">,</span> <span class="n">DatasetMeta</span><span class="p">,</span> <span class="n">register_dataset</span><span class="p">,</span> <span class="n">SubsetDataset</span><span class="p">,</span> <span class="n">load_dataset</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomPreprocessor</span><span class="p">(</span><span class="n">ResponsePreprocessor</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;ä»»åŠ¡ï¼šåˆ¤æ–­ä¸‹é¢ä¸¤å¥è¯è¯­æ„æ˜¯å¦ç›¸ä¼¼ã€‚</span>
<span class="s2">å¥å­1: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;text1&#39;</span><span class="p">]</span><span class="si">}</span>
<span class="s2">å¥å­2: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;text2&#39;</span><span class="p">]</span><span class="si">}</span>
<span class="s2">è¯·è¾“å‡ºç±»åˆ«[0/1]: 0ä»£è¡¨å«ä¹‰ä¸åŒ, 1ä»£è¡¨å«ä¹‰ç›¸ä¼¼ã€‚</span>
<span class="s2">&quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;query&#39;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span>
            <span class="s1">&#39;response&#39;</span><span class="p">:</span> <span class="n">response</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>


<span class="n">register_dataset</span><span class="p">(</span>
    <span class="n">DatasetMeta</span><span class="p">(</span>
        <span class="n">ms_dataset_id</span><span class="o">=</span><span class="s1">&#39;swift/financial_classification&#39;</span><span class="p">,</span>
        <span class="n">subsets</span><span class="o">=</span><span class="p">[</span><span class="n">SubsetDataset</span><span class="p">(</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]),</span> <span class="n">SubsetDataset</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">])],</span>
        <span class="n">preprocess_func</span><span class="o">=</span><span class="n">CustomPreprocessor</span><span class="p">(),</span>
    <span class="p">))</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># load_dataset returns train_dataset and val_dataset based on `split_dataset_ratio`</span>
    <span class="c1"># Here, since we didn&#39;t pass `split_dataset_ratio` (defaults to 0), we take the first one (index 0)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s1">&#39;swift/financial_classification:train&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s1">&#39;swift/financial_classification:test&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;dataset[0]: </span><span class="si">{</span><span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;test_dataset[0]: </span><span class="si">{</span><span class="n">test_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; ç‰ˆæƒæ‰€æœ‰ 2024, Ascendã€‚</p>
  </div>

  åˆ©ç”¨ <a href="https://www.sphinx-doc.org/">Sphinx</a> æ„å»ºï¼Œä½¿ç”¨çš„ 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">ä¸»é¢˜</a>
    ç”± <a href="https://readthedocs.org">Read the Docs</a> å¼€å‘.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>