

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../../../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GYMç¯å¢ƒè®­ç»ƒ &mdash; æ˜‡è…¾å¼€æº  æ–‡æ¡£</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/custom.css?v=f2aa3e58" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/sphinx-design.min.css?v=95c83b7e" />

  
      <script src="../../../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../../../_static/documentation_options.js?v=7d86a446"></script>
      <script src="../../../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../../../../../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../../../../../../../_static/package_info.js?v=2b3ed588"></script>
      <script src="../../../../../../../../_static/statistics.js?v=da671b53"></script>
      <script src="../../../../../../../../_static/translations.js?v=beaddf03"></script>
      <script src="../../../../../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="ç´¢å¼•" href="../../../../../../../../genindex.html" />
    <link rel="search" title="æœç´¢" href="../../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../../../index.html" class="icon icon-home">
            æ˜‡è…¾å¼€æº
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="æœç´¢æ–‡æ¡£" aria-label="æœç´¢æ–‡æ¡£" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="å¯¼èˆªèœå•">
              <p class="caption" role="heading"><span class="caption-text">ğŸ å¼€å§‹ä½¿ç”¨</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../ascend/quick_install.html">å¿«é€Ÿå®‰è£…æ˜‡è…¾ç¯å¢ƒ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸ—ï¸  åŸºç¡€è®¾æ–½ä¸æ¡†æ¶</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../accelerate/index.html">Accelerate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../deepspeed/index.html">DeepSpeed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../kernels/index.html">kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../pytorch/index.html">PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../transformers/index.html">Transformers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸ§  è®­ç»ƒä¸å¾®è°ƒæ¡†æ¶</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../LLaMA-Factory/index.html">LLaMA-Factory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../ms-swift/index.html">ms-swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../roll/index.html">ROLL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../torchtitan/index.html">TorchTitan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../trl/index.html">Transformer Reinforcement Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../VeOmni/index.html">VeOmni</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../verl/index.html">verl</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸš€ æ¨ç†ä¸æœåŠ¡</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../llama_cpp/index.html">Llama.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../lm_deploy/index.html">LMDeploy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../onnxruntime/index.html">ONNX Runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../sentence_transformers/index.html">Sentence Transformers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../sglang/index.html">SGLang</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../torchchat/index.html">Torchchat</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸ¨ å¤šæ¨¡æ€ã€åº”ç”¨ä¸è¯„æµ‹</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../Diffusers/index.html">Diffusers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../lm_evaluation/index.html">LM-Evalution-Harness</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../open_clip/index.html">open_clip</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../opencompass/index.html">OpenCompass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../opencv/index.html">OpenCV</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../sd_webui/index.html">Stable-Diffusion-WebUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../timm/index.html">timm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../wenet/index.html">WeNet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../whisper_cpp/index.html">Whisper.cpp</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="ç§»åŠ¨ç‰ˆå¯¼èˆªèœå•" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../../index.html">æ˜‡è…¾å¼€æº</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="é¡µé¢å¯¼èˆª">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">GYMç¯å¢ƒè®­ç»ƒ</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../../../_sources/sources/_generated/sources/ms-swift/source/Instruction/GRPO/DeveloperGuide/gym_env.md.txt" rel="nofollow"> æŸ¥çœ‹é¡µé¢æºç </a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gym">
<h1>GYMç¯å¢ƒè®­ç»ƒ<a class="headerlink" href="#gym" title="Link to this heading">ïƒ</a></h1>
<p><strong>æ³¨æ„</strong> GYMç¯å¢ƒè®­ç»ƒé€»è¾‘å·²åœ¨ ms-swift 3.8 ä¸­è¿›è¡Œé‡æ„ï¼Œå¦‚æœæ‚¨çš„ ms-swift ç‰ˆæœ¬ä½äºè¯¥ç‰ˆæœ¬ï¼Œè¯·å‚è€ƒå¯¹åº”ç‰ˆæœ¬çš„æ–‡æ¡£ã€‚</p>
<section id="id1">
<h2>Gymæ¥å£<a class="headerlink" href="#id1" title="Link to this heading">ïƒ</a></h2>
<p>GYMæºè‡ªäº<a class="reference external" href="https://github.com/openai/gym">OpenAI Gym</a>ï¼Œæ˜¯ä¸€ä¸ªæŠ½è±¡çš„å¼ºåŒ–å­¦ä¹ ç¯å¢ƒæ¥å£ï¼ŒåŸºäºç°åœ¨Model as Agentçš„è¶‹åŠ¿ï¼Œæˆ‘ä»¬åœ¨swiftä¸­å®šä¹‰äº†ç±»ä¼¼çš„ä¸€ä¸ªæ¥å£,ä¸ºAgentæä¾›ç«¯åˆ°ç«¯çš„å¼ºåŒ–å­¦ä¹ è®­ç»ƒã€‚</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Env</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env_config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            env_config: ç¯å¢ƒé…ç½®ï¼Œæ¯”å¦‚å¯ç”¨å·¥å…·ç­‰</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env_config</span> <span class="o">=</span> <span class="n">env_config</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">RolloutInferRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            config: ç¯å¢ƒåˆå§‹åŒ–ä¿¡æ¯ï¼Œåº”è¯¥æ”¾åœ¨</span>

<span class="sd">        Returns:</span>
<span class="sd">            - observation: ç¬¬ä¸€ä¸ªuseræ¶ˆæ¯ä½œä¸ºåˆå§‹è§‚å¯Ÿæˆ–è€…ç¯å¢ƒä¿¡æ¯ï¼Œä¼šä½œä¸ºuser message</span>
<span class="sd">            - info: ç”¨äºDEBUGå’Œæ—¥å¿—çš„é¢å¤–ä¿¡æ¯ï¼Œä¼šåœ¨completions.jsonlä¸­è®°å½•</span>
<span class="sd">            - system_message: ç”¨æˆ·å½“å‰ç¯å¢ƒé‡‡æ ·çš„ç³»ç»Ÿæç¤ºè¯</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">Messages</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            action: æ‰€æœ‰å¯¹è¯æ¶ˆæ¯ï¼Œæœ€åä¸€ä¸ªæ¶ˆæ¯ä¸ºå½“å‰é‡‡æ ·å›å¤</span>

<span class="sd">        Returns:</span>
<span class="sd">            - next_observation: ç¯å¢ƒå“åº”ï¼Œå°†ä½œä¸ºuser messageè¿”å›</span>
<span class="sd">            - reward: å¥–åŠ±</span>
<span class="sd">            - done: æ˜¯å¦ç»“æŸ</span>
<span class="sd">            - info: ç”¨äºDEBUGå’Œæ—¥å¿—çš„é¢å¤–ä¿¡æ¯ï¼Œä¼šåœ¨completions.jsonlä¸­è®°å½•</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean up environment resources.&quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæ ¹æ®<a class="reference external" href="https://moonshotai.github.io/Kimi-Researcher/">Kimi-Reseacherçš„å®è·µ</a>ï¼Œæˆ‘ä»¬è¿˜é¢å¤–æä¾›äº†ä¸€ä¸ª<code class="docutils literal notranslate"><span class="pre">ContextMangaer</span></code>æ¥å£,æ–¹ä¾¿ä½ åŠ¨æ€çš„ç®¡ç†å½“å‰çš„Agentä¸Šä¸‹æ–‡ã€‚</p>
<p><strong>ContextManageræŒ‡å®šï¼ˆéå¿…éœ€ï¼‰</strong></p>
<ol class="simple">
<li><p>åœ¨æ•°æ®é›†ä¸­æä¾› <a class="reference external" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">ctx_config</a> åˆ—ä¸­çš„ name é”®æŒ‡å®šï¼Œ åˆå§‹åŒ–ç›¸å…³çš„å‚æ•°æ”¾åœ¨å…¶ä»–é”®ä¸­</p></li>
<li><p>ä½¿ç”¨å‚æ•° <code class="docutils literal notranslate"><span class="pre">--context_manager</span> <span class="pre">ctx_name</span></code> æŒ‡å®š</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ContextManager</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ctx_config</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctx_config</span> <span class="o">=</span> <span class="n">ctx_config</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">manage_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">history</span><span class="p">:</span> <span class="n">Messages</span><span class="p">,</span><span class="n">trajectory_id</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Messages</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;åŠ¨æ€è°ƒæ•´å½“å‰agentçš„ä¸Šä¸‹æ–‡</span>

<span class="sd">        Args:</span>
<span class="sd">            history: å½“å‰çš„æ¶ˆæ¯å†å²</span>

<span class="sd">        Returns:</span>
<span class="sd">            è°ƒæ•´åçš„æ¶ˆæ¯å†å²</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>å…¥å‚ç¤ºä¾‹</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">infer_request</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">RolloutInferRequest(</span>
<span class="sd">    messages=[</span>
<span class="sd">        {&#39;role&#39;: &#39;system&#39;, &#39;content&#39;: &#39;A conversation between User and Assistant. The user asks a question, and the Assistant solves it. The assistant first thinks about the reasoning process in the mind and then provides the user with the answer. The reasoning process and answer are enclosed within &lt;think&gt; &lt;/think&gt; and &lt;answer&gt; &lt;/answer&gt; tags, respectively, i.e., &lt;think&gt; reasoning process here &lt;/think&gt;&lt;answer&gt; answer here &lt;/answer&gt;\n&#39;}, {&#39;role&#39;: &#39;user&#39;, &#39;content&#39;: &#39;What is the value of $\\sqrt{36 \\times \\sqrt{16}}$?&#39;},</span>
<span class="sd">        {&#39;role&#39;: &#39;assistant&#39;, &#39;content&#39;: &#39;To find the value of \\(\\sqrt{36 \\times \\sqrt{16}}\\), we will break down the problem step-by-step.\n\nFirst, we need to evaluate the inner square root:\n\\[\n\\sqrt{16}\n\\]\nWe know that:\n\\[\n4^2 = 16 \\implies \\sqrt{16} = 4\n\\]\n\nNext, we substitute this result back into the original expression:\n\\[\n\\sqrt{36 \\times \\sqrt{16}} = \\sqrt{36 \\times 4}\n\\]\n\nNow, we need to evaluate the product inside the square root:\n\\[\n36 \\times 4 = 144\n\\]\n\nSo, the expression simplifies to:\n\\[\n\\sqrt{144}\n\\]\n\nFinally, we determine the square root of 144:\n\\[\n\\sqrt{144} = 12\n\\]\n\nThus, the value of \\(\\sqrt{36 \\times \\sqrt{16}}\\) is:\n\\[\n\\boxed{12}\n\\]&#39;}</span>
<span class="sd">    ],</span>
<span class="sd">    images=[],</span>
<span class="sd">    audios=[],</span>
<span class="sd">    videos=[],</span>
<span class="sd">    tools=None,</span>
<span class="sd">    objects={},</span>
<span class="sd">    data_dict={</span>
<span class="sd">        &#39;problem&#39;: &#39;What is the value of $\\sqrt{36 \\times \\sqrt{16}}$?&#39;,</span>
<span class="sd">        &#39;solution&#39;: &quot;To solve the problem, we need to evaluate the expression \\(\\sqrt{36 \\times \\sqrt{16}}\\).\n\nWe can break down the steps as follows:\n\n1. Evaluate the inner square root: \\(\\sqrt{16}\\).\n2. Multiply the result by 36.\n3. Take the square root of the product obtained in step 2.\n\nLet&#39;s compute this step by step using Python code for accuracy.\n```python\nimport math\n\n# Step 1: Evaluate the inner square root\ninner_sqrt = math.sqrt(16)\n\n# Step 2: Multiply the result by 36\nproduct = 36 * inner_sqrt\n\n# Step 3: Take the square root of the product\nfinal_result = math.sqrt(product)\nprint(final_result)\n```\n```output\n12.0\n```\nThe value of \\(\\sqrt{36 \\times \\sqrt{16}}\\) is /\\(\\boxed{12}\\).&quot;</span>
<span class="sd">        }</span>
<span class="sd">    )</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">result</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">RolloutResponseChoice(</span>
<span class="sd">    index=0,</span>
<span class="sd">    message=ChatMessage(</span>
<span class="sd">        role=&#39;assistant&#39;,</span>
<span class="sd">        content=&#39;To find the value of \\(\\sqrt{36 \\times \\sqrt{16}}\\), we will break down the problem step-by-step.\n\nFirst, we need to evaluate the inner square root:\n\\[\n\\sqrt{16}\n\\]\nWe know that:\n\\[\n4^2 = 16 \\implies \\sqrt{16} = 4\n\\]\n\nNext, we substitute this result back into the original expression:\n\\[\n\\sqrt{36 \\times \\sqrt{16}} = \\sqrt{36 \\times 4}\n\\]\n\nNow, we need to evaluate the product inside the square root:\n\\[\n36 \\times 4 = 144\n\\]\n\nSo, the expression simplifies to:\n\\[\n\\sqrt{144}\n\\]\n\nFinally, we determine the square root of 144:\n\\[\n\\sqrt{144} = 12\n\\]\n\nThus, the value of \\(\\sqrt{36 \\times \\sqrt{16}}\\) is:\n\\[\n\\boxed{12}\n\\]&#39;, tool_calls=None),</span>
<span class="sd">        finish_reason=&#39;stop&#39;,</span>
<span class="sd">        logprobs=None,</span>
<span class="sd">        messages=None)</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>GYMç¯å¢ƒè®­ç»ƒå¯ä»¥è§†ä½œä¸€ç§ç‰¹æ®Šçš„å¤šè½®è®­ç»ƒï¼ŒåŒºåˆ«åœ¨äºä½¿ç”¨GYMç¯å¢ƒè®­ç»ƒï¼Œå¥–åŠ±ä¿¡æ¯é€šè¿‡ç¯å¢ƒç›´æ¥è·å–ã€‚</p>
<p>åœ¨ <code class="docutils literal notranslate"><span class="pre">rollout</span></code> å‘½ä»¤ä¸­ä½¿ç”¨å‚æ•° <code class="docutils literal notranslate"><span class="pre">use_gym_env</span></code> æ¥æŒ‡å®šä½¿ç”¨gymä½œä¸ºè®­ç»ƒçš„ç¯å¢ƒæ¥å£ã€‚æˆ‘ä»¬æä¾›äº†å…¼å®¹GYMç¯å¢ƒçš„å¤šè½®è§„åˆ’å™¨å‚è€ƒå®ç°ï¼Œè§<a class="reference external" href="https://github.com/modelscope/ms-swift/blob/main/swift/rollout/multi_turn.py">å†…ç½®å¤šè½®è°ƒåº¦å™¨å®ç°</a>ä¸­çš„ GymScheduler ç±»</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
swift<span class="w"> </span>rollout<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--model<span class="w"> </span>xxx<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--use_gym_env<span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--multi_turn_scheduler<span class="w"> </span>gym_scheduler<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--max_turns<span class="w"> </span>xxx
</pre></div>
</div>
<blockquote>
<div><p>æ³¨æ„</p>
</div></blockquote>
<p><strong>ç¯å¢ƒé€‰æ‹©</strong></p>
<ol class="simple">
<li><p>åœ¨æ•°æ®é›†ä¸­éœ€è¦æä¾› <a class="reference external" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">env_config</a> åˆ—ä¸­çš„nameé”®æŒ‡å®š, åˆå§‹åŒ–ç›¸å…³çš„å‚æ•°æ”¾åœ¨å…¶ä»–é”®ä¸­</p></li>
<li><p>ä½¿ç”¨å‚æ•° <code class="docutils literal notranslate"><span class="pre">--gym_env</span> <span class="pre">env_name</span></code> æŒ‡å®š</p></li>
</ol>
</section>
<section id="id2">
<h2>æœ€ä½³å®è·µ<a class="headerlink" href="#id2" title="Link to this heading">ïƒ</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="../../../../../examples/train/grpo/external/vllm_gym.sh">è®­ç»ƒè„šæœ¬</a></p></li>
</ul>
<p>é€šè¿‡å‚æ•°<code class="docutils literal notranslate"><span class="pre">external_plugins</span></code>, æˆ‘ä»¬å¯ä»¥å°†æœ¬åœ°çš„<code class="docutils literal notranslate"><span class="pre">Env</span></code>å’Œ<code class="docutils literal notranslate"><span class="pre">ContextManager</span></code>æ³¨å†Œè¿› ms-swift ä¸­ï¼Œå…·ä½“å®ç°å‚è€ƒ<a class="reference external" href="https://github.com/modelscope/ms-swift/blob/main/examples/train/grpo/plugin/plugin.py">ä»£ç </a></p>
</section>
<section id="id3">
<h2>æ³¨æ„äº‹é¡¹<a class="headerlink" href="#id3" title="Link to this heading">ïƒ</a></h2>
<ol class="simple">
<li><p>å‚è€ƒè®­ç»ƒæ•°æ®æ ¼å¼</p></li>
</ol>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;messages&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;system&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ä½ æ˜¯ä¸ªæœ‰ç”¨æ— å®³çš„åŠ©æ‰‹&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;å‘Šè¯‰æˆ‘æ˜å¤©çš„å¤©æ°”&quot;</span><span class="p">}],</span><span class="nt">&quot;env_config&quot;</span><span class="p">:{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;custom_env&quot;</span><span class="p">,</span><span class="nt">&quot;other_config&quot;</span><span class="p">:</span><span class="s2">&quot;xxxx&quot;</span><span class="p">},</span><span class="nt">&quot;ctx_config&quot;</span><span class="p">:{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;custom_ctx&quot;</span><span class="p">,</span><span class="nt">&quot;other_config&quot;</span><span class="p">:</span><span class="s2">&quot;xxxx&quot;</span><span class="p">}}</span>
</pre></div>
</div>
<ol class="simple">
<li><p>é»˜è®¤ä»…å¯¹æœ€åä¸€è½®responseè¿›è¡Œè®­ç»ƒï¼Œå¦‚æœgymæ¶‰åŠåˆ°å¤šè½®responseç”Ÿæˆï¼Œä½¿ç”¨å‚æ•°<code class="docutils literal notranslate"><span class="pre">--loss_scale</span> <span class="pre">default</span></code>å¯¹æ‰€æœ‰è½®æ¬¡çš„responseè¿›è¡Œè®­ç»ƒï¼Œå…·ä½“å‚è€ƒ<a class="reference external" href="./multi_turn.md#%E6%8D%9F%E5%A4%B1%E6%8E%A9%E7%A0%81">æ–‡æ¡£</a></p></li>
<li><p>æ•°æ®æµç¨‹
æ•´ä¸ªgymæ•°æ®æµç¨‹å¦‚ä¸‹:</p></li>
</ol>
<img src="https://raw.githubusercontent.com/modelscope/ms-swift/main/docs/resources/gym_env.png" width="250" /><ol class="simple">
<li><p>å¥–åŠ±æ—¥å¿—
ç”±äºgymçš„å¥–åŠ±æ˜¯åœ¨stepå‡½æ•°å†…è®¡ç®—å®Œæˆï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨é€šè¿‡<code class="docutils literal notranslate"><span class="pre">info</span></code>è¿”å›æ—¥å¿—ï¼Œæœ€ç»ˆçš„è®°å½•ä¼šæ”¾åœ¨completions.jsonlä¸­çš„<code class="docutils literal notranslate"><span class="pre">trajectory_infos</span></code>å­—æ®µ.</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; ç‰ˆæƒæ‰€æœ‰ 2024, Ascendã€‚</p>
  </div>

  åˆ©ç”¨ <a href="https://www.sphinx-doc.org/">Sphinx</a> æ„å»ºï¼Œä½¿ç”¨çš„ 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">ä¸»é¢˜</a>
    ç”± <a href="https://readthedocs.org">Read the Docs</a> å¼€å‘.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>