

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../../../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¥–åŠ±å‡½æ•° &mdash; æ˜‡è…¾å¼€æº  æ–‡æ¡£</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/custom.css?v=f2aa3e58" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/sphinx-design.min.css?v=95c83b7e" />

  
      <script src="../../../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../../../_static/documentation_options.js?v=7d86a446"></script>
      <script src="../../../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../../../../../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../../../../../../../_static/package_info.js?v=2b3ed588"></script>
      <script src="../../../../../../../../_static/statistics.js?v=da671b53"></script>
      <script src="../../../../../../../../_static/translations.js?v=beaddf03"></script>
      <script src="../../../../../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="ç´¢å¼•" href="../../../../../../../../genindex.html" />
    <link rel="search" title="æœç´¢" href="../../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../../../index.html" class="icon icon-home">
            æ˜‡è…¾å¼€æº
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="æœç´¢æ–‡æ¡£" aria-label="æœç´¢æ–‡æ¡£" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="å¯¼èˆªèœå•">
              <p class="caption" role="heading"><span class="caption-text">ğŸ å¼€å§‹ä½¿ç”¨</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../ascend/quick_install.html">å¿«é€Ÿå®‰è£…æ˜‡è…¾ç¯å¢ƒ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸ—ï¸  åŸºç¡€è®¾æ–½ä¸æ¡†æ¶</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../accelerate/index.html">Accelerate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../deepspeed/index.html">DeepSpeed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../kernels/index.html">kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../pytorch/index.html">PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../transformers/index.html">Transformers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸ§  è®­ç»ƒä¸å¾®è°ƒæ¡†æ¶</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../LLaMA-Factory/index.html">LLaMA-Factory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../ms-swift/index.html">ms-swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../roll/index.html">ROLL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../torchtitan/index.html">TorchTitan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../trl/index.html">Transformer Reinforcement Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../VeOmni/index.html">VeOmni</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../verl/index.html">verl</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸš€ æ¨ç†ä¸æœåŠ¡</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../llama_cpp/index.html">Llama.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../lm_deploy/index.html">LMDeploy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../onnxruntime/index.html">ONNX Runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../sentence_transformers/index.html">Sentence Transformers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../sglang/index.html">SGLang</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../torchchat/index.html">Torchchat</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸ¨ å¤šæ¨¡æ€ã€åº”ç”¨ä¸è¯„æµ‹</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../Diffusers/index.html">Diffusers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../lm_evaluation/index.html">LM-Evalution-Harness</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../open_clip/index.html">open_clip</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../opencompass/index.html">OpenCompass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../opencv/index.html">OpenCV</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../sd_webui/index.html">Stable-Diffusion-WebUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../timm/index.html">timm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../wenet/index.html">WeNet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../whisper_cpp/index.html">Whisper.cpp</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="ç§»åŠ¨ç‰ˆå¯¼èˆªèœå•" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../../index.html">æ˜‡è…¾å¼€æº</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="é¡µé¢å¯¼èˆª">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">å¥–åŠ±å‡½æ•°</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../../../_sources/sources/_generated/sources/ms-swift/source/Instruction/GRPO/DeveloperGuide/reward_function.md.txt" rel="nofollow"> æŸ¥çœ‹é¡µé¢æºç </a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1>å¥–åŠ±å‡½æ•°<a class="headerlink" href="#id1" title="Link to this heading">ïƒ</a></h1>
<section id="id2">
<h2>è‡ªå®šä¹‰å¥–åŠ±å‡½æ•°<a class="headerlink" href="#id2" title="Link to this heading">ïƒ</a></h2>
<p>å¥–åŠ±å‡½æ•°æ¥å—æ¨¡å‹ç”Ÿæˆçš„æ–‡æœ¬ completions å…¶ä»–æ•°æ®é›†ä¸­çš„åˆ—ä»¥åŠè®­ç»ƒå™¨çŠ¶æ€ä½œä¸ºå‚æ•°(kwargs)è¿›è¡Œæ‰“åˆ†, å…¶ä¸­<a class="reference external" href="https://huggingface.co/docs/transformers/main/main_classes/callback#transformers.TrainerState">è®­ç»ƒå™¨çŠ¶æ€</a>åŒ…å«è®­ç»ƒçš„æ­¥æ•°ç­‰ä¿¡æ¯ã€‚</p>
<p>æ³¨æ„ï¼šæ¨¡å‹è¾“å…¥ç›¸å…³çš„åˆ—ï¼ˆæ¯”å¦‚queryï¼Œresponseï¼‰ä¼šè¢«å¤„ç†ä¸º messages é”®ï¼ŒåŸæ•°æ®é›†ä¸­çš„ assistant response ä¼šè¢«èˆå¼ƒï¼Œè¯·ä½¿ç”¨é¢å¤–çš„åˆ—è¿›è¡Œä¿ç•™ã€‚
ç›¸å…³å¤„ç†çš„åˆ—åå‚è€ƒ<a class="reference external" href="../../../Customization/Custom-dataset.md#query-response%E6%A0%BC%E5%BC%8F">æ–‡æ¡£</a></p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„é•¿åº¦å¥–åŠ±å‡½æ•°ã€‚è¯¥å‡½æ•°ä¼šåœ¨æ¨¡å‹ç”Ÿæˆçš„æ–‡æœ¬é•¿åº¦è¶…è¿‡ 1024 æ—¶ï¼Œç»™äºˆ 1.0 çš„å¥–åŠ±ä¿¡å·ï¼›å¦åˆ™ï¼Œå¥–åŠ±ä¿¡å·ä¸º 0.0ã€‚</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">swift.rewards</span><span class="w"> </span><span class="kn">import</span> <span class="n">ORM</span><span class="p">,</span> <span class="n">orms</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DummyLengthRewardFunction</span><span class="p">(</span><span class="n">ORM</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">completions</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="mf">1.0</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">completion</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1024</span> <span class="k">else</span> <span class="mf">0.0</span> <span class="k">for</span> <span class="n">completion</span> <span class="ow">in</span> <span class="n">completions</span><span class="p">]</span>

<span class="n">orms</span><span class="p">[</span><span class="s1">&#39;dummy&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">DummyLengthRewardFunction</span>
</pre></div>
</div>
<p><strong>è·å–æ•°æ®é›†ä¸­çš„å…¶ä»–åˆ—</strong></p>
<p>æ¯”å¦‚å¥–åŠ±å‡½æ•°éœ€è¦è·å–æ•°æ®é›†<code class="docutils literal notranslate"><span class="pre">solution</span></code>åˆ—ã€å½“å‰è®­ç»ƒæ­¥æ•°å’Œæ€»æ­¥æ•°ä½œä¸ºè¾…åŠ©è®¡ç®—ï¼Œä»¥ä¸‹æ˜¯ä¸¤ç§è·å–æ–¹å¼</p>
<p>ç¬¬ä¸€ç§ï¼šåœ¨__call__å…¥å‚ä¸­æ˜¾å¼å®šä¹‰åˆ—å</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">completions</span><span class="p">,</span> <span class="n">solution</span><span class="p">,</span> <span class="n">trainer_state</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>
        <span class="n">global_step</span> <span class="o">=</span> <span class="n">trainer_state</span><span class="o">.</span><span class="n">global_step</span>
        <span class="n">max_steps</span> <span class="o">=</span> <span class="n">trainer_state</span><span class="o">.</span><span class="n">max_steps</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>ç¬¬äºŒç§ï¼šåœ¨kwargsä¸­è·å–</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="n">completions</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;solution&#39;</span><span class="p">)</span>
        <span class="n">trainer_state</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;trainer_state&#39;</span><span class="p">)</span>
        <span class="n">global_step</span> <span class="o">=</span> <span class="n">trainer_state</span><span class="o">.</span><span class="n">global_step</span>
        <span class="n">max_steps</span> <span class="o">=</span> <span class="n">trainer_state</span><span class="o">.</span><span class="n">max_steps</span>
        <span class="o">...</span>
</pre></div>
</div>
<p><strong>ä½¿ç”¨è‡ªå®šä¹‰å¥–åŠ±å‡½æ•°</strong></p>
<p>å¯ä»¥åœ¨<code class="docutils literal notranslate"><span class="pre">swift/examples/train/grpo/plugin/plugin.py</span></code>ä¸­åŠ å…¥è¯¥å¥–åŠ±å‡½æ•°ï¼Œä½¿ç”¨å‚æ•°<code class="docutils literal notranslate"><span class="pre">--external_plugins</span> <span class="pre">examples/train/grpo/plugin/plugin.py</span></code>è¿›è¡Œæ³¨å†Œï¼Œå¹¶é€šè¿‡ reward_funcs å‚æ•°è¿›è¡ŒæŒ‡å®š</p>
<p>æ‰§è¡Œè„šæœ¬å‚è€ƒ<a class="reference external" href="https://github.com/modelscope/ms-swift/tree/main/examples/train/grpo/plugin/run_external_reward_func.sh">è¿™é‡Œ</a></p>
</section>
<section id="id3">
<h2>å¼‚æ­¥å¥–åŠ±å‡½æ•°<a class="headerlink" href="#id3" title="Link to this heading">ïƒ</a></h2>
<p><strong>ç‰ˆæœ¬ä¾èµ–</strong>ï¼šms-swift&gt;=3.12.1</p>
<p>å¯¹äºæ¶‰åŠ I/O æ“ä½œçš„å¥–åŠ±å‡½æ•°ï¼ˆå¦‚ API è°ƒç”¨ã€æ•°æ®åº“æŸ¥è¯¢ç­‰ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨å¼‚æ­¥ï¼ˆasyncï¼‰å¥–åŠ±å‡½æ•°æ¥æé«˜æ€§èƒ½ã€‚å¼‚æ­¥å¥–åŠ±å‡½æ•°ä½¿ç”¨ <code class="docutils literal notranslate"><span class="pre">asyncio.gather</span></code> å¹¶è¡Œæ‰§è¡Œï¼Œå¯ä»¥æ˜¾è‘—åŠ é€Ÿå¥–åŠ±è®¡ç®—ã€‚</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">swift.rewards</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncORM</span><span class="p">,</span> <span class="n">orms</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

<span class="k">class</span><span class="w"> </span><span class="nc">AsyncAPIReward</span><span class="p">(</span><span class="n">AsyncORM</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">completions</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">aiohttp</span>

        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">score_single</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s1">&#39;https://api.example.com/score&#39;</span><span class="p">,</span>
                <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">text</span><span class="p">}</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span>

        <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="c1"># ä½¿ç”¨ asyncio.gather å¹¶è¡Œå‘é€æ‰€æœ‰è¯·æ±‚</span>
            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">score_single</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">completions</span><span class="p">]</span>
            <span class="n">rewards</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">rewards</span><span class="p">)</span>

<span class="n">orms</span><span class="p">[</span><span class="s1">&#39;async_api&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AsyncAPIReward</span>
</pre></div>
</div>
<p>swift æ”¯æŒåŒæ—¶ä½¿ç”¨åŒæ­¥å’Œå¼‚æ­¥å¥–åŠ±å‡½æ•°ã€‚è®­ç»ƒå™¨ä¼šè‡ªåŠ¨æ£€æµ‹å¥–åŠ±å‡½æ•°çš„ç±»å‹ï¼š</p>
<ul class="simple">
<li><p>åŒæ­¥å¥–åŠ±å‡½æ•°æŒ‰é¡ºåºæ‰§è¡Œ</p></li>
<li><p>å¼‚æ­¥å¥–åŠ±å‡½æ•°ä½¿ç”¨ <code class="docutils literal notranslate"><span class="pre">asyncio.gather</span></code> å¹¶è¡Œæ‰§è¡Œ</p></li>
</ul>
<p><a class="reference external" href="https://github.com/modelscope/ms-swift/blob/main/examples/train/grpo/plugin/plugin.py">plugin</a>æ–‡ä»¶ä¸­æä¾›äº†ä¸€ä¸ªè°ƒç”¨<code class="docutils literal notranslate"><span class="pre">swift</span> <span class="pre">deploy</span></code>æœåŠ¡çš„ç”Ÿæˆå¼å¥–åŠ±æ¨¡å‹çš„ä¾‹å­(async_genrm)</p>
</section>
<section id="id4">
<h2>å†…ç½®å¥–åŠ±å‡½æ•°<a class="headerlink" href="#id4" title="Link to this heading">ïƒ</a></h2>
<p>swiftå†…ç½®äº†äº”ç§åŸºäºè§„åˆ™çš„å¥–åŠ±å‡½æ•°(ä»£ç è§swift/rewards/orm.py)</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>å¥–åŠ±å‡½æ•°</th>
<th>è®ºæ–‡</th>
</tr>
</thead>
<tbody>
<tr>
<td>accuracy</td>
<td><a href="https://arxiv.org/abs/2501.12948">DeepSeek-R1: Incentivizing Reasoning Capability in LLMs via RL</a></td>
</tr>
<tr>
<td>format</td>
<td>åŒä¸Š</td>
</tr>
<tr>
<td>cosine</td>
<td><a href="https://arxiv.org/abs/2502.03373">Demystifying Long Chain-of-Thought Reasoning in LLMs</a></td>
</tr>
<tr>
<td>repetition</td>
<td>åŒä¸Š</td>
</tr>
<tr>
<td>soft_overlong</td>
<td><a href="https://arxiv.org/abs/2503.14476">Decoupled Clip and Dynamic sAmpling Policy Optimization (DAPO)</a></td>
</tr>
</tbody>
</table><section id="accuracy">
<h3>1. <strong>accuracy</strong><a class="headerlink" href="#accuracy" title="Link to this heading">ïƒ</a></h3>
<p>è¯¥å‡½æ•°å°†æ¨¡å‹çš„ç”Ÿæˆç»“æœä¸æ•°æ®é›†ä¸­çš„ solution åˆ—è¿›è¡Œæ¯”è¾ƒï¼Œè®¡ç®—å‡†ç¡®ç‡åˆ†æ•°ã€‚å¦‚æœç”Ÿæˆç»“æœä¸æ ‡å‡†ç­”æ¡ˆä¸€è‡´ï¼Œåˆ™å¾—åˆ†ä¸º 1.0ï¼›å¦åˆ™ä¸º 0.0ã€‚</p>
<p>æ³¨æ„ï¼šè¯¥å¥–åŠ±å‡½æ•°ä½¿ç”¨<code class="docutils literal notranslate"><span class="pre">math_verify</span></code>åº“è§£æç”Ÿæˆç»“æœå’Œsolutionä¸­çš„ç­”æ¡ˆï¼Œå¯èƒ½åªé€‚ç”¨äºç‰¹å®šçš„æ•°å­¦æ•°æ®é›†ã€‚</p>
</section>
<section id="format">
<h3>2. <strong>format</strong><a class="headerlink" href="#format" title="Link to this heading">ïƒ</a></h3>
<p>è®ºæ–‡ä¸­ä½¿ç”¨ä»¥ä¸‹system promptè¦æ±‚æ¨¡å‹æŒ‰ç…§å›ºå®šæ ¼å¼è¿›è¡Œè¿”å›</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="n">conversation</span> <span class="n">between</span> <span class="n">User</span> <span class="ow">and</span> <span class="n">Assistant</span><span class="o">.</span> <span class="n">The</span> <span class="n">user</span> <span class="n">asks</span> <span class="n">a</span> <span class="n">question</span><span class="p">,</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">Assistant</span> <span class="n">solves</span> <span class="n">it</span><span class="o">.</span> <span class="n">The</span> <span class="n">assistant</span> <span class="n">first</span> <span class="n">thinks</span> <span class="n">about</span> <span class="n">the</span> <span class="n">reasoning</span> <span class="n">process</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">mind</span> <span class="ow">and</span> <span class="n">then</span> <span class="n">provides</span> <span class="n">the</span> <span class="n">user</span> <span class="k">with</span> <span class="n">the</span> <span class="n">answer</span><span class="o">.</span> <span class="n">The</span> <span class="n">reasoning</span> <span class="n">process</span> <span class="ow">and</span> <span class="n">answer</span> <span class="n">are</span> <span class="n">enclosed</span> <span class="n">within</span> <span class="o">&lt;</span><span class="n">think</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">think</span><span class="o">&gt;</span> <span class="ow">and</span> <span class="o">&lt;</span><span class="n">answer</span><span class="o">&gt;</span> <span class="o">&lt;/</span><span class="n">answer</span><span class="o">&gt;</span> <span class="n">tags</span><span class="p">,</span> <span class="n">respectively</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">think</span><span class="o">&gt;</span> <span class="n">reasoning</span> <span class="n">process</span> <span class="n">here</span> <span class="o">&lt;/</span><span class="n">think</span><span class="o">&gt;&lt;</span><span class="n">answer</span><span class="o">&gt;</span> <span class="n">answer</span> <span class="n">here</span> <span class="o">&lt;/</span><span class="n">answer</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>è¯¥å‡½æ•°æ£€æŸ¥æ¨¡å‹æ˜¯å¦æŒ‰ç…§ <code class="docutils literal notranslate"><span class="pre">&lt;think&gt;think</span> <span class="pre">content&lt;/think&gt;&lt;answer&gt;answer</span> <span class="pre">content&lt;/answer&gt;</span></code> çš„æ ¼å¼è¿›è¡Œç”Ÿæˆã€‚å¦‚æœç”Ÿæˆæ–‡æœ¬ç¬¦åˆæ ¼å¼è¦æ±‚ï¼Œåˆ™å¾—åˆ†ä¸º 1.0ï¼›å¦åˆ™ä¸º 0.0ã€‚</p>
</section>
<section id="cosine">
<h3>3. <strong>cosine</strong><a class="headerlink" href="#cosine" title="Link to this heading">ïƒ</a></h3>
<p>è®ºæ–‡å‘ç°ï¼Œä»…ä½¿ç”¨ accuracy å¥–åŠ±å‡½æ•°è¿›è¡Œè®­ç»ƒä¼šå¯¼è‡´æ¨¡å‹çš„ç”Ÿæˆé•¿åº¦è¶‹äºè¶…é•¿ï¼Œä»è€Œå½±å“è®­ç»ƒæ•ˆæœã€‚cosine å¥–åŠ±å‡½æ•°é€šè¿‡æ§åˆ¶æ¨¡å‹çš„ç”Ÿæˆé•¿åº¦æ¥ä¼˜åŒ–è®­ç»ƒè¿‡ç¨‹ï¼š</p>
<ul class="simple">
<li><p>å¯¹äºç”Ÿæˆæ­£ç¡®ç­”æ¡ˆçš„æ–‡æœ¬ï¼Œå¥–åŠ±å€¼éšé•¿åº¦å¢åŠ è€Œé€’å‡ï¼Œé¼“åŠ±æ¨¡å‹ç”Ÿæˆç®€æ´çš„å›ç­”ã€‚</p></li>
<li><p>å¯¹äºç”Ÿæˆé”™è¯¯ç­”æ¡ˆçš„æ–‡æœ¬ï¼Œå¥–åŠ±å€¼éšé•¿åº¦å¢åŠ è€Œé€’å¢ï¼Œé¼“åŠ±æ¨¡å‹è¿›è¡Œæ›´æ·±å…¥çš„æ€è€ƒã€‚</p></li>
</ul>
<p>ä½¿ç”¨ä½™å¼¦å‡½æ•°å¹³æ»‘åœ°è°ƒæ•´å¥–åŠ±å€¼ï¼Œç¡®ä¿å¥–åŠ±å˜åŒ–åœ¨åˆç†èŒƒå›´å†…ã€‚ä½™å¼¦å‡½æ•°çš„å‚æ•°åŒ…æ‹¬ç”Ÿæˆæ–‡æœ¬çš„é•¿åº¦ã€æœ€å¤§é•¿åº¦é™åˆ¶ä»¥åŠå¥–åŠ±çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ã€‚</p>
<p>å‚æ•°</p>
<ul class="simple">
<li><p>cosine_min_len_value_wrongï¼ˆé»˜è®¤å€¼ï¼š-0.5ï¼‰ï¼šç”Ÿæˆé”™è¯¯ç­”æ¡ˆæ—¶ï¼Œæœ€å°é•¿åº¦å¯¹åº”çš„å¥–åŠ±å€¼ã€‚</p></li>
<li><p>cosine_max_len_value_wrongï¼ˆé»˜è®¤å€¼ï¼š0.0ï¼‰ï¼šç”Ÿæˆé”™è¯¯ç­”æ¡ˆæ—¶ï¼Œæœ€å¤§é•¿åº¦å¯¹åº”çš„å¥–åŠ±å€¼ã€‚</p></li>
<li><p>cosine_min_len_value_correctï¼ˆé»˜è®¤å€¼ï¼š1.0ï¼‰ï¼šç”Ÿæˆæ­£ç¡®ç­”æ¡ˆæ—¶ï¼Œæœ€å°é•¿åº¦å¯¹åº”çš„å¥–åŠ±å€¼ã€‚</p></li>
<li><p>cosine_max_len_value_correctï¼ˆé»˜è®¤å€¼ï¼š0.5ï¼‰ï¼šç”Ÿæˆæ­£ç¡®ç­”æ¡ˆæ—¶ï¼Œæœ€å¤§é•¿åº¦å¯¹åº”çš„å¥–åŠ±å€¼ã€‚</p></li>
<li><p>cosine_max_lenï¼ˆé»˜è®¤å€¼ç­‰äºæ¨¡å‹ç”Ÿæˆçš„æœ€å¤§ç¨‹åº¦ï¼‰ï¼šç”Ÿæˆæ–‡æœ¬çš„æœ€å¤§é•¿åº¦é™åˆ¶ã€‚</p></li>
</ul>
</section>
<section id="repetition">
<h3>4. <strong>repetition</strong><a class="headerlink" href="#repetition" title="Link to this heading">ïƒ</a></h3>
<p>æƒ©ç½šæ¨¡å‹ç”Ÿæˆæ–‡æœ¬ä¸­çš„é‡å¤å†…å®¹ï¼Œé€šè¿‡æ£€æµ‹ç”Ÿæˆæ–‡æœ¬ä¸­çš„é‡å¤ n-gram æ¨¡å¼æ¥è¯„ä¼°é‡å¤ç¨‹åº¦ï¼Œå¹¶ç»™äºˆç›¸åº”çš„æƒ©ç½šã€‚</p>
<p>å‡½æ•°å°†ç”Ÿæˆæ–‡æœ¬åˆ†å‰²ä¸ºå•è¯ï¼Œå¹¶æå–æŒ‡å®šå¤§å°çš„ n-gramï¼ˆé»˜è®¤ä¸º 3-gramï¼‰ã€‚é€šè¿‡ç»Ÿè®¡ä¸åŒ n-gram çš„æ•°é‡ä¸æ€» n-gram æ•°é‡çš„æ¯”ä¾‹ï¼Œè®¡ç®—é‡å¤æ¯”ä¾‹ã€‚å¦‚æœç”Ÿæˆæ–‡æœ¬ä¸­é‡å¤çš„ n-gram æ¯”ä¾‹è¾ƒé«˜ï¼Œåˆ™ç»™äºˆè¾ƒå¤§çš„è´Ÿå¥–åŠ±ï¼ˆæƒ©ç½šï¼‰ã€‚æƒ©ç½šå€¼é€šè¿‡é‡å¤æ¯”ä¾‹å’Œæœ€å¤§æƒ©ç½šå€¼ï¼ˆé»˜è®¤ä¸º -1.0ï¼‰è®¡ç®—å¾—å‡ºã€‚</p>
<p>å‚æ•°</p>
<ul class="simple">
<li><p>repetition_n_gramsï¼ˆé»˜è®¤å€¼ï¼š3ï¼‰ï¼šç”¨äºæ£€æµ‹é‡å¤çš„ n-gram å¤§å°ã€‚</p></li>
<li><p>repetition_max_penaltyï¼ˆé»˜è®¤å€¼ï¼š-1.0ï¼‰ï¼šæœ€å¤§æƒ©ç½šå€¼ï¼Œç”¨äºæ§åˆ¶æƒ©ç½šçš„å¼ºåº¦ã€‚</p></li>
</ul>
</section>
<section id="soft-overlong-punishment">
<h3>5. <strong>soft overlong punishment</strong><a class="headerlink" href="#soft-overlong-punishment" title="Link to this heading">ïƒ</a></h3>
<p>å®šä¹‰é•¿åº¦æƒ©ç½šåŒºé—´ã€‚åœ¨è¿™ä¸ªåŒºé—´å†…ï¼Œç»™äºˆ[-1,0]çš„çº¿æ€§æƒ©ç½šã€‚</p>
<p>å‚æ•°</p>
<ul class="simple">
<li><p>soft_max_length: è®ºæ–‡ä¸­çš„L_maxï¼Œæ¨¡å‹çš„æœ€å¤§ç”Ÿæˆé•¿åº¦ï¼Œé»˜è®¤ç­‰äºmax_completion_length</p></li>
<li><p>soft_cache_length: è®ºæ–‡ä¸­çš„L_cacheï¼Œæ§åˆ¶é•¿åº¦æƒ©ç½šåŒºé—´ï¼ŒåŒºé—´ä¸º[soft_max_length-soft_cache_length, soft_max_length]</p></li>
</ul>
</section>
</section>
<section id="id5">
<h2>æ³¨æ„äº‹é¡¹<a class="headerlink" href="#id5" title="Link to this heading">ïƒ</a></h2>
<p>å¦‚æœéœ€è¦åœ¨å¥–åŠ±å‡½æ•°ä¸­åŠ è½½æ¨¡å‹ï¼Œé»˜è®¤ä¼šä½¿ç”¨è®­ç»ƒçš„ deepspeed æ’ä»¶ï¼ˆtransformersé€»è¾‘ï¼‰ï¼Œzero3ä¸‹å¯èƒ½ä¼šå¯¼è‡´æ¨¡å‹æ— æ³•æ­£å¸¸æ¨ç†ï¼Œå‚è€ƒè¯¥<a class="reference external" href="https://github.com/modelscope/ms-swift/issues/4580">issue</a>æ¥è·³è¿‡ deepspeed åˆå§‹åŒ–ç¯å¢ƒ</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; ç‰ˆæƒæ‰€æœ‰ 2024, Ascendã€‚</p>
  </div>

  åˆ©ç”¨ <a href="https://www.sphinx-doc.org/">Sphinx</a> æ„å»ºï¼Œä½¿ç”¨çš„ 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">ä¸»é¢˜</a>
    ç”± <a href="https://readthedocs.org">Read the Docs</a> å¼€å‘.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>