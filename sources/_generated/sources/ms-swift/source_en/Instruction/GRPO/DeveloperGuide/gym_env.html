

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../../../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GYM Environment Training &mdash; æ˜‡è…¾å¼€æº  æ–‡æ¡£</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/custom.css?v=f2aa3e58" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../_static/sphinx-design.min.css?v=95c83b7e" />

  
      <script src="../../../../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../../../../_static/documentation_options.js?v=7d86a446"></script>
      <script src="../../../../../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../../../../../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../../../../../../../_static/package_info.js?v=2b3ed588"></script>
      <script src="../../../../../../../../_static/statistics.js?v=da671b53"></script>
      <script src="../../../../../../../../_static/translations.js?v=beaddf03"></script>
      <script src="../../../../../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../../../../../../../_static/js/theme.js"></script>
    <link rel="index" title="ç´¢å¼•" href="../../../../../../../../genindex.html" />
    <link rel="search" title="æœç´¢" href="../../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../../../index.html" class="icon icon-home">
            æ˜‡è…¾å¼€æº
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="æœç´¢æ–‡æ¡£" aria-label="æœç´¢æ–‡æ¡£" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="å¯¼èˆªèœå•">
              <p class="caption" role="heading"><span class="caption-text">ğŸ å¼€å§‹ä½¿ç”¨</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../ascend/quick_install.html">å¿«é€Ÿå®‰è£…æ˜‡è…¾ç¯å¢ƒ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸ—ï¸  åŸºç¡€è®¾æ–½ä¸æ¡†æ¶</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../accelerate/index.html">Accelerate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../deepspeed/index.html">DeepSpeed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../kernels/index.html">kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../pytorch/index.html">PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../transformers/index.html">Transformers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸ§  è®­ç»ƒä¸å¾®è°ƒæ¡†æ¶</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../LLaMA-Factory/index.html">LLaMA-Factory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../ms-swift/index.html">ms-swift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../roll/index.html">ROLL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../torchtitan/index.html">TorchTitan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../trl/index.html">Transformer Reinforcement Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../VeOmni/index.html">VeOmni</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../verl/index.html">verl</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸš€ æ¨ç†ä¸æœåŠ¡</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../llama_cpp/index.html">Llama.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../lm_deploy/index.html">LMDeploy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../onnxruntime/index.html">ONNX Runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../sentence_transformers/index.html">Sentence Transformers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../sglang/index.html">SGLang</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../torchchat/index.html">Torchchat</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ğŸ¨ å¤šæ¨¡æ€ã€åº”ç”¨ä¸è¯„æµ‹</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../Diffusers/index.html">Diffusers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../lm_evaluation/index.html">LM-Evalution-Harness</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../open_clip/index.html">open_clip</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../opencompass/index.html">OpenCompass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../opencv/index.html">OpenCV</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../sd_webui/index.html">Stable-Diffusion-WebUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../timm/index.html">timm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../wenet/index.html">WeNet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../whisper_cpp/index.html">Whisper.cpp</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="ç§»åŠ¨ç‰ˆå¯¼èˆªèœå•" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../../index.html">æ˜‡è…¾å¼€æº</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="é¡µé¢å¯¼èˆª">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">GYM Environment Training</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../../../_sources/sources/_generated/sources/ms-swift/source_en/Instruction/GRPO/DeveloperGuide/gym_env.md.txt" rel="nofollow"> æŸ¥çœ‹é¡µé¢æºç </a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gym-environment-training">
<h1>GYM Environment Training<a class="headerlink" href="#gym-environment-training" title="Link to this heading">ïƒ</a></h1>
<p>Note: The GYM environment training logic was refactored in ms-swift 3.8. If you are using an earlier version of ms-swift, please refer to the documentation for that specific version.</p>
<section id="gym-interface">
<h2>Gym Interface<a class="headerlink" href="#gym-interface" title="Link to this heading">ïƒ</a></h2>
<p>GYM originates from <a class="reference external" href="https://github.com/openai/gym">OpenAI Gym</a> and is an abstract interface for reinforcement learning environments. Based on the current &quot;Model as Agent&quot; trend, we have defined a similar interface in swift to provide end-to-end reinforcement learning training for Agents.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Env</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env_config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            env_config: Environment configuration, such as available tools, etc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env_config</span> <span class="o">=</span> <span class="n">env_config</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">RolloutInferRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            config: Environment initialization information.</span>

<span class="sd">        Returns:</span>
<span class="sd">            - observation: The first user message as the initial observation or environment information, which will be treated as a user message.</span>
<span class="sd">            - info: Extra information for DEBUG and logging, which will be recorded in completions.jsonl.</span>
<span class="sd">            - system_message: The system prompt sampled for the user&#39;s current environment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">Messages</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            action: All dialogue messages, with the last message being the current sampled response.</span>

<span class="sd">        Returns:</span>
<span class="sd">            - next_observation: The environment&#39;s response, which will be returned as a user message.</span>
<span class="sd">            - reward: The reward.</span>
<span class="sd">            - done: Whether the episode has finished.</span>
<span class="sd">            - info: Extra information for DEBUG and logging, which will be recorded in completions.jsonl.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean up environment resources.&quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>Additionally, based on the practices of <a class="reference external" href="https://moonshotai.github.io/Kimi-Researcher/">Kimi-Researcher</a>, we also provide an extra <code class="docutils literal notranslate"><span class="pre">ContextManager</span></code> interface to help you dynamically manage the current Agent's context.</p>
<p><strong>Specifying the ContextManager (Optional)</strong></p>
<ol class="simple">
<li><p>In the dataset, specify it using the <code class="docutils literal notranslate"><span class="pre">name</span></code> key in the <a class="reference external" href="#Notes"><code class="docutils literal notranslate"><span class="pre">ctx_config</span></code></a> column. Place related initialization parameters in other keys.</p></li>
<li><p>Use the parameter <code class="docutils literal notranslate"><span class="pre">--context_manager</span> <span class="pre">ctx_name</span></code> to specify it.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ContextManager</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ctx_config</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctx_config</span> <span class="o">=</span> <span class="n">ctx_config</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">manage_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">history</span><span class="p">:</span> <span class="n">Messages</span><span class="p">,</span><span class="n">trajectory_id</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Messages</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dynamically adjusts the current agent&#39;s context.</span>

<span class="sd">        Args:</span>
<span class="sd">            history: The current message history.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The adjusted message history.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>Input Parameter Example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">infer_request</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">RolloutInferRequest(</span>
<span class="sd">    messages=[</span>
<span class="sd">        {&#39;role&#39;: &#39;system&#39;, &#39;content&#39;: &#39;A conversation between User and Assistant. The user asks a question, and the Assistant solves it. The assistant first thinks about the reasoning process in the mind and then provides the user with the answer. The reasoning process and answer are enclosed within &lt;think&gt; &lt;/think&gt; and &lt;answer&gt; &lt;/answer&gt; tags, respectively, i.e., &lt;think&gt; reasoning process here &lt;/think&gt;&lt;answer&gt; answer here &lt;/answer&gt;\n&#39;}, {&#39;role&#39;: &#39;user&#39;, &#39;content&#39;: &#39;What is the value of $\\sqrt{36 \\times \\sqrt{16}}$?&#39;},</span>
<span class="sd">        {&#39;role&#39;: &#39;assistant&#39;, &#39;content&#39;: &#39;To find the value of \\(\\sqrt{36 \\times \\sqrt{16}}\\), we will break down the problem step-by-step.\n\nFirst, we need to evaluate the inner square root:\n\\[\n\\sqrt{16}\n\\]\nWe know that:\n\\[\n4^2 = 16 \\implies \\sqrt{16} = 4\n\\]\n\nNext, we substitute this result back into the original expression:\n\\[\n\\sqrt{36 \\times \\sqrt{16}} = \\sqrt{36 \\times 4}\n\\]\n\nNow, we need to evaluate the product inside the square root:\n\\[\n36 \\times 4 = 144\n\\]\n\nSo, the expression simplifies to:\n\\[\n\\sqrt{144}\n\\]\n\nFinally, we determine the square root of 144:\n\\[\n\\sqrt{144} = 12\n\\]\n\nThus, the value of \\(\\sqrt{36 \\times \\sqrt{16}}\\) is:\n\\[\n\\boxed{12}\n\\]&#39;}</span>
<span class="sd">    ],</span>
<span class="sd">    images=[],</span>
<span class="sd">    audios=[],</span>
<span class="sd">    videos=[],</span>
<span class="sd">    tools=None,</span>
<span class="sd">    objects={},</span>
<span class="sd">    data_dict={</span>
<span class="sd">        &#39;problem&#39;: &#39;What is the value of $\\sqrt{36 \\times \\sqrt{16}}$?&#39;,</span>
<span class="sd">        &#39;solution&#39;: &quot;To solve the problem, we need to evaluate the expression \\(\\sqrt{36 \\times \\sqrt{16}}\\).\n\nWe can break down the steps as follows:\n\n1. Evaluate the inner square root: \\(\\sqrt{16}\\).\n2. Multiply the result by 36.\n3. Take the square root of the product obtained in step 2.\n\nLet&#39;s compute this step by step using Python code for accuracy.\n```python\nimport math\n\n# Step 1: Evaluate the inner square root\ninner_sqrt = math.sqrt(16)\n\n# Step 2: Multiply the result by 36\nproduct = 36 * inner_sqrt\n\n# Step 3: Take the square root of the product\nfinal_result = math.sqrt(product)\nprint(final_result)\n```\n```output\n12.0\n```\nThe value of \\(\\sqrt{36 \\times \\sqrt{16}}\\) is /\\(\\boxed{12}\\).&quot;</span>
<span class="sd">        }</span>
<span class="sd">    )</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">result</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">RolloutResponseChoice(</span>
<span class="sd">    index=0,</span>
<span class="sd">    message=ChatMessage(</span>
<span class="sd">        role=&#39;assistant&#39;,</span>
<span class="sd">        content=&#39;To find the value of \\(\\sqrt{36 \\times \\sqrt{16}}\\), we will break down the problem step-by-step.\n\nFirst, we need to evaluate the inner square root:\n\\[\n\\sqrt{16}\n\\]\nWe know that:\n\\[\n4^2 = 16 \\implies \\sqrt{16} = 4\n\\]\n\nNext, we substitute this result back into the original expression:\n\\[\n\\sqrt{36 \\times \\sqrt{16}} = \\sqrt{36 \\times 4}\n\\]\n\nNow, we need to evaluate the product inside the square root:\n\\[\n36 \\times 4 = 144\n\\]\n\nSo, the expression simplifies to:\n\\[\n\\sqrt{144}\n\\]\n\nFinally, we determine the square root of 144:\n\\[\n\\sqrt{144} = 12\n\\]\n\nThus, the value of \\(\\sqrt{36 \\times \\sqrt{16}}\\) is:\n\\[\n\\boxed{12}\n\\]&#39;, tool_calls=None),</span>
<span class="sd">        finish_reason=&#39;stop&#39;,</span>
<span class="sd">        logprobs=None,</span>
<span class="sd">        messages=None)</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Training with a GYM environment can be considered a special form of multi-turn training, the difference being that reward signals are obtained directly from the environment.</p>
<p>To enable this mode, add the use_gym_env argument to the rollout command, which instructs the system to use GYM as the training environment interface.
We also provide a multi-turn planner example compatible with GYM; see the GymScheduler class in the <a class="reference external" href="https://github.com/modelscope/ms-swift/blob/main/swift/rollout/multi_turn.py">built-in multi-turn scheduler implementation</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="se">\</span>
swift<span class="w"> </span>rollout<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--model<span class="w"> </span>xxx<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--use_gym_env<span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--multi_turn_scheduler<span class="w"> </span>gym_scheduler<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--max_turns<span class="w"> </span>xxx
</pre></div>
</div>
<p><strong>Environment Selection</strong></p>
<ol class="simple">
<li><p>In the dataset, you need to specify it using the <code class="docutils literal notranslate"><span class="pre">name</span></code> key in the <a class="reference external" href="#Notes"><code class="docutils literal notranslate"><span class="pre">env_config</span></code></a> column. Place related initialization parameters in other keys.</p></li>
<li><p>Use the parameter <code class="docutils literal notranslate"><span class="pre">--gym_env</span> <span class="pre">env_name</span></code> to specify it.</p></li>
</ol>
</section>
<section id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading">ïƒ</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="../../../../../examples/train/grpo/external/vllm_gym.sh">Training Script</a></p></li>
</ul>
<p>Using the <code class="docutils literal notranslate"><span class="pre">external_plugins</span></code> parameter, we can register local <code class="docutils literal notranslate"><span class="pre">Env</span></code> and <code class="docutils literal notranslate"><span class="pre">ContextManager</span></code> classes into ms-swift. For the specific implementation, refer to the <a class="reference external" href="https://github.com/modelscope/ms-swift/blob/main/examples/train/grpo/plugin/plugin.py">code</a>.</p>
</section>
<section id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Link to this heading">ïƒ</a></h2>
<ol class="simple">
<li><p>Reference Training Data Format</p></li>
</ol>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;messages&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;system&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;You are a helpful and harmless assistant&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;content&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Tell me tomorrow&#39;s weather&quot;</span><span class="p">}],</span><span class="nt">&quot;env_config&quot;</span><span class="p">:{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;custom_env&quot;</span><span class="p">,</span><span class="nt">&quot;other_config&quot;</span><span class="p">:</span><span class="s2">&quot;xxxx&quot;</span><span class="p">},</span><span class="nt">&quot;ctx_config&quot;</span><span class="p">:{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;custom_ctx&quot;</span><span class="p">,</span><span class="nt">&quot;other_config&quot;</span><span class="p">:</span><span class="s2">&quot;xxxx&quot;</span><span class="p">}}</span>
</pre></div>
</div>
<ol class="simple">
<li><p>By default, only the response from the last round is used for training. If the gym involves generating multi-turn responses, use the parameter <code class="docutils literal notranslate"><span class="pre">--loss_scale</span> <span class="pre">default</span></code> to train on the responses from all rounds. For more details, please refer to the <a class="reference external" href="./multi_turn.md#loss-masking">documentation</a>.</p></li>
<li><p>Data Flow
The entire gym data flow is as follows:</p></li>
</ol>
<img src="https://raw.githubusercontent.com/modelscope/ms-swift/main/docs/resources/gym_env.png" width="250" /><ol class="simple">
<li><p>Reward Logging
Since the gym reward is calculated within the <code class="docutils literal notranslate"><span class="pre">step</span></code> function, you need to manually return the log via <code class="docutils literal notranslate"><span class="pre">info</span></code>. The final record will be placed in the <code class="docutils literal notranslate"><span class="pre">trajectory_infos</span></code> field of <code class="docutils literal notranslate"><span class="pre">completions.jsonl</span></code>.</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; ç‰ˆæƒæ‰€æœ‰ 2024, Ascendã€‚</p>
  </div>

  åˆ©ç”¨ <a href="https://www.sphinx-doc.org/">Sphinx</a> æ„å»ºï¼Œä½¿ç”¨çš„ 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">ä¸»é¢˜</a>
    ç”± <a href="https://readthedocs.org">Read the Docs</a> å¼€å‘.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>